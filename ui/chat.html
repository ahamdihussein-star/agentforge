<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>AgentForge - AI Assistant</title>
    <link rel="icon" type="image/png" href="/AgentForge_Logo.png">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Shared platform theme (same as Admin + Process Builder) -->
    <link rel="stylesheet" href="/ui/theme.css">
    <link rel="stylesheet" href="/ui/chat.css?v=20260226a">

    <script src="/ui/theme.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
</head>
<body>
    <!-- Login Screen -->
    <div id="login-screen" class="login-screen">
        <div class="login-card">
            <div class="login-header">
                <div class="login-logo">
                    <img src="/AgentForge_Logo.png" alt="AgentForge" style="width: 60px; height: 60px; object-fit: contain; border-radius: 12px;">
                </div>
                <h1 class="login-title">Welcome Back</h1>
                <p class="login-subtitle">Sign in to continue to your AI Assistant</p>
            </div>
            
            <form id="login-form" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label class="form-label">Username</label>
                    <input type="text" id="login-username" class="form-input" placeholder="your.username" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" id="login-password" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                
                <button type="submit" class="login-btn" id="login-btn">
                    Sign In
                </button>
            </form>
            
            <div class="login-divider">or continue with</div>
            
            <div class="social-login">
                <button class="social-btn" onclick="handleGoogleLogin()" title="Google">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
                        <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
                        <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
                        <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
                    </svg>
                </button>
                <button class="social-btn" onclick="handleMicrosoftLogin()" title="Microsoft">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M11.4 24H0V12.6h11.4V24z" fill="#00A4EF"/>
                        <path d="M24 24H12.6V12.6H24V24z" fill="#FFB900"/>
                        <path d="M11.4 11.4H0V0h11.4v11.4z" fill="#F25022"/>
                        <path d="M24 11.4H12.6V0H24v11.4z" fill="#7FBA00"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Main Chat Interface -->
    <div id="chat-interface" class="hidden" style="display: none; width: 100%; height: 100vh;">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">
                        <img src="/AgentForge_Logo.png" alt="AgentForge" style="width: 100%; height: 100%; object-fit: contain; border-radius: 8px;">
                    </div>
                    <span>AgentForge</span>
                </div>
                <button class="new-chat-btn" id="new-chat-btn" onclick="startNewChat()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    New Chat
                </button>
            </div>

            <!-- Portal Navigation -->
            <div class="portal-nav" id="portal-nav">
                <div class="nav-item active" data-view="home" onclick="switchView('home')">
                    <span class="nav-icon">üè†</span>
                    <span class="nav-label">Home</span>
                </div>
                <div class="nav-item" data-view="chat" onclick="switchView('chat')">
                    <span class="nav-icon">üí¨</span>
                    <span class="nav-label">Conversational AI Agents</span>
                </div>
                <div class="nav-item" data-view="workflows" onclick="switchView('workflows')">
                    <span class="nav-icon">üß©</span>
                    <span class="nav-label">Process AI Agents</span>
                </div>
            </div>

            <!-- NOTE: Sidebar is navigation-only for scalability.
                 Agent directories are rendered in-page (split view) -->

            <!-- User Section -->
            <div class="user-section" style="position: relative;">
                <div class="user-profile-trigger" onclick="toggleUserMenu(event)">
                    <div class="user-avatar" id="user-avatar">U</div>
                    <div class="user-info">
                        <div class="user-name" id="user-name">User</div>
                        <div class="user-email" id="user-email">user@example.com</div>
                    </div>
                    <svg class="user-chevron" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                </div>
                
                <div class="user-menu" id="user-menu">
                    <div class="user-menu-item" onclick="showProfile()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                        Profile
                    </div>
                    <div class="user-menu-item" onclick="showSettings()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"></circle>
                            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                        </svg>
                        Settings
                    </div>
                    <div class="user-menu-item danger" onclick="handleLogout()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                            <polyline points="16 17 21 12 16 7"></polyline>
                            <line x1="21" y1="12" x2="9" y2="12"></line>
                        </svg>
                        Sign Out
                    </div>
                </div>
            </div>
        </div>

        <!-- Mobile sidebar overlay -->
        <div class="sidebar-overlay" id="sidebar-overlay" onclick="closeSidebar()"></div>

        <!-- Main Chat -->
        <div class="main-chat">
            <!-- Home View -->
            <div id="view-home" class="portal-view home-view hidden">
                <div class="home-banner" id="home-banner">
                    <div class="home-banner-inner">
                        <div class="home-greeting" id="home-greeting">Welcome</div>
                        <div class="home-tagline" id="home-tagline">Your AI workspace ‚Äî use Conversational and Process AI Agents to get work done.</div>
                        <div class="home-stats" id="home-stats">
                            <div class="home-stat">
                                <div class="home-stat-value" id="home-stat-assistants">0</div>
                                <div class="home-stat-label">Conversational Agents</div>
                            </div>
                            <div class="home-stat">
                                <div class="home-stat-value" id="home-stat-processes">0</div>
                                <div class="home-stat-label">Process Agents</div>
                            </div>
                            <div class="home-stat">
                                <div class="home-stat-value" id="home-stat-inbox">0</div>
                                <div class="home-stat-label">Action Required</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="home-body">
                    <div class="home-section-title">Get Started</div>
                    <div class="home-grid">
                        <div class="home-card" onclick="switchView('chat')">
                            <div class="home-card-header">
                                <div class="home-card-icon chat">üí¨</div>
                                <div>
                                    <div class="home-card-title">Conversational AI Agents</div>
                                    <div class="home-card-count" id="home-assistants-label">Conversational AI</div>
                                </div>
                            </div>
                            <div class="home-card-desc">Ask questions, draft content, analyze documents, and get help from Conversational AI Agents in real time.</div>
                            <div class="home-card-footer">
                                <span class="home-badge">Chat &bull; Real-time</span>
                                <span class="home-card-arrow">&rarr;</span>
                            </div>
                        </div>
                        <div class="home-card" onclick="switchView('workflows')">
                            <div class="home-card-header">
                                <div class="home-card-icon process">üìã</div>
                                <div>
                                    <div class="home-card-title">Process AI Agents</div>
                                    <div class="home-card-count" id="home-processes-label">Requests &amp; Approvals</div>
                                </div>
                            </div>
                            <div class="home-card-desc">Submit requests, fill out forms, and track approvals ‚Äî everything you need in one place.</div>
                            <div class="home-card-footer">
                                <span class="home-badge">Requests &bull; Forms &bull; Approvals</span>
                                <span class="home-card-arrow">&rarr;</span>
                            </div>
                        </div>
                    </div>

                    <div class="home-section-title">Action Required</div>
                    <div class="home-inbox" id="home-inbox">
                        <div class="home-empty">Loading your inbox‚Ä¶</div>
                    </div>

                    <div class="home-section-title">Quick Access</div>
                    <div class="home-recent" id="home-recent">
                        <div class="home-empty">Your recent activity will appear here once you start chatting or submitting requests.</div>
                    </div>
                </div>
            </div>

            <!-- Conversational AI Agents (Directory + Chat split view) -->
            <div id="view-chat" class="portal-view hidden">
                <div class="portal-header">
                    <div class="portal-header-left">
                        <div class="portal-title">üí¨ Conversational AI Agents</div>
                        <div class="portal-subtitle">Find the right agent quickly ‚Äî then start a conversation.</div>
                    </div>
                    <div class="portal-toolbar">
                        <input id="conv-search" class="search-input" placeholder="Search conversational agents‚Ä¶" oninput="renderConversationalDirectory()">
                    </div>
                </div>
                <div class="portal-content">
                    <div class="split-layout">
                        <div class="list-panel">
                            <div class="list-panel-header">
                                <div class="seg-tabs" style="display:flex; gap:8px; flex-wrap:wrap;">
                                    <button class="seg-tab active" id="conv-tab-agents" onclick="setConversationalTab('agents')">Agents</button>
                                    <button class="seg-tab" id="conv-tab-history" onclick="setConversationalTab('history')">Recent conversations</button>
                                </div>
                                <span style="margin-left:auto; color: var(--text-muted); font-size: 0.8rem;" id="conv-count"></span>
                            </div>
                            <div class="list-panel-body">
                                <div id="conv-filters" style="padding: 12px 14px; border-bottom: 1px solid var(--border);">
                                    <div class="chip-row" id="conv-category-chips" style="margin-top:0;"></div>
                                </div>
                                <div id="conv-agents-panel">
                                    <div id="agent-list" class="virtual-list" style="height: 100%;"></div>
                                </div>
                                <div id="conv-history-panel" class="hidden" style="padding: 12px 14px;">
                                    <div class="section-label" style="display:flex; justify-content: space-between; align-items:center; margin-bottom: 10px;">
                                        <span>Recent conversations</span>
                                        <span id="edit-chats-btn" onclick="toggleSelectionMode()" style="font-size: 0.75rem; color: var(--primary); cursor: pointer;">Edit</span>
                                    </div>
                                    <div id="history-actions" class="history-actions hidden">
                                        <span class="select-all-btn" onclick="toggleSelectAll()">
                                            <span id="select-all-text">Select All</span>
                                        </span>
                                        <button id="delete-selected-btn" class="delete-selected-btn" onclick="deleteSelectedChats()" disabled>
                                            Delete (0)
                                        </button>
                                    </div>
                                    <div id="history-list"></div>
                                </div>
                            </div>
                        </div>
                        <div class="detail-panel">
                            <!-- Chat Header -->
                            <div class="chat-header" style="border-bottom: 1px solid var(--border);">
                                <div class="chat-agent-info">
                                    <button class="chat-action-btn" onclick="toggleSidebar()" style="display: none;" id="mobile-menu-btn">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <line x1="3" y1="12" x2="21" y2="12"></line>
                                            <line x1="3" y1="6" x2="21" y2="6"></line>
                                            <line x1="3" y1="18" x2="21" y2="18"></line>
                                        </svg>
                                    </button>
                                    <div class="chat-agent-icon" id="current-agent-icon">ü§ñ</div>
                                    <div class="chat-agent-details">
                                        <h2 id="current-agent-name">Select a Conversational AI Agent</h2>
                                        <div class="chat-agent-status">
                                            <span class="status-dot"></span>
                                            <span>Online</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="chat-actions">
                                    <button class="chat-action-btn" onclick="clearCurrentChat()" title="Clear Chat">
                                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="3 6 5 6 21 6"></polyline>
                                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            <div class="messages-container" id="messages-container">
                                <div class="welcome-screen" id="welcome-screen">
                                    <div class="welcome-icon" style="animation: fadeInUp 0.4s ease-out both;">üí¨</div>
                                    <h1 class="welcome-title" style="animation: fadeInUp 0.4s ease-out 0.1s both;">How can I help you today?</h1>
                                    <p class="welcome-subtitle" style="animation: fadeInUp 0.4s ease-out 0.18s both;">Choose a Conversational AI Agent on the left, then ask anything.</p>
                                    <div class="suggestions" id="suggestions" style="animation: fadeInUp 0.4s ease-out 0.26s both;">
                                        <div class="suggestion-chip" onclick="sendSuggestion(this)">What can you help me with?</div>
                                        <div class="suggestion-chip" onclick="sendSuggestion(this)">Summarize a document for me</div>
                                        <div class="suggestion-chip" onclick="sendSuggestion(this)">How do I get started?</div>
                                    </div>
                                </div>
                            </div>
                            <div class="input-area">
                                <div class="input-container">
                                    <textarea
                                        id="message-input"
                                        class="message-input"
                                        placeholder="Type your message..."
                                        rows="1"
                                        onkeydown="handleKeyDown(event)"
                                        oninput="autoResize(this)"
                                    ></textarea>
                                    <div class="input-actions">
                                        <button class="input-action-btn" onclick="attachFile()" title="Attach File">
                                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path>
                                            </svg>
                                        </button>
                                        <button class="input-action-btn send-btn" id="send-btn" onclick="sendMessage()" title="Send">
                                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <line x1="22" y1="2" x2="11" y2="13"></line>
                                                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Service Catalog View -->
            <div id="view-workflows" class="portal-view hidden">
                <div class="portal-header">
                    <div class="portal-header-left">
                        <div class="portal-title">üß© Process AI Agents</div>
                        <div class="portal-subtitle">Browse available Process AI Agents and submit your requests.</div>
                        <div class="portal-tabs work-tabs">
                            <button class="portal-tab work-tab" data-target="workflows" onclick="switchView('workflows')">
                                <span class="work-tab-icon" aria-hidden="true">üß©</span>
                                <span class="work-tab-label">Process AI Agents</span>
                                <span class="work-tab-badge" data-badge="workflows"></span>
                            </button>
                            <button class="portal-tab work-tab" data-target="requests" onclick="switchView('requests')">
                                <span class="work-tab-icon" aria-hidden="true">üìÑ</span>
                                <span class="work-tab-label">My Requests</span>
                                <span class="work-tab-badge" data-badge="requests"></span>
                            </button>
                            <button class="portal-tab work-tab" data-target="inbox" onclick="switchView('inbox')">
                                <span class="work-tab-icon" aria-hidden="true">‚úÖ</span>
                                <span class="work-tab-label">Inbox</span>
                                <span class="work-tab-badge" data-badge="inbox"></span>
                            </button>
                        </div>
                    </div>
                    <div class="portal-toolbar">
                        <input id="workflow-search" class="search-input" placeholder="Search process agents‚Ä¶" oninput="renderWorkflows()">
                        <button class="portal-btn" onclick="refreshWorkflows()">Refresh</button>
                    </div>
                </div>
                <div class="portal-content">
                    <div class="chip-row" id="workflow-category-chips" style="margin-top:0;"></div>
                    <div class="chip-row" id="workflow-quick-filters" style="margin-top:10px;"></div>
                    <div class="split-layout" style="margin-top: 14px;">
                        <div class="list-panel">
                            <div class="list-panel-header">
                                <span style="font-weight: 750;">Process AI Agents</span>
                                <span style="margin-left:auto; color: var(--text-muted); font-size: 0.8rem;" id="workflow-count"></span>
                            </div>
                            <div class="list-panel-body">
                                <div id="workflow-list" class="virtual-list" style="height: 100%;"></div>
                            </div>
                        </div>
                        <div class="detail-panel">
                            <div class="detail-header">
                                <div>
                                    <div style="font-weight: 800; font-size: 1rem;" id="workflow-detail-title">Select a Process AI Agent</div>
                                    <div style="color: var(--text-muted); font-size: 0.85rem;" id="workflow-detail-subtitle">Review details, then submit a request.</div>
                                </div>
                                <div class="portal-toolbar">
                                    <button class="portal-btn" onclick="refreshWorkflows()">Refresh</button>
                                </div>
                            </div>
                            <div class="detail-body" id="workflow-detail-body"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- My Requests View -->
            <div id="view-requests" class="portal-view hidden">
                <div class="portal-header">
                    <div class="portal-header-left">
                        <div class="portal-title">üìÑ My Requests</div>
                        <div class="portal-subtitle">Track requests submitted to Process AI Agents ‚Äî status, updates, and outcomes.</div>
                        <div class="portal-tabs work-tabs">
                            <button class="portal-tab work-tab" data-target="workflows" onclick="switchView('workflows')">
                                <span class="work-tab-icon" aria-hidden="true">üß©</span>
                                <span class="work-tab-label">Process AI Agents</span>
                                <span class="work-tab-badge" data-badge="workflows"></span>
                            </button>
                            <button class="portal-tab work-tab" data-target="requests" onclick="switchView('requests')">
                                <span class="work-tab-icon" aria-hidden="true">üìÑ</span>
                                <span class="work-tab-label">My Requests</span>
                                <span class="work-tab-badge" data-badge="requests"></span>
                            </button>
                            <button class="portal-tab work-tab" data-target="inbox" onclick="switchView('inbox')">
                                <span class="work-tab-icon" aria-hidden="true">‚úÖ</span>
                                <span class="work-tab-label">Inbox</span>
                                <span class="work-tab-badge" data-badge="inbox"></span>
                            </button>
                        </div>
                    </div>
                    <div class="portal-toolbar">
                        <input id="requests-search" class="search-input" placeholder="Search my requests‚Ä¶" oninput="renderRequests()">
                        <button class="portal-btn" onclick="refreshRequests()">Refresh</button>
                    </div>
                </div>
                <div class="portal-content">
                    <div class="chip-row" id="requests-scope-chips"></div>
                    <div class="chip-row" id="requests-filter-chips"></div>
                    <div class="split-layout">
                        <div class="list-panel">
                            <div class="list-panel-header">
                                <span style="font-weight: 750;">Requests</span>
                                <span style="margin-left:auto; color: var(--text-muted); font-size: 0.8rem;" id="requests-count"></span>
                            </div>
                            <div class="list-panel-body" id="requests-list"></div>
                        </div>
                        <div class="detail-panel">
                            <div class="detail-header">
                                <div>
                                    <div style="font-weight: 800; font-size: 1rem;" id="request-detail-title">Select a request</div>
                                    <div style="color: var(--text-muted); font-size: 0.85rem;" id="request-detail-subtitle">Choose a request to view its details and current status.</div>
                                </div>
                                <div class="portal-toolbar">
                                    <button class="portal-btn" onclick="refreshSelectedRequest()" id="request-refresh-btn" disabled>Refresh</button>
                                </div>
                            </div>
                            <div class="detail-body" id="request-detail-body"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Inbox View -->
            <div id="view-inbox" class="portal-view hidden">
                <div class="portal-header">
                    <div class="portal-header-left">
                        <div class="portal-title">‚úÖ Inbox</div>
                        <div class="portal-subtitle">Review approvals and tasks that require your action ‚Äî with clear next steps.</div>
                        <div class="portal-tabs work-tabs">
                            <button class="portal-tab work-tab" data-target="workflows" onclick="switchView('workflows')">
                                <span class="work-tab-icon" aria-hidden="true">üß©</span>
                                <span class="work-tab-label">Process AI Agents</span>
                                <span class="work-tab-badge" data-badge="workflows"></span>
                            </button>
                            <button class="portal-tab work-tab" data-target="requests" onclick="switchView('requests')">
                                <span class="work-tab-icon" aria-hidden="true">üìÑ</span>
                                <span class="work-tab-label">My Requests</span>
                                <span class="work-tab-badge" data-badge="requests"></span>
                            </button>
                            <button class="portal-tab work-tab" data-target="inbox" onclick="switchView('inbox')">
                                <span class="work-tab-icon" aria-hidden="true">‚úÖ</span>
                                <span class="work-tab-label">Inbox</span>
                                <span class="work-tab-badge" data-badge="inbox"></span>
                            </button>
                        </div>
                    </div>
                    <div class="portal-toolbar">
                        <input id="inbox-search" class="search-input" placeholder="Search inbox‚Ä¶" oninput="renderInbox()">
                        <button class="portal-btn" onclick="refreshInbox()">Refresh</button>
                    </div>
                </div>
                <div class="portal-content">
                    <div class="split-layout">
                        <div class="list-panel">
                            <div class="list-panel-header">
                                <span style="font-weight: 750;">Pending approvals</span>
                                <span style="margin-left:auto; color: var(--text-muted); font-size: 0.8rem;" id="inbox-count"></span>
                            </div>
                            <div class="list-panel-body" id="inbox-list"></div>
                        </div>
                        <div class="detail-panel">
                            <div class="detail-header">
                                <div>
                                    <div style="font-weight: 800; font-size: 1rem;" id="inbox-detail-title">Select an item</div>
                                    <div style="color: var(--text-muted); font-size: 0.85rem;" id="inbox-detail-subtitle">Select an item to review details and take action.</div>
                                </div>
                                <div class="portal-toolbar">
                                    <button class="portal-btn" onclick="refreshSelectedApproval()" id="inbox-refresh-btn" disabled>Refresh</button>
                                </div>
                            </div>
                            <div class="detail-body" id="inbox-detail-body"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

        <script src="/ui/chat.js?v=20260301a" defer></script>

    <!-- Workflow Run Modal -->
    <div id="workflow-run-modal" class="modal-overlay" onclick="if(event.target===this)closeWorkflowRunModal()">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title" id="workflow-run-title">New Request</h2>
                <button class="modal-close" onclick="closeWorkflowRunModal()">‚úï</button>
            </div>
            <div class="modal-body">
                <div id="workflow-run-desc" style="color: var(--text-muted); font-size: 0.9rem; margin-bottom: 14px;"></div>
                <div id="workflow-form-fields" style="display: flex; flex-direction: column; gap: 12px;"></div>
                <div class="modal-actions">
                    <button class="modal-btn" onclick="closeWorkflowRunModal()">Cancel</button>
                    <button class="modal-btn modal-btn-primary" id="workflow-run-btn" onclick="executeWorkflow()">Submit</button>
                </div>
                <div id="workflow-run-status" style="margin-top: 12px; color: var(--text-muted); font-size: 0.85rem;"></div>
            </div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div id="profile-modal" class="modal-overlay" onclick="if(event.target===this)hideProfile()">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Profile</h2>
                <button class="modal-close" onclick="hideProfile()">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="profile-header">
                    <div class="profile-avatar-large" id="profile-avatar-display">U</div>
                    <div class="profile-info">
                        <h3 id="profile-name-display">User Name</h3>
                        <p id="profile-email-display">user@example.com</p>
                    </div>
                </div>

                <div class="modal-section">
                    <div class="modal-section-title">Personal Information</div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                        <div class="modal-form-group" style="margin-bottom: 0;">
                            <label class="modal-form-label">First Name</label>
                            <input type="text" id="profile-first-name" class="modal-form-input" placeholder="First name">
                        </div>
                        <div class="modal-form-group" style="margin-bottom: 0;">
                            <label class="modal-form-label">Last Name</label>
                            <input type="text" id="profile-last-name" class="modal-form-input" placeholder="Last name">
                        </div>
                    </div>
                    <button class="modal-btn modal-btn-primary" style="margin-top: 16px;" onclick="updateProfile()">Save Changes</button>
                </div>

                <div class="modal-section">
                    <div class="modal-section-title">Security</div>
                    
                    <div class="setting-item">
                        <div>
                            <div class="setting-label">Two-Factor Authentication</div>
                            <div class="setting-desc">Add an extra layer of security</div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <span id="mfa-status-badge" class="mfa-badge disabled">‚úó Disabled</span>
                            <div id="mfa-toggle" class="toggle" onclick="toggleMFA()"></div>
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <div>
                            <div class="setting-label">Password</div>
                            <div class="setting-desc">Change your account password</div>
                        </div>
                        <button class="modal-btn modal-btn-secondary" onclick="showChangePassword()">Change</button>
                    </div>
                </div>

                <div id="change-password-section" class="modal-section hidden">
                    <div class="modal-section-title">Change Password</div>
                    <div class="modal-form-group">
                        <label class="modal-form-label">Current Password</label>
                        <div class="password-input-wrapper">
                            <input type="password" id="current-password" class="modal-form-input" placeholder="Enter current password">
                            <button type="button" class="password-toggle" onclick="togglePasswordVisibility('current-password', this)">
                                <svg class="eye-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                    <circle cx="12" cy="12" r="3"></circle>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="modal-form-group">
                        <label class="modal-form-label">New Password</label>
                        <div class="password-input-wrapper">
                            <input type="password" id="new-password" class="modal-form-input" placeholder="Enter new password">
                            <button type="button" class="password-toggle" onclick="togglePasswordVisibility('new-password', this)">
                                <svg class="eye-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                    <circle cx="12" cy="12" r="3"></circle>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="modal-form-group">
                        <label class="modal-form-label">Confirm New Password</label>
                        <div class="password-input-wrapper">
                            <input type="password" id="confirm-password" class="modal-form-input" placeholder="Confirm new password">
                            <button type="button" class="password-toggle" onclick="togglePasswordVisibility('confirm-password', this)">
                                <svg class="eye-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                    <circle cx="12" cy="12" r="3"></circle>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <button class="modal-btn modal-btn-primary" onclick="changePassword()">Update Password</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal-overlay" onclick="if(event.target===this)hideSettings()">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Settings</h2>
                <button class="modal-close" onclick="hideSettings()">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="modal-section">
                    <div class="modal-section-title">Appearance</div>
                    <div class="theme-options">
                        <div class="theme-option" data-theme="dark" onclick="setTheme('dark')">
                            <div class="theme-icon">üåô</div>
                            <div class="theme-name">Dark</div>
                        </div>
                        <div class="theme-option" data-theme="light" onclick="setTheme('light')">
                            <div class="theme-icon">‚òÄÔ∏è</div>
                            <div class="theme-name">Light</div>
                        </div>
                        <div class="theme-option" data-theme="ocean" onclick="setTheme('ocean')">
                            <div class="theme-icon">üåä</div>
                            <div class="theme-name">Ocean</div>
                        </div>
                        <div class="theme-option" data-theme="sunset" onclick="setTheme('sunset')">
                            <div class="theme-icon">üåÖ</div>
                            <div class="theme-name">Sunset</div>
                        </div>
                        <div class="theme-option" data-theme="forest" onclick="setTheme('forest')">
                            <div class="theme-icon">üå≤</div>
                            <div class="theme-name">Forest</div>
                        </div>
                    </div>
                </div>

                <div class="modal-section" id="branding-settings-section" style="display:none;">
                    <div class="modal-section-title">Branding (Organization)</div>
                    <div style="color: var(--text-muted); font-size: 0.9rem; margin-top: -6px; margin-bottom: 14px;">
                        Customize the portal appearance for your organization. Changes apply to all users.
                    </div>

                    <div class="modal-form-group">
                        <label class="modal-form-label">Organization Name</label>
                        <input type="text" id="brand-org-name" class="modal-form-input" placeholder="Company name">
                    </div>

                    <!-- Logo Upload -->
                    <div class="modal-form-group">
                        <label class="modal-form-label">Logo</label>
                        <div class="brand-upload-zone" id="brand-logo-zone">
                            <input type="file" accept="image/*" onchange="handleBrandFileUpload(event, 'logo')">
                            <div class="upload-label" id="brand-logo-label">
                                <strong>Click or drop</strong> to upload logo (PNG, SVG, JPG)
                            </div>
                            <img id="brand-logo-preview" class="brand-preview" style="display:none;">
                        </div>
                        <input type="hidden" id="brand-logo-url">
                    </div>

                    <!-- Favicon Upload -->
                    <div class="modal-form-group">
                        <label class="modal-form-label">Favicon</label>
                        <div class="brand-upload-zone" id="brand-favicon-zone">
                            <input type="file" accept="image/*" onchange="handleBrandFileUpload(event, 'favicon')">
                            <div class="upload-label" id="brand-favicon-label">
                                <strong>Click or drop</strong> to upload favicon (ICO, PNG, SVG)
                            </div>
                            <img id="brand-favicon-preview" class="brand-preview" style="display:none; max-height: 32px;">
                        </div>
                        <input type="hidden" id="brand-favicon-url">
                    </div>

                    <!-- Colors -->
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                        <div class="modal-form-group" style="margin-bottom: 0;">
                            <label class="modal-form-label">Primary Color</label>
                            <div style="display:flex; gap: 8px; align-items: center;">
                                <input type="color" id="brand-primary-picker" value="#6D5EF7" style="width:36px; height:36px; border:none; background:none; cursor:pointer; padding:0;" onchange="document.getElementById('brand-primary').value=this.value">
                                <input type="text" id="brand-primary" class="modal-form-input" placeholder="#6D5EF7" style="flex:1;" oninput="try{document.getElementById('brand-primary-picker').value=this.value}catch(_){}">
                            </div>
                        </div>
                        <div class="modal-form-group" style="margin-bottom: 0;">
                            <label class="modal-form-label">Secondary Color</label>
                            <div style="display:flex; gap: 8px; align-items: center;">
                                <input type="color" id="brand-secondary-picker" value="#00D4FF" style="width:36px; height:36px; border:none; background:none; cursor:pointer; padding:0;" onchange="document.getElementById('brand-secondary').value=this.value">
                                <input type="text" id="brand-secondary" class="modal-form-input" placeholder="#00D4FF" style="flex:1;" oninput="try{document.getElementById('brand-secondary-picker').value=this.value}catch(_){}">
                            </div>
                        </div>
                    </div>

                    <!-- Banner -->
                    <div class="modal-form-group" style="margin-top: 14px;">
                        <label class="modal-form-label">Portal Banner</label>
                        <div class="setting-item" style="margin-top: 8px;">
                            <div>
                                <div class="setting-label">Enable Banner</div>
                                <div class="setting-desc">Announcement banner at the top of the portal</div>
                            </div>
                            <div class="toggle" id="brand-banner-enabled" onclick="this.classList.toggle('active')"></div>
                        </div>
                    </div>
                    <div class="modal-form-group">
                        <label class="modal-form-label">Banner Text (HTML supported)</label>
                        <input type="text" id="brand-banner-text" class="modal-form-input" placeholder="e.g., Welcome to ACME Portal">
                    </div>
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                        <div class="modal-form-group" style="margin-bottom: 0;">
                            <label class="modal-form-label">Banner Background</label>
                            <div style="display:flex; gap: 8px; align-items: center;">
                                <input type="color" id="brand-banner-bg-picker" value="#111827" style="width:36px; height:36px; border:none; background:none; cursor:pointer; padding:0;" onchange="document.getElementById('brand-banner-bg').value=this.value">
                                <input type="text" id="brand-banner-bg" class="modal-form-input" placeholder="#111827 or gradient" style="flex:1;">
                            </div>
                        </div>
                        <div class="modal-form-group" style="margin-bottom: 0;">
                            <label class="modal-form-label">Banner Text Color</label>
                            <div style="display:flex; gap: 8px; align-items: center;">
                                <input type="color" id="brand-banner-tc-picker" value="#FFFFFF" style="width:36px; height:36px; border:none; background:none; cursor:pointer; padding:0;" onchange="document.getElementById('brand-banner-text-color').value=this.value">
                                <input type="text" id="brand-banner-text-color" class="modal-form-input" placeholder="#FFFFFF" style="flex:1;">
                            </div>
                        </div>
                    </div>

                    <!-- Welcome Copy -->
                    <div class="modal-form-group" style="margin-top: 14px;">
                        <label class="modal-form-label">Chat Welcome Title</label>
                        <input type="text" id="brand-chat-title" class="modal-form-input" placeholder="How can I help you today?">
                    </div>
                    <div class="modal-form-group">
                        <label class="modal-form-label">Chat Welcome Message</label>
                        <input type="text" id="brand-chat-message" class="modal-form-input" placeholder="Select an assistant and start a conversation.">
                    </div>

                    <!-- CSS: paste or upload -->
                    <div class="modal-form-group">
                        <label class="modal-form-label">Custom CSS</label>
                        <div class="brand-upload-zone" style="margin-bottom:8px;">
                            <input type="file" accept=".css,text/css" onchange="handleBrandCSSUpload(event)">
                            <div class="upload-label"><strong>Upload a .css file</strong> or paste below</div>
                        </div>
                        <textarea id="brand-custom-css" class="modal-form-input" rows="4" placeholder="/* Custom CSS overrides */"></textarea>
                    </div>

                    <div class="modal-actions" style="margin-top: 14px;">
                        <button class="modal-btn" onclick="resetBrandingSettings()">Reset to Defaults</button>
                        <button class="modal-btn modal-btn-primary" onclick="saveBrandingSettings()">Save Branding</button>
                    </div>
                    <div id="brand-save-status" style="margin-top: 10px; color: var(--text-muted); font-size: 0.85rem;"></div>
                </div>

                <div class="modal-section">
                    <div class="modal-section-title">Notifications</div>
                    <div class="setting-item">
                        <div>
                            <div class="setting-label">Sound Effects</div>
                            <div class="setting-desc">Play a subtle sound when new messages arrive</div>
                        </div>
                        <div class="toggle" id="sound-toggle" onclick="toggleSoundEffects()"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MFA Setup Modal -->
    <div id="mfa-setup-modal" class="modal-overlay" onclick="if(event.target===this)hideMFASetup()">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Enable Two-Factor Authentication</h2>
                <button class="modal-close" onclick="hideMFASetup()">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="modal-form-group">
                    <label class="modal-form-label">Authentication Method</label>
                    <select id="mfa-method-select" class="modal-form-input" onchange="requestMFASetup()">
                        <option value="email">Email Code</option>
                        <option value="totp">Authenticator App</option>
                    </select>
                </div>
                <div id="mfa-setup-content">
                    <!-- Dynamic content loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Schedule Edit Modal (Process AI Agents) -->
    <div id="schedule-modal" class="modal-overlay" onclick="if(event.target===this)closeScheduleModal()">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Edit Schedule</h2>
                <button class="modal-close" onclick="closeScheduleModal()">‚úï</button>
            </div>
            <div class="modal-body">
                <div style="color: var(--text-muted); font-size: 0.9rem; margin-top: -6px; margin-bottom: 14px;">
                    Update when this Process AI Agent runs automatically.
                </div>

                <div class="modal-section" style="margin-bottom: 14px;">
                    <div class="setting-item" style="padding: 10px 0;">
                        <div>
                            <div class="setting-label">Enable schedule</div>
                            <div class="setting-desc">Turn automation on or off</div>
                        </div>
                        <div class="toggle" id="schedule-enabled-toggle" onclick="this.classList.toggle('active')"></div>
                    </div>
                </div>

                <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                    <div class="modal-form-group" style="margin-bottom: 0;">
                        <label class="modal-form-label">Frequency</label>
                        <select id="schedule-frequency" class="modal-form-input">
                            <option value="daily">Every day</option>
                            <option value="weekly">Every week</option>
                            <option value="monthly">Every month</option>
                        </select>
                    </div>
                    <div class="modal-form-group" style="margin-bottom: 0;">
                        <label class="modal-form-label">Time</label>
                        <input id="schedule-time" type="time" class="modal-form-input" value="09:00">
                    </div>
                </div>

                <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 12px;">
                    <div class="modal-form-group" style="margin-bottom: 0;">
                        <label class="modal-form-label">Day of week (weekly)</label>
                        <select id="schedule-dow" class="modal-form-input">
                            <option value="1">Monday</option>
                            <option value="2">Tuesday</option>
                            <option value="3">Wednesday</option>
                            <option value="4">Thursday</option>
                            <option value="5">Friday</option>
                            <option value="6">Saturday</option>
                            <option value="0">Sunday</option>
                        </select>
                    </div>
                    <div class="modal-form-group" style="margin-bottom: 0;">
                        <label class="modal-form-label">Day of month (monthly)</label>
                        <select id="schedule-dom" class="modal-form-input"></select>
                    </div>
                </div>

                <div class="modal-form-group" style="margin-top: 12px;">
                    <label class="modal-form-label">Timezone</label>
                    <input id="schedule-timezone" class="modal-form-input" placeholder="e.g., Africa/Cairo" value="UTC">
                </div>

                <div class="modal-actions" style="margin-top: 14px;">
                    <button class="modal-btn" onclick="closeScheduleModal()">Cancel</button>
                    <button class="modal-btn modal-btn-primary" id="schedule-save-btn" onclick="saveSchedule()">Save Schedule</button>
                </div>
                <div id="schedule-status" style="margin-top: 10px; color: var(--text-muted); font-size: 0.85rem;"></div>
            </div>
        </div>
    </div>
</body>
</html>

