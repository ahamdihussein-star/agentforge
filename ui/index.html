<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgentForge - AI Agent Builder</title>
    <link rel="icon" type="image/png" href="/AgentForge_Logo.png">
    <link rel="stylesheet" href="/ui/theme.css?v=20260223d">
    <link rel="stylesheet" href="/ui/index.css?v=3bcda8b">

    <script src="/ui/theme.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- KaTeX for math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    
</head>
<body class="text-white" style="height:100vh;overflow:hidden;margin:0;background:var(--bg-primary);color:var(--text-primary);">

<!-- Tools Action Bar -->
<div id="tools-action-bar" class="hidden fixed top-0 left-0 right-0 shadow-lg z-50 px-4 py-3">
    <div class="max-w-7xl mx-auto flex items-center justify-between">
        <div class="flex items-center gap-3">
            <button onclick="clearToolSelection()" class="p-2 rounded-lg hover:opacity-80">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
            </button>
            <span id="selected-tool-name" class="font-medium">Tool Selected</span>
        </div>
        <div class="flex items-center gap-2">
            <button onclick="viewSelectedTool()" class="action-btn-view flex items-center gap-2 px-4 py-2 rounded-lg transition">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>
                <span>View</span>
            </button>
            <button data-permission="tools:edit" onclick="editSelectedTool()" class="action-btn-edit flex items-center gap-2 px-4 py-2 rounded-lg transition">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>
                <span>Edit</span>
            </button>
            <button data-permission="tools:create" onclick="duplicateSelectedTool()" class="action-btn-duplicate flex items-center gap-2 px-4 py-2 rounded-lg transition">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
                <span>Duplicate</span>
            </button>
            <button data-permission="tools:delete" onclick="deleteSelectedTool()" class="action-btn-delete flex items-center gap-2 px-4 py-2 rounded-lg transition">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                <span>Delete</span>
            </button>
        </div>
    </div>
</div>
</div>
    <!-- Loading Screen -->
    <div id="loading-screen">
        <img src="/AgentForge_Logo.png" alt="AgentForge" class="w-20 h-20 rounded-xl mb-4 animate-pulse">
        <p class="text-gray-400">Loading...</p>
    </div>
    <!-- Login Page - Shown when not authenticated -->
    <section id="page-login" class="min-h-screen py-8 px-4 overflow-y-auto">
        <div id="auth-container" class="w-full max-w-md mx-auto">
            <!-- Logo -->
            <div class="text-center mb-8">
                <div class="inline-flex items-center gap-3 mb-4">
                    <img src="/AgentForge_Logo.png" alt="AgentForge" class="w-16 h-16 rounded-xl">
                    <h1 class="text-3xl font-bold gradient-text">AgentForge</h1>
                </div>
                <p class="text-gray-400">Enterprise AI Agent Platform</p>
            </div>
            
            <!-- Login Form -->
            <div class="card rounded-2xl p-8">
                <h2 class="text-xl font-bold mb-6">Welcome Back</h2>
                
                <!-- OAuth Buttons -->
                <div class="space-y-3 mb-6">
                    <button onclick="oauthLogin('google')" class="w-full flex items-center justify-center gap-3 px-4 py-3 rounded-lg border border-gray-600 hover:bg-gray-700 transition">
                        <svg width="20" height="20" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                        <span>Continue with Google</span>
                    </button>
                    <button onclick="oauthLogin('microsoft')" class="w-full flex items-center justify-center gap-3 px-4 py-3 rounded-lg border border-gray-600 hover:bg-gray-700 transition">
                        <svg width="20" height="20" viewBox="0 0 23 23"><path fill="#f35325" d="M1 1h10v10H1z"/><path fill="#81bc06" d="M12 1h10v10H12z"/><path fill="#05a6f0" d="M1 12h10v10H1z"/><path fill="#ffba08" d="M12 12h10v10H12z"/></svg>
                        <span>Continue with Microsoft</span>
                    </button>
                </div>
                
                <!-- Divider -->
                <div class="flex items-center gap-4 mb-6">
                    <div class="flex-1 h-px bg-gray-600"></div>
                    <span class="text-sm text-gray-400">or sign in with email</span>
                    <div class="flex-1 h-px bg-gray-600"></div>
                </div>
                
                <form id="login-form" onsubmit="handleLogin(event)">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm text-gray-400 mb-2">Email</label>
                            <input type="email" id="login-email" required
                                   class="input-field w-full px-4 py-3 rounded-lg"
                                   placeholder="you@company.com">
                        </div>
                        
                        <div>
                            <label class="block text-sm text-gray-400 mb-2">Password</label>
                            <div class="relative">
                                <input type="password" id="login-password" required
                                       class="input-field w-full px-4 py-3 pr-12 rounded-lg"
                                       placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                                <button type="button" onclick="togglePassword('login-password', this)" 
                                        class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-white p-1">
                                    <span class="eye-icon"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"/><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"/></svg></span>
                                </button>
                            </div>
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="login-remember" class="rounded">
                                <span class="text-sm text-gray-400">Remember me</span>
                            </label>
                            <button type="button" onclick="showForgotPassword()"
                                    class="text-sm text-purple-400 hover:text-purple-300">
                                Forgot password?
                            </button>
                        </div>
                        
                        <button type="submit" id="login-btn"
                                class="btn-primary w-full py-3 rounded-lg font-semibold">
                            Sign In
                        </button>
                    </div>
                </form>
                
                <!-- Register Link -->
                <p class="text-center text-gray-400 text-sm mt-6" id="register-link">
                    Don't have an account? 
                    <button onclick="showRegister()" class="text-purple-400 hover:text-purple-300">
                        Sign up
                    </button>
                </p>
            </div>
            
            <!-- Footer -->
            <p class="text-center text-gray-500 text-xs mt-8">
                AgentForge Enterprise v3.2
            </p>
        </div>
    </section>

    <!-- Main Application - Hidden until authenticated -->
    <div id="app" class="flex hidden" style="height:100vh;max-width:100vw;overflow:hidden;">
        <!-- Desktop Sidebar -->
        <aside class="desktop-sidebar w-64 border-r border-gray-800 flex-col hidden md:flex" style="background:var(--sidebar-bg);">
            <div class="p-4 border-b border-gray-800">
                <div class="flex items-center gap-3">
                    <img src="/AgentForge_Logo.png" alt="AgentForge" class="w-10 h-10 rounded-lg">
                    <div>
                        <h1 class="text-lg font-bold gradient-text">AgentForge</h1>
                        <p class="text-xs text-gray-500">AI Agent Builder</p>
                    </div>
                </div>
            </div>
            <nav class="flex-1 p-3 space-y-1">
                <button onclick="navigate('dashboard')" id="nav-dashboard" class="sidebar-item active w-full text-left px-4 py-3 rounded-lg flex items-center gap-3 transition">
                    <span>üè†</span><span>Dashboard</span>
                </button>
                <button onclick="navigate('chat')" id="nav-chat" data-permission="chat:use" class="sidebar-item w-full text-left px-4 py-3 rounded-lg flex items-center gap-3 transition">
                    <span>üí¨</span><span>Chat</span>
                </button>
                <button onclick="navigate('agents')" id="nav-agents" data-permission="agents:view" class="sidebar-item w-full text-left px-4 py-3 rounded-lg flex items-center gap-3 transition">
                    <img src="data:image/png;base64,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" alt="" class="w-5 h-5 nav-icon"><span>Agent Hub</span>
                </button>
                <button onclick="navigate('tools')" id="nav-tools" data-permission="tools:view" class="sidebar-item w-full text-left px-4 py-3 rounded-lg flex items-center gap-3 transition">
                    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAIAAAAlC+aJAAAR50lEQVR42mVaa8xmV1V+nrXP+37fNzO9TAco7bQBKmgNtwClchMRAUFAioBVlIJggpqQcgmYECVEQEOieIshoiYm0ER+WISSAsGWqYIpBRMJRg1IUi7pgIW207l+33f2evyx1t5nv9NJO/NeznvO2uv6rGctbm0dIQFBABkv43/Ev4xXzH8BKT8jwPhYiu+XzwGAAti/yxcC4ADbMxRfaXgd35HMj9udlj9NSkFT/DAvUBcOwyn6jyBAEhl3R74jSSiOLwnxFoQBENsD44gkZMo7SiIYj/R+WcoWWovHUAjJuOiXAMFpkQ4byhzEZugjpWbJ39NAKs4c904JOeosjoFFpiY62JQVOre8Z0ooEFToFgQ9T6Bu3HjCNEo6/psCpQ7YLNKlM5BNdBDMYzcfBNk1modpjqS8h6v9sh2uGQbez9sO27SqDY9WOwAXh1fTXhqMgkgClEQaUqimYjaPh8XvSVN3vri+X5uOFIc0dodNx0m3ZNxfItO7l/tluKpH29SsqDxiuGAqNq63Jqr1i9TCFyBpmQLimnDCZpnmBSn+YOL4Uuin6raRkFpTu/lmkAo9IUxNN3FydL22dwZJEGmgDfbj4GfLgQHmVcznESYKEhcfC0G0+EK6U4gWIhKLLN0KYRQtDx9ioOfAfhYC1jRB0NpJ2SWX2pUtiLWk4h5U8Z5LeHSxMs2GOZnJdPz1EH4i6OCSnvLPhOa5S66kMQ6bwWBNDnYH607NOJgAIyM5NHkyCZCCczM/RMyAgjzspq5FOYfCJIjhLpLSN8JM+dhp8dAlCearHgzNn22pbmRGqIV9msQkXKnQSItGuPcqkvfVUL/Orz3WnujKAoANi2W68gidKfWcOZHKYLIQj8vBTM1tsnS1IIuzhXSZXdEObySIYqlRCJJC9QDlFOQaqpRntQRpxgwVb5mZITeIcG8IE5bC2bIYw2iREtJ/NCQdLGFastJZ3MJIw5I5jcbFXyXIW3oXJZnRAfNelkSD+yYOIEFl6KbtpVYrgCmdCqMnWQZcSj/iiY5zSqt0kVtJa6FCg/XibUvQyeHNueMkarjHAImKDB+qVQt5gUv4p6RhewDUpCFbNdHJdPd0bgmUQCPb8TI1USRo4f20otA4jTSaiTCy0Ko7ISPn/X3I4QY55PDw+TQ9JGaIquEyQen+AklvZ4i3nAgOXpVnyHzSEAItIwS0IY0aMhhsSb5maY2yQimllLN7e/u7dXXhof29GXt7F2wf8N2zgEugg0aJkkeagREuUIDH/QSLTNX8sCM6xRGnFDeqc4ZDpu1Weiwdo8PrpmMQMIPZkr1pMMO0AqeyKqf2/eonPuHdv/3aRx29dH9//vhn7vjIxz55CKh75+gEKXeIFOEZvjTIvXmBCMmYvhcBxDHrs0zToQWHpdDWMybMIv/kYYywtAPNUKa4ADSwsBjLxGnitCplOlv9KU9/yq0fef+xr/znRz5+63/dfc/bXv/KJ179Y5+846s7pciHFgSZPEJIjkUpMz6zRDEzOBOYkds7j2yA2Zo3mzigg+biG6LHV1YI0orMANAKpglWWKYyTadYjt30oZtvu/NDf/HRAxcdPLu7d+jIJf/+Dx962wf/5nOfue0gve7tep3hFRJqBVz5IhMupPyw/5eB7VL4WAPrCfcTDmjAkhzyj0GMc6rHgzHMaqt12dqa1lurra3VemtmedxjH3PxBQduuvWOSy572M7W6pGHLzj5o/s+cfudL3rWU5xltb1TVutpWk3TilZYJsAY6T+sit6ZLTW0Y9duuWmBIkNn1qEDIqtmYKeLZ0BbyXRkhWXianVqz+v+DHOsDOLx+0+eObe3s5rO7O5PhhkO6eDO+u7jP/LTu/dBvlcxO2o9uI4AKxQDMGRFy2Q1luIGkVpDOjWYwAZCDb2TaM5HM8GyBct6NS0eNU22Wu9P6xc+79qjRy+tIsxodnp37+GXXHTja1/2tg/89cMvOri3t3/06KW/9pLnfvifbr/+ja8+sF7JndT9P7zvn2/7Fz95KqoyEImIZEEhKgRPFEGDHHlFwvBJHUkuRWqEawyVMzNMs0MUByOtTKvVyd35da966e+/5Ya7vv7N7a1VKMxrvfNr3/ifu49vba1dAg3VP3bLscdd/vCrr7g07n3u3N7VV1357Kc9/l2/98cXTGWeHU5wXpRoBU6gprwKmyxoYmqoJmHtgoHZ2zgQEcFIxSTssZZtrXp96hOv/vjnvvTud//pdOTi2T2AjU3TZHZoa+0+F+r0yVM3vu+vBJM7VEno5OmXveYX3vG6X9RqLT/XkIBRkPdjhFcZmuIDukV9m1qsjN5vrYUlQC3xPQR0pCwrGdDTtFt9vV5Nhy84cmirZn9C0STVeYZXyQke3t4KJkBeCnHCcHBn68zuHkqBDGaoNV2cbFmUge3TfXpPo6WpTw/R2N2oEz9qJcbyPGap+mKwAivIylZmm6p79WR1hMrOqbBAqF6T7XHBMFdJMDP056QePStruH9rkRsSWhqbCWZDhY3eYgN4pvfT5FocyQpLKdNkZVXW62neG3JviRY79JxtmpE0uNNAgWYQDJpmmRmHStoSSmDu9jc8mmMOfAFJyKfGlLAjqmyFezmMYjzg4oAPZZpOnN1HwWTTfHp3331lDq8tCcYDApJbh/hmE4AfPXiKVkrhfHZvFtwFK2HYSBtw7zoONioZrrEFBwBOWS00wCQO4DlQky2IraeeE3v1upe/4A2vfvHFFx763Je/fsnFF54+eRrV5a7AxraQXMp0XESenuvv3PDK655/7aqUf7z9y2fmur2e4B4RBYqKvqojMbXsmcifNCkL9tSIl0Dl2ZQRAxOq7HTSuDQr5cHd+b2/++Ybrnvhn330U/93/4mXPffpL33uNTd+8O9Kgdc5Erkq2K0HmtGKndivf/u+tzz+qiv+/KZP1+qveeEzn/C4R/39zZ83n1migTbBw50aVdQCN0MXLl+Ytu2DVy7AIdQcxEjWWmNEGAvNYMWm6WzV055xzc0fft8zfvXt3/3Wt6ftrUr7yauuPP6DH9Z5n40sjF9ZKeG2U5nuP3P2V17+s+958/VPvv4d5x48weplvb7ysiM/uOd42dv1eR/zvuoMd7mn1iV5ldf2iZAWzgumyG6JC9CQYOtfFzRB0kyAGefTu6/4uWd++thd3/3m3Zc94vB+rbDynW9/r5QykNqMRC3UBrQ079eXPOepH/vsF8+ePHnZhQfnefa53vu94yt4KFtaqpAUoE0Ln4iBvUyYqoY0E2lnrYJZI4KUbbwtdkR1I+d5hly1BjAupdjIOLggJyB3rzUCA5JLRsIXTvXcfp0dCTvZDuIVUQ0bE9AA0GYWStV2/n4hSRsUTdrH5YiOyd3L1urWY3e99HnXXnLF5d9/8MyD5/Z/eOrsoUsOzyzjmCBDS4JcXr3WyXjLsa/8+kuec+jiC+954NS9J8+eRXn+837q8CMeNrtCc1lzWq0UGhPaaHdtUNFWpvVF2ciMoZs9rkXxSgjUauDWzs43v3PPVY+58g9ufP29p3cfcemRd/3ma/7knW/61vF7v/bf/7s9lY7ge3ECKWFna/W1b3znyVc/+j2/dX0ln/akn/jAW1//G6960RWXX3rzZ/91x7K3TJYr7rCQ1EnrbpD1UJnWFzXM3fFcVKuSCCKzG/plArbX61vu+OrsesN1z//5Zz/1G9/9/r0nTh05fNFnvnDXgZW5N4s/RJT1ZJ+4/cvn9uZX/Mw1P/6oy2/69LFb/u0/XnDtkz76qdu2NGvez85R3e+VCdU9O7JF/4LA7YNXtCpsDSFHqi1gyU+sJJSwIgFWbLWKUsD11oEDB07fe+KP/vCt02r9zvf+5eFtq7UuxE6LLpqJFknugVPnkv85c+6Xb/ilN77yBS9+3dsvrOd8rvIKSV4TCdUZqgDkDq+ReRA1PrJQ9uKdPoFgBsGlpKi7GC6gwkoQZHWeL97ZAlF8f/fQ1vZ6NdeKeQ9aB5eYPE9OmygHKJFyHD6wDgr2AetIia0cpQXayCNSgrfC2qYh7ftpaMc4uJcBkiocLESk2rgo/btCnOdKM2Ce9+bq6krKRNc586hH8rAASPcUtM77qHMDcYK7vLLPAIL/8eaNUlTptCoIYmrU0eBYjWRl1GYtc4lO/cqdrFCRLKwZTGEpNpVS4Yn8wKHb46I6gZQBhSTp7lGeAjEv7C0cXjlYg5uDR0CTgs5ekJIB1mK6RUcwcGqzuT5H8pkusqDO2ys7eWavnt69byp19mRCgyckcB6zz+YVp86c25sPrFfYOyfWzkVDLnieuA9ggWFGlWloGk+jBZX3YZRD4UKWrLEEdxnAYKMcTtN851e//v63v+nxjzm6Xk/j/YKM9YXtGTt07e7uP/bRRz/1+S9yb5crKsuNoApvfUhKophRJVLMG4hbO0eZcwpTowqD1RABK8nJZUEYcpRZVkMrLNOeTT/9rGuOHr2sSmZBMSWiUFDz0Yw3UjBeG/nAiRO3feFLOnUSdW5RFALXRmg7BMRbQHK4twmOc3vn8uRl+0ApuqeYdpmBpTUGBEvMD6zECS1xhxUr5fTuvqsB+sbLNw/oSMThLQ00+uTgylBnuKRMA2pcPDNjBtTAcqRm5CnbAYn0YXqWM064o1gOW7UwHnI13GNBxTr80LoshOnSJ3FjCup09wSsEmTwWud9uTMiV8qWsXPUGkdKmRfic0lTm4sELloGODkEEFTnhNluooOA5ZIAzOJlaGuuNUm1TrqE9WidJAx418RKeAw5O9hvkcYG4obepA/pO7BLC2TxoPr8a6kIra2g4JBxzFmZ+NgGW95CzglQBaoxFZM7MoV7rj64L4sRIBafiWZAI5XYZ2pobtQx+7Sx/tGt0+a0jRIVVBlwX2gEmkWNVKw4xNjEK1CDNWINAhreVjrSVvEnupbIs1G/QuVycBT6vK0TKXNAumaZVofGNrkPBdo8vrWmfQthuXvDWzFoaXCN4QBxzmijwkm6Ut3hgtdUUbRXWBA/N6C/2mpNz0jqWysA+gE21j24zJIb7UWDlhWLvm6gGCGy8eDjrWIXJyXr9V8t2Tew2douSILDnX38CrUa4EsoUxwI3uEAS5kMDr2fggvKbsP1VovUEJL13adkZ5qz9bMkPHJvOxFtTyXtk/V1GGmGrw+f5HnSD+OYkzqHE87QNnbYZs658SDPKTK8sX6ebCsJr7mVEQyPGv3ajtj0hw7T2r5E+lJnzhuAzQM3NLrhSFwIU5XVdHDYPeDG3lAnfYf5ah90c+zthL5PkByqu1S78siHbIBlAHhsh2x6mjC2LMNPhmjJt9OwkKPhKd4nhpstXHcSizZxGYLmvhCExb6CU9xQ8Ii8BlmlpUvsTjI6UneFRghkqZvGIfe4cINxhSqXj3KQmSBvWV1iwhLYAjMbeu4t3pI9pcWPlj2PRcqNIrCRP32zpAW1yDEl5GQ/ynNLmdanVdk5dC6v7Wo1h1qaYKYKDaxZ5jUuvSk3oRIBqy0Ugl3l0qYrPdTBCHmZyoFhC5BY9vfi7jYcdwA4jTXJDq8TMyOJ0O2cmlta9SV9YXAbjFSARo9qcDoqt8bea+qRO7C/seHTh219H0iA5UJD32NBf2TjlHIPJncam4je8m+AB9fg+Fwq7gjdYkqQNWGgp5eIWtYux73TXORA36fKTdB+k4yWzW3XhYpMbWiRaYksBZPZv9UQvI3V2ggJdSzE86XvLeWwK9m2VjUA4LZk4BgGgW3DRS3d1ozYxmNIc+PCNjpCaURnG3tlQt1woax+PuyjaSO1dBda/IRY6gjt/AS6rDxaZ0BiTagRfqaxYLn6+t3Y2y67ltpAO9iouG1vmYuhliWOgXIp07TTeOlhJYhj99DiNSuxeF45ksYN1V6FGxbCMPpq2uWySbCRJMZpfMcRC8hbtqa7ZnPE1MQfxUnIE8UhuJQRwrR1yN52ezQuA4uNBeH0RfAFGozB4Ysx2u04EKBccunmPmbbG9WSUQbwtaCoXNhVX/Nst+3BE2tWtS9f9qgdVtJ9JGUH3KIGzpeVdqo3kep7K+POVq9/ZZoOjDMxLisG5/Fcy1Jpi3adtyN+/jstdtzE9y1wh28pCUHp6SGoKRXAjRqcz/t/IY2ITnCjTaYAAAAASUVORK5CYII=" alt="" class="w-5 h-5 nav-icon"><span>Tools</span>
                </button>
                <button onclick="navigate('create')" id="nav-create" data-permission="agents:create" class="sidebar-item w-full text-left px-4 py-3 rounded-lg flex items-center gap-3 transition">
                    <img src="data:image/png;base64,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" alt="" class="w-5 h-5 nav-icon"><span>AgentForge Studio</span>
                </button>
                <button onclick="window.location.href='/lab'" id="nav-demo" data-permission="demo:access" class="sidebar-item w-full text-left px-4 py-3 rounded-lg flex items-center gap-3 transition">
                    <span>üß™</span><span>Lab</span>
                    <span class="ml-auto text-xs bg-green-500/20 text-green-400 px-2 py-0.5 rounded">New</span>
                </button>
                <button onclick="navigate('settings')" id="nav-settings" data-permission="system:settings" class="sidebar-item w-full text-left px-4 py-3 rounded-lg flex items-center gap-3 transition">
                    <span>‚öôÔ∏è</span><span>Settings</span>
                </button>
                <button onclick="navigate('security')" id="nav-security" data-permission="users:view,roles:view,system:admin" class="sidebar-item w-full text-left px-4 py-3 rounded-lg flex items-center gap-3 transition">
                    <span>üîê</span><span>Security</span>
                </button>
            </nav>
            
            <!-- User Profile -->
            <div class="p-4 border-t border-gray-800">
                <div onclick="navigate('profile')" title="View Profile" class="flex items-center gap-3 mb-3 cursor-pointer hover:bg-gray-800/50 p-2 rounded-lg transition group">
                    <div id="user-avatar" class="w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center font-bold text-white">?</div>
                    <div class="flex-1 min-w-0">
                        <p id="user-name" class="text-sm font-medium truncate">Loading...</p>
                        <p id="user-email" class="text-xs text-gray-500 truncate">Click to view profile</p>
                    </div>
                    <span class="text-gray-500 group-hover:text-purple-400 transition">‚ñ∏</span>
                </div>
                <button onclick="logout()" class="w-full text-left px-4 py-2 rounded-lg text-sm text-gray-400 hover:bg-gray-800 hover:text-white transition flex items-center gap-2">
                    <span>üö™</span><span>Logout</span>
                </button>
            </div>
            
            <div class="p-4 border-t border-gray-800">
                <p class="text-xs text-gray-500 text-center">AgentForge v3.2</p>
            </div>
        </aside>

        <!-- Mobile Header -->
        <div class="md:hidden fixed top-0 left-0 right-0 border-b border-gray-800 z-50 px-4 py-3 flex items-center justify-between" style="background:var(--sidebar-bg);">
            <div class="flex items-center gap-2">
                <img src="/AgentForge_Logo.png" alt="AgentForge" class="w-8 h-8 rounded-lg">
                <span class="gradient-text font-bold">AgentForge</span>
            </div>
            <button onclick="navigate('create')" class="btn-primary px-3 py-1.5 rounded-lg text-sm" data-permission="agents:create">+ Create</button>
        </div>

        <!-- Main Content -->
        <main class="flex-1 flex flex-col" style="min-width:0;height:100%;max-height:100%;padding-top:0;" id="main-content">
            
            <!-- Dashboard Landing Page -->
            <section id="page-dashboard" class="flex-1 overflow-y-auto overflow-x-hidden">
                <!-- Hero Section -->
                <div class="dash-hero">
                    <!-- Floating decorative nodes -->
                    <div class="dash-node" style="width:12px;height:12px;background:var(--accent-primary);top:20%;left:15%;animation-delay:0s;"></div>
                    <div class="dash-node" style="width:8px;height:8px;background:var(--success);top:60%;left:80%;animation-delay:1s;"></div>
                    <div class="dash-node" style="width:16px;height:16px;background:var(--accent-secondary);top:30%;right:25%;animation-delay:2s;"></div>
                    <div class="dash-node" style="width:10px;height:10px;background:var(--warning);bottom:25%;left:40%;animation-delay:0.5s;"></div>
                    
                    <div class="dash-title" style="margin-bottom:8px;">
                        <div style="font-size:0.8rem; color:var(--accent-primary); font-weight:600; letter-spacing:0.1em; text-transform:uppercase; margin-bottom:12px;">Welcome to</div>
                        <h1 style="font-size:2.8rem; font-weight:800; color:var(--text-primary); line-height:1.1; margin:0;">
                            Agent<span style="background:var(--accent-gradient);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;">Forge</span>
                        </h1>
                    </div>
                    <p class="dash-subtitle" style="font-size:1.1rem; color:var(--text-secondary); max-width:500px; margin-top:12px; line-height:1.6;">
                        Build, deploy, and manage intelligent AI agents that transform how your organization works.
                    </p>
                    
                    <!-- Quick Stats -->
                    <div class="dash-stats" style="display:flex; gap:16px; margin-top:32px; flex-wrap:wrap;">
                        <div class="dash-stat-card">
                            <div class="dash-stat-num" id="dash-stat-agents">0</div>
                            <div><div style="font-size:0.8rem; font-weight:600; color:var(--text-primary);">Agents</div><div style="font-size:0.7rem; color:var(--text-muted);">Published</div></div>
                        </div>
                        <div class="dash-stat-card">
                            <div class="dash-stat-num" id="dash-stat-tools">0</div>
                            <div><div style="font-size:0.8rem; font-weight:600; color:var(--text-primary);">Tools</div><div style="font-size:0.7rem; color:var(--text-muted);">Connected</div></div>
                        </div>
                        <div class="dash-stat-card">
                            <div class="dash-stat-num" id="dash-stat-users">0</div>
                            <div><div style="font-size:0.8rem; font-weight:600; color:var(--text-primary);">Users</div><div style="font-size:0.7rem; color:var(--text-muted);">Active</div></div>
                        </div>
                    </div>
                </div>
                
                <!-- Quick Actions Grid -->
                <div class="dash-grid">
                    <h2 style="font-size:1.1rem; font-weight:700; color:var(--text-primary); margin-bottom:20px;">Quick Actions</h2>
                    <div style="display:grid; grid-template-columns:repeat(auto-fill, minmax(260px, 1fr)); gap:20px;">
                        <div class="dash-card" onclick="navigate('create')">
                            <div class="dash-card-icon" style="background:color-mix(in srgb, var(--accent-primary) 15%, transparent);"><span>ü§ñ</span></div>
                            <div style="font-size:1rem; font-weight:700; color:var(--text-primary); margin-bottom:6px;">Create AI Agent</div>
                            <div style="font-size:0.8rem; color:var(--text-muted); line-height:1.5;">Create an intelligent digital Conversational or Process AI agent that can understand, decide, and take action across your systems.</div>
                        </div>
                        <div class="dash-card" onclick="navigate('agents')">
                            <div class="dash-card-icon" style="background:color-mix(in srgb, var(--accent-secondary) 15%, transparent); animation-delay:0.5s;"><span>üîó</span></div>
                            <div style="font-size:1rem; font-weight:700; color:var(--text-primary); margin-bottom:6px;">Agent Hub</div>
                            <div style="font-size:0.8rem; color:var(--text-muted); line-height:1.5;">Manage, configure, and monitor all your published AI agents.</div>
                        </div>
                        <div class="dash-card" onclick="navigate('chat')">
                            <div class="dash-card-icon" style="background:color-mix(in srgb, var(--success) 15%, transparent); animation-delay:1s;"><span>üí¨</span></div>
                            <div style="font-size:1rem; font-weight:700; color:var(--text-primary); margin-bottom:6px;">Chat</div>
                            <div style="font-size:0.8rem; color:var(--text-muted); line-height:1.5;">Test and interact with your agents in real-time conversations.</div>
                        </div>
                        <div class="dash-card" onclick="navigate('tools')">
                            <div class="dash-card-icon" style="background:color-mix(in srgb, var(--warning) 15%, transparent); animation-delay:1.5s;"><span>üîß</span></div>
                            <div style="font-size:1rem; font-weight:700; color:var(--text-primary); margin-bottom:6px;">Tools</div>
                            <div style="font-size:0.8rem; color:var(--text-muted); line-height:1.5;">Create APIs, webhooks, and knowledge bases to empower your agents.</div>
                        </div>
                        <div class="dash-card" onclick="window.location.href='/lab'">
                            <div class="dash-card-icon" style="background:color-mix(in srgb, var(--danger) 15%, transparent); animation-delay:2s;"><span>üß™</span></div>
                            <div style="font-size:1rem; font-weight:700; color:var(--text-primary); margin-bottom:6px;">Lab</div>
                            <div style="font-size:0.8rem; color:var(--text-muted); line-height:1.5;">Experiment with agents in a sandbox environment before going live.</div>
                        </div>
                        <div class="dash-card" onclick="navigate('security')">
                            <div class="dash-card-icon" style="background:color-mix(in srgb, var(--accent-primary) 10%, transparent); animation-delay:2.5s;"><span>üîê</span></div>
                            <div style="font-size:1rem; font-weight:700; color:var(--text-primary); margin-bottom:6px;">Security</div>
                            <div style="font-size:0.8rem; color:var(--text-muted); line-height:1.5;">Manage users, roles, groups, and enterprise security settings.</div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Agents Page -->
            <section id="page-agents" class="hidden flex-1 overflow-y-auto overflow-x-hidden p-4 md:p-6">
                <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6">
                    <h2 class="text-xl md:text-2xl font-bold flex items-center gap-3">
                        <img src="data:image/png;base64,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" alt="" class="w-7 h-7">
                        <span>Agent Hub</span>
                    </h2>
                    <button onclick="navigate('create')" class="btn-primary px-4 py-2 rounded-lg hidden md:block" data-permission="agents:create">+ Create</button>
                </div>
                
                <div class="flex gap-4 mb-6 border-b border-gray-800 overflow-x-auto">
                    <button onclick="setAgentTab('published')" id="tab-published" class="tab-btn active pb-3 px-2 border-b-2 whitespace-nowrap">Published</button>
                    <button onclick="setAgentTab('draft')" id="tab-draft" class="tab-btn pb-3 px-2 border-b-2 border-transparent whitespace-nowrap">Drafts</button>
                </div>
                
                <!-- Workflow Agents Section -->
                <div id="workflow-agents-section" class="hidden mb-8">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-green-500 to-teal-500 flex items-center justify-center text-xl">üîÑ</div>
                        <div>
                            <h3 class="font-semibold text-lg">Workflow Automations</h3>
                            <p class="text-sm text-gray-400">Automated processes and approval flows</p>
                        </div>
                        <span id="workflow-count" class="ml-auto px-2 py-1 rounded-full bg-green-500/20 text-green-400 text-sm font-medium">0</span>
                    </div>
                    <div id="workflow-agents-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
                </div>
                
                <!-- Conversational Agents Section -->
                <div id="conversational-agents-section" class="mb-8">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center text-xl">üí¨</div>
                        <div>
                            <h3 class="font-semibold text-lg">AI Assistants</h3>
                            <p class="text-sm text-gray-400">Chat-based agents for conversations</p>
                        </div>
                        <span id="conversational-count" class="ml-auto px-2 py-1 rounded-full bg-purple-500/20 text-purple-400 text-sm font-medium">0</span>
                    </div>
                    <div id="conversational-agents-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"></div>
                </div>
                
                <!-- Legacy grid for compatibility -->
                <div id="agents-grid" class="hidden"></div>
            </section>

            <!-- Tools Page -->
            <section id="page-tools" class="hidden flex-1 overflow-y-auto overflow-x-hidden p-4 md:p-6">
                <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6">
                    <h2 class="text-xl md:text-2xl font-bold flex items-center gap-3">
                        <img src="data:image/png;base64,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" alt="" class="w-7 h-7">
                        <span>Tools</span>
                    </h2>
                    <div class="flex gap-2">
                        <button onclick="deleteAllTools()" class="btn-danger px-3 py-2 rounded-lg text-sm" title="Delete all tools">üóëÔ∏è Delete All</button>
                        <button onclick="cleanupDuplicateTools()" class="btn-secondary px-3 py-2 rounded-lg text-sm" title="Remove duplicate tools">üßπ Cleanup</button>
                        <button data-permission="tools:create" onclick="showToolModal()" class="btn-primary px-4 py-2 rounded-lg">+ Create Tool</button>
                    </div>
                </div>
                <div id="tools-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"></div>
            </section>

            <!-- Tool Detail Page -->
            <section id="page-tool-detail" class="hidden flex-1 overflow-y-auto p-4 md:p-6">
                <button onclick="navigate('tools')" class="text-gray-400 hover:text-white mb-4 flex items-center gap-2">
                    <span>‚Üê</span><span>Back to Tools</span>
                </button>
                <div id="tool-detail"></div>
            </section>

            <!-- Settings Page -->
            <section id="page-settings" class="hidden flex-1 overflow-y-auto p-4 md:p-6">
                <h2 class="text-xl md:text-2xl font-bold mb-6">‚öôÔ∏è Settings</h2>
                
                <div class="max-w-4xl space-y-6">
                    <!-- Theme Selection -->
                    <div class="card rounded-xl p-4 md:p-6">
                        <div class="mb-4">
                            <h3 class="text-lg font-semibold flex items-center gap-2">üé® Theme</h3>
                            <p class="text-sm text-gray-400 mt-1">Choose your preferred appearance</p>
                        </div>
                        
                        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3">
                            <!-- Dark Theme -->
                            <button onclick="setTheme('dark')" class="theme-btn group relative rounded-xl p-3 border-2 transition-all hover:scale-105" data-theme-btn="dark">
                                <div class="w-full aspect-square rounded-lg mb-2 overflow-hidden" style="background: linear-gradient(135deg, #0f0f17 0%, #1e1e2e 50%, #667eea 100%)"></div>
                                <span class="text-xs font-medium">Dark</span>
                                <div class="absolute top-1 right-1 w-4 h-4 bg-green-500 rounded-full hidden items-center justify-center theme-check">
                                    <span class="text-white text-xs">‚úì</span>
                                </div>
                            </button>
                            
                            <!-- Light Theme -->
                            <button onclick="setTheme('light')" class="theme-btn group relative rounded-xl p-3 border-2 transition-all hover:scale-105" data-theme-btn="light">
                                <div class="w-full aspect-square rounded-lg mb-2 overflow-hidden" style="background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 50%, #7c3aed 100%)"></div>
                                <span class="text-xs font-medium">Light</span>
                                <div class="absolute top-1 right-1 w-4 h-4 bg-green-500 rounded-full hidden items-center justify-center theme-check">
                                    <span class="text-white text-xs">‚úì</span>
                                </div>
                            </button>
                            
                            <!-- Ocean Theme -->
                            <button onclick="setTheme('ocean')" class="theme-btn group relative rounded-xl p-3 border-2 transition-all hover:scale-105" data-theme-btn="ocean">
                                <div class="w-full aspect-square rounded-lg mb-2 overflow-hidden" style="background: linear-gradient(135deg, #dbeafe 0%, #bae6fd 50%, #6366f1 100%)"></div>
                                <span class="text-xs font-medium">Ocean</span>
                                <div class="absolute top-1 right-1 w-4 h-4 bg-green-500 rounded-full hidden items-center justify-center theme-check">
                                    <span class="text-white text-xs">‚úì</span>
                                </div>
                            </button>
                            
                            <!-- Sunset Theme -->
                            <button onclick="setTheme('sunset')" class="theme-btn group relative rounded-xl p-3 border-2 transition-all hover:scale-105" data-theme-btn="sunset">
                                <div class="w-full aspect-square rounded-lg mb-2 overflow-hidden" style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #f97316 100%)"></div>
                                <span class="text-xs font-medium">Sunset</span>
                                <div class="absolute top-1 right-1 w-4 h-4 bg-green-500 rounded-full hidden items-center justify-center theme-check">
                                    <span class="text-white text-xs">‚úì</span>
                                </div>
                            </button>
                            
                            <!-- Forest Theme -->
                            <button onclick="setTheme('forest')" class="theme-btn group relative rounded-xl p-3 border-2 transition-all hover:scale-105" data-theme-btn="forest">
                                <div class="w-full aspect-square rounded-lg mb-2 overflow-hidden" style="background: linear-gradient(135deg, #0f1f13 0%, #1a3320 50%, #22c55e 100%)"></div>
                                <span class="text-xs font-medium">Forest</span>
                                <div class="absolute top-1 right-1 w-4 h-4 bg-green-500 rounded-full hidden items-center justify-center theme-check">
                                    <span class="text-white text-xs">‚úì</span>
                                </div>
                            </button>
                            
                            <!-- Midnight Theme -->
                            <button onclick="setTheme('midnight')" class="theme-btn group relative rounded-xl p-3 border-2 transition-all hover:scale-105" data-theme-btn="midnight">
                                <div class="w-full aspect-square rounded-lg mb-2 overflow-hidden" style="background: linear-gradient(135deg, #020617 0%, #1e293b 50%, #3b82f6 100%)"></div>
                                <span class="text-xs font-medium">Midnight</span>
                                <div class="absolute top-1 right-1 w-4 h-4 bg-green-500 rounded-full hidden items-center justify-center theme-check">
                                    <span class="text-white text-xs">‚úì</span>
                                </div>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Integrations (OAuth Setup for Admin) -->
                    <div class="card rounded-xl p-4 md:p-6">
                        <div class="mb-4">
                            <h3 class="text-lg font-semibold flex items-center gap-2">üîå Integrations</h3>
                            <p class="text-sm text-gray-400 mt-1">Connect external services for your agents</p>
                        </div>
                        
                        <div class="space-y-4">
                            <!-- Google Integration -->
                            <div class="p-4 rounded-lg" style="background:var(--bg-input);">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 rounded-lg bg-white flex items-center justify-center">
                                            <svg width="24" height="24" viewBox="0 0 24 24">
                                                <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                                                <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                                                <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                                                <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                                            </svg>
                                        </div>
                                        <div>
                                            <h5 class="font-medium" style="color:var(--text-primary);">Google</h5>
                                            <p class="text-xs" style="color:var(--text-muted);" id="google-integration-status">Not configured</p>
                                        </div>
                                    </div>
                                    <button onclick="showIntegrationSetup('google')" class="btn-secondary px-4 py-2 rounded-lg text-sm">
                                        Configure
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Microsoft Integration -->
                            <div class="p-4 rounded-lg" style="background:var(--bg-input);">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 rounded-lg bg-white flex items-center justify-center">
                                            <svg width="21" height="21" viewBox="0 0 21 21">
                                                <rect x="1" y="1" width="9" height="9" fill="#F25022"/>
                                                <rect x="11" y="1" width="9" height="9" fill="#7FBA00"/>
                                                <rect x="1" y="11" width="9" height="9" fill="#00A4EF"/>
                                                <rect x="11" y="11" width="9" height="9" fill="#FFB900"/>
                                            </svg>
                                        </div>
                                        <div>
                                            <h5 class="font-medium" style="color:var(--text-primary);">Microsoft</h5>
                                            <p class="text-xs" style="color:var(--text-muted);" id="microsoft-integration-status">Not configured</p>
                                        </div>
                                    </div>
                                    <button onclick="showIntegrationSetup('microsoft')" class="btn-secondary px-4 py-2 rounded-lg text-sm">
                                        Configure
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <p class="text-xs mt-4" style="color:var(--text-muted);">
                            üí° These integrations allow users to connect their accounts with one click when creating Email tools.
                        </p>
                    </div>
                    
                    <!-- Identity & User Directory -->
                    <div class="card rounded-xl p-4 md:p-6" id="settings-identity-card">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <h3 class="text-lg font-semibold flex items-center gap-2">üè¢ Identity & User Directory</h3>
                                <p class="text-sm text-gray-400 mt-1">Choose how user identities, managers, and organizational hierarchy are managed</p>
                            </div>
                            <span id="settings-identity-status" class="px-3 py-1 rounded-full text-xs font-medium bg-yellow-600/20 text-yellow-400">‚öôÔ∏è Setup Required</span>
                        </div>

                        <div class="space-y-4">
                            <!-- Source Selector -->
                            <div>
                                <label class="block text-sm font-medium mb-2">Identity Source</label>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-3" id="settings-identity-sources">
                                    <button onclick="selectIdentitySource('internal')" id="id-src-internal" class="identity-src-btn card rounded-xl p-4 text-left border-2 border-transparent hover:border-purple-500/50 transition-all">
                                        <div class="flex items-center gap-3 mb-2">
                                            <div class="w-10 h-10 rounded-lg bg-purple-600/20 flex items-center justify-center text-xl">üìã</div>
                                            <div>
                                                <div class="font-semibold">Built-in Org Chart</div>
                                                <div class="text-xs text-gray-400">Manage hierarchy within the platform</div>
                                            </div>
                                        </div>
                                        <p class="text-xs text-gray-500">Define departments, assign managers, and employee IDs directly in the platform. Best for small-to-medium organizations or those without an external HR system.</p>
                                    </button>
                                    <button onclick="selectIdentitySource('ldap')" id="id-src-ldap" class="identity-src-btn card rounded-xl p-4 text-left border-2 border-transparent hover:border-purple-500/50 transition-all">
                                        <div class="flex items-center gap-3 mb-2">
                                            <div class="w-10 h-10 rounded-lg bg-blue-600/20 flex items-center justify-center text-xl">üîó</div>
                                            <div>
                                                <div class="font-semibold">LDAP / Active Directory</div>
                                                <div class="text-xs text-gray-400">Azure AD, AD, OpenLDAP</div>
                                            </div>
                                        </div>
                                        <p class="text-xs text-gray-500">Users and their hierarchy are automatically synced from your directory service. Manager relationships and department info come from LDAP attributes.</p>
                                    </button>
                                    <button onclick="selectIdentitySource('hr_api')" id="id-src-hr_api" class="identity-src-btn card rounded-xl p-4 text-left border-2 border-transparent hover:border-purple-500/50 transition-all">
                                        <div class="flex items-center gap-3 mb-2">
                                            <div class="w-10 h-10 rounded-lg bg-green-600/20 flex items-center justify-center text-xl">üèóÔ∏è</div>
                                            <div>
                                                <div class="font-semibold">HR System API</div>
                                                <div class="text-xs text-gray-400">SAP, Oracle HCM, Workday, BambooHR</div>
                                            </div>
                                        </div>
                                        <p class="text-xs text-gray-500">Connect to your HR system's REST API to fetch employee data, organizational structure, and reporting hierarchy in real-time.</p>
                                    </button>
                                    <button onclick="selectIdentitySource('hybrid')" id="id-src-hybrid" class="identity-src-btn card rounded-xl p-4 text-left border-2 border-transparent hover:border-purple-500/50 transition-all">
                                        <div class="flex items-center gap-3 mb-2">
                                            <div class="w-10 h-10 rounded-lg bg-orange-600/20 flex items-center justify-center text-xl">üîÄ</div>
                                            <div>
                                                <div class="font-semibold">Hybrid</div>
                                                <div class="text-xs text-gray-400">Internal + External source</div>
                                            </div>
                                        </div>
                                        <p class="text-xs text-gray-500">Use the built-in org chart as primary, enriched with data from LDAP or HR API. Override external data locally when needed.</p>
                                    </button>
                                </div>
                            </div>

                            <!-- LDAP Info (shown when LDAP selected) -->
                            <div id="settings-id-ldap-info" class="hidden card rounded-lg p-4 bg-blue-600/5 border border-blue-500/20">
                                <div class="flex items-center gap-2 mb-2">
                                    <span class="text-blue-400">‚ÑπÔ∏è</span>
                                    <span class="font-medium text-sm">LDAP Configuration</span>
                                </div>
                                <p class="text-sm text-gray-400 mb-3">LDAP/Active Directory connection is configured in <strong>Security ‚Üí Settings</strong>. User hierarchy (manager, department) will be resolved from LDAP attributes automatically.</p>
                                <button onclick="navigate('security'); setTimeout(()=>switchSecurityTab('settings'), 200)" class="px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white text-sm">Go to Security Settings ‚Üí</button>
                            </div>

                            <!-- HR API Config (shown when HR API or Hybrid selected) -->
                            <div id="settings-id-hr-config" class="hidden space-y-3">
                                <div class="card rounded-lg p-4 bg-green-600/5 border border-green-500/20">
                                    <div class="flex items-center gap-2 mb-3">
                                        <span class="text-green-400">üèóÔ∏è</span>
                                        <span class="font-medium text-sm">HR System API Configuration</span>
                                    </div>
                                    <div class="space-y-3">
                                        <div>
                                            <label class="block text-xs font-medium mb-1">Base URL</label>
                                            <input type="url" id="settings-hr-api-url" class="w-full input-field rounded-lg px-3 py-2 text-sm" placeholder="https://api.hrprovider.com/v1">
                                        </div>
                                        <div class="grid grid-cols-2 gap-3">
                                            <div>
                                                <label class="block text-xs font-medium mb-1">Auth Type</label>
                                                <select id="settings-hr-api-auth" class="w-full input-field rounded-lg px-3 py-2 text-sm">
                                                    <option value="bearer">Bearer Token</option>
                                                    <option value="api_key">API Key</option>
                                                    <option value="oauth2">OAuth 2.0</option>
                                                    <option value="basic">Basic Auth</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label class="block text-xs font-medium mb-1">API Key / Token</label>
                                                <input type="password" id="settings-hr-api-key" class="w-full input-field rounded-lg px-3 py-2 text-sm" placeholder="Enter API key or token">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Internal Info (shown when internal selected) -->
                            <div id="settings-id-internal-info" class="hidden card rounded-lg p-4 bg-purple-600/5 border border-purple-500/20">
                                <div class="flex items-center gap-2 mb-2">
                                    <span class="text-purple-400">üìã</span>
                                    <span class="font-medium text-sm">Built-in Organization Management</span>
                                </div>
                                <p class="text-sm text-gray-400 mb-3">Manage departments, assign managers, and set employee IDs in <strong>Security ‚Üí Organization</strong> tab.</p>
                                <button onclick="navigate('security'); setTimeout(()=>switchSecurityTab('org'), 200)" class="px-4 py-2 rounded-lg bg-purple-600 hover:bg-purple-700 text-white text-sm">Manage Organization ‚Üí</button>
                            </div>

                            <!-- Save Button -->
                            <div class="flex items-center gap-3 pt-2">
                                <button onclick="saveIdentitySettings()" class="px-6 py-2 rounded-lg bg-purple-600 hover:bg-purple-700 text-white text-sm font-medium">Save Identity Settings</button>
                                <span id="settings-identity-saved" class="text-green-400 text-sm hidden">‚úÖ Saved!</span>
                            </div>
                        </div>
                    </div>

                    <!-- LLM Providers Management -->
                    <div class="card rounded-xl p-4 md:p-6">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <h3 class="text-lg font-semibold flex items-center gap-2">üß† LLM Providers</h3>
                                <p class="text-sm text-gray-400 mt-1">Add and manage your AI model providers</p>
                            </div>
                        </div>
                        
                        <!-- Configured Providers Table -->
                        <div id="configured-providers-section" class="mb-6">
                            <h4 class="text-sm font-medium text-gray-300 mb-3">‚úÖ Configured Providers</h4>
                            <div id="configured-providers-table" class="space-y-2">
                                <!-- Will be populated dynamically -->
                                <div class="text-center py-4 text-gray-500 text-sm" id="no-providers-msg">
                                    <span class="text-2xl block mb-2">üì≠</span>
                                    No providers configured yet. Add one below.
                                </div>
                            </div>
                        </div>
                        
                        <!-- Add New Provider Form -->
                        <div class="border-t border-gray-700 pt-4">
                            <h4 class="text-sm font-medium text-gray-300 mb-3">‚ûï Add New Provider</h4>
                            <div class="grid md:grid-cols-2 gap-4">
                                <div>
                                    <label class="text-sm text-gray-400 mb-1 block">Provider</label>
                                    <select id="llm-provider" class="input-field w-full rounded-lg px-4 py-2" onchange="onLLMProviderChange()">
                                        <optgroup label="Cloud Providers">
                                            <option value="openai">OpenAI (GPT-4o, GPT-4)</option>
                                            <option value="anthropic">Anthropic (Claude)</option>
                                            <option value="google">Google (Gemini)</option>
                                            <option value="xai">xAI (Grok)</option>
                                            <option value="groq">Groq (Fast Inference)</option>
                                            <option value="mistral">Mistral AI</option>
                                            <option value="deepseek">DeepSeek</option>
                                            <option value="together">Together AI</option>
                                            <option value="perplexity">Perplexity</option>
                                            <option value="cohere">Cohere</option>
                                        </optgroup>
                                        <optgroup label="Enterprise">
                                            <option value="azure_openai">Azure OpenAI</option>
                                            <option value="aws_bedrock">AWS Bedrock</option>
                                        </optgroup>
                                        <optgroup label="Local / Self-hosted">
                                            <option value="ollama">Ollama (Local)</option>
                                            <option value="lmstudio">LM Studio</option>
                                            <option value="custom">Custom OpenAI-compatible</option>
                                        </optgroup>
                                    </select>
                            
                                </div>
                                <div id="llm-api-key-group">
                                    <label class="text-sm text-gray-400 mb-1 block">API Key</label>
                                    <input type="password" id="llm-api-key" class="input-field w-full rounded-lg px-4 py-2" placeholder="Enter your API key...">
                                </div>
                                <div id="llm-api-base-group" class="hidden">
                                    <label class="text-sm text-gray-400 mb-1 block">API Base URL</label>
                                    <input type="text" id="llm-api-base" class="input-field w-full rounded-lg px-4 py-2" placeholder="https://api.example.com/v1">
                                </div>
                                <div id="llm-resource-group" class="hidden">
                                    <label class="text-sm text-gray-400 mb-1 block">Resource Name / Deployment</label>
                                    <input type="text" id="llm-resource" class="input-field w-full rounded-lg px-4 py-2" placeholder="my-resource">
                                </div>
                            </div>
                            
                            <!-- Provider Info -->
                            <div id="llm-provider-info" class="mt-3 p-3 bg-gray-800/50 rounded-lg text-xs">
                                <p id="llm-provider-info-text" class="text-gray-400">Select a provider to see supported models and pricing info.</p>
                                <a id="llm-provider-link" href="#" target="_blank" class="text-purple-400 hover:text-purple-300 mt-1 inline-block hidden">Get API Key ‚Üí</a>
                            </div>
                            
                            <!-- Supported Models Preview -->
                            <div id="llm-models-preview" class="mt-3 hidden">
                                <label class="text-xs text-gray-400 mb-2 block">Supported Models:</label>
                                <div id="llm-models-list-preview" class="flex flex-wrap gap-1">
                                    <!-- Model tags will be added here -->
                                </div>
                            </div>
                            
                            <div class="flex gap-2 mt-4">
                                <button onclick="addLLMProvider()" class="btn-primary px-4 py-2 rounded-lg text-sm flex items-center gap-2">
                                    <span>‚ûï</span> Add Provider
                                </button>
                                <button onclick="testNewLLMProvider()" class="btn-secondary px-4 py-2 rounded-lg text-sm flex items-center gap-2">
                                    <span>üß™</span> Test Connection
                                </button>
                            </div>
                            <div id="llm-test-result" class="hidden mt-3 p-3 rounded-lg text-sm"></div>
                        </div>
                    </div>

                    <!-- Default LLM Selection -->
                    <div class="card rounded-xl p-4 md:p-6">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <h3 class="text-lg font-semibold flex items-center gap-2">‚≠ê Default LLM</h3>
                                <p class="text-sm text-gray-400 mt-1">Select the default model for agent chat and platform features</p>
                            </div>
                        </div>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Default Provider</label>
                                <select id="default-llm-provider" class="input-field w-full rounded-lg px-4 py-2" onchange="onDefaultProviderChange()">
                                    <option value="">-- Select Provider --</option>
                                    <!-- Populated from configured providers -->
                                </select>
                            
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Default Model</label>
                                <select id="default-llm-model" class="input-field w-full rounded-lg px-4 py-2">
                                    <option value="">-- Select Model --</option>
                                </select>
                            
                            </div>
                        </div>
                    </div>

                    <!-- Embedding Provider -->
                    <div class="card rounded-xl p-4 md:p-6">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <h3 class="text-lg font-semibold flex items-center gap-2">üìê Embedding Provider</h3>
                                <p class="text-sm text-gray-400 mt-1">Configure embeddings for semantic search</p>
                            </div>
                            <button onclick="testEmbedding()" class="btn-secondary px-3 py-1.5 rounded-lg text-sm">üß™ Test</button>
                        </div>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Provider</label>
                                <select id="emb-provider" class="input-field w-full rounded-lg px-4 py-2" onchange="onEmbeddingProviderChange()">
                                    <option value="openai">OpenAI Embeddings</option>
                                    <option value="sentence_transformers">Sentence Transformers (Local)</option>
                                    <option value="ollama">Ollama Embeddings</option>
                                </select>
                            
                            </div>
                            <div id="emb-model-group">
                                <label class="text-sm text-gray-400 mb-1 block">Model</label>
                                <select id="emb-model" class="input-field w-full rounded-lg px-4 py-2">
                                    <option value="text-embedding-3-small">text-embedding-3-small (1536 dim)</option>
                                    <option value="text-embedding-3-large">text-embedding-3-large (3072 dim)</option>
                                    <option value="text-embedding-ada-002">text-embedding-ada-002 (1536 dim)</option>
                                </select>
                            
                            </div>
                            <div id="emb-local-model-group" class="hidden">
                                <label class="text-sm text-gray-400 mb-1 block">Local Model</label>
                                <select id="emb-local-model" class="input-field w-full rounded-lg px-4 py-2">
                                    <option value="all-MiniLM-L6-v2">all-MiniLM-L6-v2 (384 dim, Fast)</option>
                                    <option value="all-mpnet-base-v2">all-mpnet-base-v2 (768 dim, Better)</option>
                                    <option value="paraphrase-multilingual-MiniLM-L12-v2">Multilingual (384 dim)</option>
                                </select>
                            
                            </div>
                            <div id="emb-api-key-group">
                                <label class="text-sm text-gray-400 mb-1 block">API Key</label>
                                <input type="password" id="emb-api-key" class="input-field w-full rounded-lg px-4 py-2" placeholder="sk-...">
                            </div>
                        </div>
                        <div id="emb-test-result" class="hidden mt-4 p-3 rounded-lg text-sm"></div>
                    </div>

                    <!-- Vector Database -->
                    <div class="card rounded-xl p-4 md:p-6">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <h3 class="text-lg font-semibold flex items-center gap-2">üóÑÔ∏è Vector Database</h3>
                                <p class="text-sm text-gray-400 mt-1">Configure where embeddings are stored for RAG search</p>
                            </div>
                            <button onclick="reindexKnowledgeBase()" class="btn-secondary px-3 py-1.5 rounded-lg text-sm">üîÑ Reindex</button>
                        </div>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Provider</label>
                                <select id="vdb-provider" class="input-field w-full rounded-lg px-4 py-2" onchange="onVectorDBProviderChange()">
                                    <option value="memory">In-Memory (Keyword Search)</option>
                                    <option value="chromadb">ChromaDB (Local Vector DB)</option>
                                    <option value="pinecone">Pinecone (Cloud)</option>
                                </select>
                            
                            </div>
                            <div id="vdb-chroma-path-group" class="hidden">
                                <label class="text-sm text-gray-400 mb-1 block">Storage Path</label>
                                <input type="text" id="vdb-chroma-path" class="input-field w-full rounded-lg px-4 py-2" placeholder="./data/chromadb">
                            </div>
                            <div id="vdb-pinecone-group" class="hidden col-span-2 grid md:grid-cols-2 gap-4">
                                <div>
                                    <label class="text-sm text-gray-400 mb-1 block">Pinecone API Key</label>
                                    <input type="password" id="vdb-pinecone-key" class="input-field w-full rounded-lg px-4 py-2">
                                </div>
                                <div>
                                    <label class="text-sm text-gray-400 mb-1 block">Index Name</label>
                                    <input type="text" id="vdb-pinecone-index" class="input-field w-full rounded-lg px-4 py-2" placeholder="agentforge">
                                </div>
                            </div>
                        </div>
                        <div class="mt-4 p-3 bg-gray-800 rounded-lg">
                            <div class="flex items-center gap-2 text-sm">
                                <span id="vdb-status-icon">‚ö™</span>
                                <span id="vdb-status-text">Not configured</span>
                            </div>
                        </div>
                    </div>

                    <!-- RAG Settings -->
                    <div class="card rounded-xl p-4 md:p-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">üîç RAG Settings</h3>
                        <div class="grid md:grid-cols-3 gap-4">
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Chunk Size</label>
                                <input type="number" id="rag-chunk-size" class="input-field w-full rounded-lg px-4 py-2" value="1000">
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Chunk Overlap</label>
                                <input type="number" id="rag-chunk-overlap" class="input-field w-full rounded-lg px-4 py-2" value="200">
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Search Results (Top K)</label>
                                <input type="number" id="rag-top-k" class="input-field w-full rounded-lg px-4 py-2" value="5">
                            </div>
                        </div>
                    </div>

                    <!-- Feature Toggles -->
                    <div class="card rounded-xl p-4 md:p-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">üéõÔ∏è Features</h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="font-medium">Enable RAG</p>
                                    <p class="text-sm text-gray-400">Use vector search for knowledge retrieval</p>
                                </div>
                                <div id="toggle-rag" class="toggle-switch on" onclick="toggleFeature('rag')"></div>
                            </div>
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="font-medium">Enable Web Scraping</p>
                                    <p class="text-sm text-gray-400">Allow scraping websites as knowledge sources</p>
                                </div>
                                <div id="toggle-scraping" class="toggle-switch on" onclick="toggleFeature('scraping')"></div>
                            </div>
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="font-medium">Enable API Tools</p>
                                    <p class="text-sm text-gray-400">Allow agents to call external APIs</p>
                                </div>
                                <div id="toggle-api" class="toggle-switch on" onclick="toggleFeature('api')"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Save Button -->
                    <div class="flex justify-end gap-4">
                        <button onclick="loadSettings()" class="btn-secondary px-6 py-2 rounded-lg">Reset</button>
                        <button onclick="saveSettings()" class="btn-primary px-6 py-2 rounded-lg">üíæ Save Settings</button>
                    </div>
                </div>
            </section>

            <!-- Profile Page -->
            <section id="page-profile" class="hidden flex-1 overflow-y-auto p-4 md:p-6">
                <div class="max-w-2xl mx-auto">
                    <h2 class="text-2xl font-bold mb-6 flex items-center gap-3">
                        <span>üë§</span><span>My Profile</span>
                    </h2>

                    <!-- Combined Profile Card -->
                    <div class="card rounded-xl p-6 mb-6">
                        <form id="update-profile-form" class="space-y-5">
                            <!-- Email (Read-only) -->
                            <div>
                                <label class="block text-sm font-medium text-gray-400 mb-2">Email</label>
                                <div class="flex items-center gap-3">
                                    <input type="email" id="profile-email" class="flex-1 input-field rounded-lg px-4 py-2.5" readonly disabled>
                                    <span id="profile-role" class="px-3 py-1 text-xs font-medium rounded-full bg-purple-500/20 text-purple-400 border border-purple-500/30">-</span>
                                </div>
                            </div>
                            
                            <!-- Name Fields -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-400 mb-2">First Name</label>
                                    <input type="text" id="update-first-name" class="w-full input-field rounded-lg px-4 py-2.5" placeholder="Enter first name">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-400 mb-2">Last Name</label>
                                    <input type="text" id="update-last-name" class="w-full input-field rounded-lg px-4 py-2.5" placeholder="Enter last name">
                                </div>
                            </div>
                            
                            <!-- Display Name -->
                            <div>
                                <label class="block text-sm font-medium text-gray-400 mb-2">Display Name</label>
                                <input type="text" id="update-display-name" class="w-full input-field rounded-lg px-4 py-2.5" placeholder="How you want to be called">
                                <p class="text-xs text-gray-500 mt-1">This is the name shown in the app</p>
                            </div>
                            
                            <!-- Member Since -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t border-gray-700">
                                <div>
                                    <label class="block text-sm font-medium text-gray-400 mb-2">Member Since</label>
                                    <p id="profile-created" class="text-base font-medium">-</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-400 mb-2">Account Status</label>
                                    <span class="inline-flex items-center px-3 py-1 text-xs font-medium rounded-full bg-green-500/20 text-green-400 border border-green-500/30">
                                        <span class="w-2 h-2 rounded-full bg-green-400 mr-2"></span>Active
                                    </span>
                                </div>
                            </div>
                            
                            <!-- Save Button -->
                            <div class="flex justify-end pt-2">
                                <button type="submit" class="btn-primary px-6 py-2.5 rounded-lg font-medium">Save Profile</button>
                            </div>
                        </form>
                    </div>

                    <!-- Security Section -->
                    <div class="card rounded-xl p-6 mb-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                            <span>üîê</span><span>Security</span>
                        </h3>
                        
                        <!-- Change Password Button -->
                        <div class="flex items-center justify-between p-4 rounded-lg bg-gray-700/30 border border-gray-600 mb-4">
                            <div>
                                <p class="font-medium">Password</p>
                                <p class="text-sm text-gray-400">Last changed: Never</p>
                            </div>
                            <button onclick="showChangePasswordModal()" class="btn-secondary px-4 py-2 rounded-lg">Change Password</button>
                        </div>

                        <!-- MFA Status -->
                        <div id="mfa-status-container" class="flex items-center justify-between p-4 rounded-lg bg-gray-700/30 border border-gray-600">
                            <div>
                                <p class="font-medium">Two-Factor Authentication</p>
                                <p id="mfa-status-text" class="text-sm text-gray-400">Loading...</p>
                            </div>
                            <div class="flex items-center gap-3">
                                <!-- MFA Toggle Switch -->
                                <button id="mfa-toggle" onclick="toggleMFA()" class="relative inline-flex h-7 w-14 items-center rounded-full transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 focus:ring-offset-gray-800 bg-red-500" data-enabled="false">
                                    <span class="sr-only">Enable MFA</span>
                                    <span id="mfa-toggle-dot" class="inline-block h-5 w-5 transform rounded-full bg-white shadow-lg transition-transform duration-200 translate-x-1"></span>
                                </button>
                            </div>
                        </div>
                    </div>
                        
<!-- Change Password Modal -->
                    <div id="change-password-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center modal-backdrop">
                        <div class="bg-gray-800 rounded-xl p-6 w-full max-w-md mx-4 border border-gray-700">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="text-lg font-semibold text-white flex items-center gap-2">
                                    <span>üîí</span> Change Password
                                </h3>
                                <button onclick="hideChangePasswordModal()" class="text-gray-400 hover:text-white transition">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                    </svg>
                                </button>
                            </div>
                            
                            <form id="change-password-form" class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Current Password</label>
                                    <input type="password" id="current-password" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2.5 text-white" required placeholder="Enter current password">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">New Password</label>
                                    <input type="password" id="new-password" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2.5 text-white" required placeholder="Enter new password">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Confirm New Password</label>
                                    <input type="password" id="confirm-password" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2.5 text-white" required placeholder="Confirm new password">
                                </div>
                                
                                <div id="password-error" class="hidden p-3 bg-red-500/20 border border-red-500/50 rounded-lg text-red-400 text-sm"></div>
                                
                                <div class="flex gap-3 pt-2">
                                    <button type="button" onclick="hideChangePasswordModal()" class="flex-1 btn-secondary px-4 py-2.5 rounded-lg">Cancel</button>
                                    <button type="submit" class="flex-1 btn-primary px-4 py-2.5 rounded-lg">Change Password</button>
                                </div>
                            </form>
                        </div>
                    </div>
                        
                        <!-- Disable MFA Confirmation Modal -->
                        <div id="disable-mfa-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/70">
                            <div class="bg-gray-800 rounded-xl p-6 w-full max-w-md mx-4 border border-gray-700">
                                <div class="flex items-center gap-3 mb-4">
                                    <div class="w-10 h-10 rounded-full bg-red-500/20 flex items-center justify-center">
                                        <svg class="w-5 h-5 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-semibold text-white">Disable MFA</h3>
                                        <p class="text-sm text-gray-400">This will make your account less secure</p>
                                    </div>
                                </div>
                                
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Enter your password to confirm</label>
                                    <div class="relative">
                                        <input type="password" id="disable-mfa-password" 
                                               class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 pr-12 text-white focus:ring-2 focus:ring-red-500 focus:border-transparent" 
                                               placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                                        <button type="button" onclick="togglePasswordVisibility('disable-mfa-password')" 
                                                class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-white transition" title="Show/Hide password">
                                            <span id="disable-mfa-password-icon">
                                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"/>
                                                </svg>
                                            </span>
                                        </button>
                                    </div>
                                </div>
                                
                                <div id="disable-mfa-error" class="hidden mb-4 p-3 bg-red-500/20 border border-red-500/50 rounded-lg text-red-400 text-sm"></div>
                                
                                <div class="flex gap-3">
                                    <button onclick="hideDisableMFAModal()" class="flex-1 px-4 py-2 rounded-lg border border-gray-600 text-gray-300 hover:bg-gray-700 transition">Cancel</button>
                                    <button onclick="confirmDisableMFA()" class="flex-1 px-4 py-2 rounded-lg bg-red-600 text-white hover:bg-red-700 transition">Disable MFA</button>
                                </div>
                            </div>
                        </div>

                        <!-- MFA Setup Modal Content (will be shown in modal) -->
                        <div id="mfa-setup-modal-content" class="hidden">
                            <!-- TOTP Setup -->
                            <div id="totp-setup" class="hidden">
                                <div class="text-center mb-4">
                                    <h4 class="text-lg font-semibold mb-2">Scan QR Code</h4>
                                    <p class="text-sm text-gray-400 mb-4">Scan this QR code with your authenticator app</p>
                                    <div id="qr-code-container" class="flex justify-center mb-4"></div>
                                    <p class="text-xs text-gray-500 mb-2">Or enter this key manually:</p>
                                    <code id="mfa-secret-key" class="bg-gray-700 px-3 py-1 rounded text-sm"></code>
                                </div>
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Verification Code</label>
                                    <input type="text" id="totp-verify-code" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white text-center text-lg tracking-wider" placeholder="000000" maxlength="6" pattern="[0-9]{6}">
                                </div>
                                <button onclick="verifyTOTPSetup()" class="btn-primary w-full py-2 rounded-lg">Verify & Enable</button>
                            </div>

                            <!-- Email Setup -->
                            <div id="email-setup" class="hidden">
                                <div class="text-center mb-4">
                                    <h4 class="text-lg font-semibold mb-2">Verify Email</h4>
                                    <p class="text-sm text-gray-400 mb-4">A verification code has been sent to your email</p>
                                </div>
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Verification Code</label>
                                    <input type="text" id="email-verify-code" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white text-center text-lg tracking-wider" placeholder="000000" maxlength="6" pattern="[0-9]{6}">
                                </div>
                                <div class="flex gap-3">
                                    <button onclick="resendEmailMFACode()" class="btn-secondary flex-1 py-2 rounded-lg">Resend Code</button>
                                    <button onclick="verifyEmailSetup()" class="btn-primary flex-1 py-2 rounded-lg">Verify & Enable</button>
                                </div>
                            </div>
                        </div>
                    </div>
            </section>

            <!-- Approvals Page -->
            <section id="page-approvals" class="hidden flex-1 overflow-y-auto p-4 md:p-6">
                <div class="max-w-6xl mx-auto">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold">Approvals</h2>
                        <p class="text-gray-400 mt-1">Review and act on pending approval requests</p>
                    </div>

                    <!-- Approval Filters -->
                    <div class="flex gap-3 mb-4 flex-wrap">
                        <button onclick="filterApprovals('pending')" id="appr-filter-pending" class="px-4 py-2 rounded-lg bg-yellow-600/20 text-yellow-400 text-sm font-medium">‚è≥ Pending</button>
                        <button onclick="filterApprovals('approved')" id="appr-filter-approved" class="px-4 py-2 rounded-lg hover:bg-gray-700 text-sm">‚úÖ Approved</button>
                        <button onclick="filterApprovals('rejected')" id="appr-filter-rejected" class="px-4 py-2 rounded-lg hover:bg-gray-700 text-sm">‚ùå Rejected</button>
                        <button onclick="filterApprovals('all')" id="appr-filter-all" class="px-4 py-2 rounded-lg hover:bg-gray-700 text-sm">üìã All</button>
                    </div>

                    <!-- Approvals List -->
                    <div id="approvals-list" class="space-y-3">
                        <div class="card rounded-xl p-8 text-center text-gray-500">Loading approvals...</div>
                    </div>

                    <!-- Empty State -->
                    <div id="approvals-empty" class="hidden card rounded-xl p-12 text-center">
                        <div class="text-5xl mb-4">‚úÖ</div>
                        <h3 class="text-xl font-semibold mb-2">No Pending Approvals</h3>
                        <p class="text-gray-400">You're all caught up! No approvals need your attention right now.</p>
                    </div>
                </div>
            </section>

            <!-- Security Center Page -->
            <section id="page-security" class="hidden flex-1 overflow-y-auto p-4 md:p-6">
                <div class="max-w-7xl mx-auto">
                    <!-- Header -->
                    <div class="flex items-center justify-between mb-6">
                        <div>
                            <h2 class="text-2xl font-bold">üîê Security Center</h2>
                            <p class="text-gray-400 text-sm">Manage users, roles, and security settings</p>
                        </div>
                        <button id="invite-user-btn" data-permission="users:invite" onclick="showInviteModal()" class="btn-primary px-4 py-2 rounded-lg">+ Invite User</button>
                    </div>

                    <!-- Stats Cards -->
                    <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6">
                        <div class="card rounded-xl p-4">
                            <div class="text-2xl font-bold text-purple-400" id="sec-stat-users">0</div>
                            <div class="text-sm text-gray-400">Total Users</div>
                        </div>
                        <div class="card rounded-xl p-4">
                            <div class="text-2xl font-bold text-green-400" id="sec-stat-active">0</div>
                            <div class="text-sm text-gray-400">Active</div>
                        </div>
                        <div class="card rounded-xl p-4">
                            <div class="text-2xl font-bold text-blue-400" id="sec-stat-roles">0</div>
                            <div class="text-sm text-gray-400">Roles</div>
                        </div>
                        <div class="card rounded-xl p-4">
                            <div class="text-2xl font-bold text-yellow-400" id="sec-stat-policies">0</div>
                            <div class="text-sm text-gray-400">Policies</div>
                        </div>
                        <div class="card rounded-xl p-4">
                            <div class="text-2xl font-bold text-cyan-400" id="sec-stat-mfa">0</div>
                            <div class="text-sm text-gray-400">MFA Enabled</div>
                        </div>
                    </div>

                    <!-- Tabs -->
                    <div class="flex gap-2 mb-4 border-b border-gray-700 pb-2 overflow-x-auto">
                        <button data-permission="users:view" onclick="switchSecurityTab('users')" id="sec-tab-users" class="px-4 py-2 rounded-t-lg bg-purple-600 text-white whitespace-nowrap">üë• Users</button>
                        <button data-permission="roles:view" onclick="switchSecurityTab('roles')" id="sec-tab-roles" class="px-4 py-2 rounded-t-lg hover:bg-gray-700 whitespace-nowrap">üé≠ Roles</button>
                        <button data-permission="users:view" onclick="switchSecurityTab('groups')" id="sec-tab-groups" class="px-4 py-2 rounded-t-lg hover:bg-gray-700 whitespace-nowrap">üë• Groups</button>
                        <button data-permission="users:view" onclick="switchSecurityTab('org')" id="sec-tab-org" class="px-4 py-2 rounded-t-lg hover:bg-gray-700 whitespace-nowrap">üè¢ Organization</button>
                        <button data-permission="audit:view" onclick="switchSecurityTab('audit')" id="sec-tab-audit" class="px-4 py-2 rounded-t-lg hover:bg-gray-700 whitespace-nowrap">üìã Audit Log</button>
                        <button onclick="switchSecurityTab('mfa')" id="sec-tab-mfa" class="px-4 py-2 rounded-t-lg hover:bg-gray-700 whitespace-nowrap">üîë My MFA</button>
                        <button data-permission="security:settings" onclick="switchSecurityTab('settings')" id="sec-tab-settings" class="px-4 py-2 rounded-t-lg hover:bg-gray-700 whitespace-nowrap">‚öôÔ∏è Settings</button>
                    </div>

                    <!-- Users Tab -->
                    <div id="sec-content-users" class="card rounded-xl" data-permission="users:view">
                        <!-- Pending Invitations -->
                        <div id="sec-invitations-section" class="p-4 border-b border-gray-700">
                            <h4 class="text-sm font-semibold text-yellow-400 mb-3">üìß Pending Invitations</h4>
                            <div id="sec-invitations-list" class="space-y-2">
                                <p class="text-gray-500 text-sm">Loading invitations...</p>
                            </div>
                        </div>
                        <!-- Users Filter -->
                        <div class="p-4 border-b border-gray-700 flex flex-col md:flex-row items-start md:items-center justify-between gap-4">
                            <input type="text" id="sec-user-search" placeholder="Search users..." 
                                   class="input-field px-4 py-2 rounded-lg w-full md:w-64" oninput="filterSecurityUsers()">
                            <select id="sec-user-filter" class="input-field px-4 py-2 rounded-lg" onchange="filterSecurityUsers()">
                                <option value="">All Status</option>
                                <option value="active">Active</option>
                                <option value="pending">Pending</option>
                                <option value="locked">Locked</option>
                            </select>
                            
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-800/50">
                                    <tr>
                                        <th class="text-left p-4">User</th>
                                        <th class="text-left p-4">Roles</th>
                                        <th class="text-left p-4">Status</th>
                                        <th class="text-left p-4">MFA</th>
                                        <th class="text-left p-4">Last Login</th>
                                        <th class="text-left p-4">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="sec-users-table">
                                    <tr><td colspan="6" class="p-8 text-center text-gray-500">Loading users...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Roles Tab -->
                    <div id="sec-content-roles" class="hidden" data-permission="roles:view">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold">Manage Roles</h3>
                            <button onclick="showAddRoleModal()" class="btn-primary px-4 py-2 rounded-lg" data-permission="roles:create">+ Add Role</button>
                        </div>
                        <div class="flex justify-between mb-4">
                            <h3 class="text-lg font-semibold">System & Custom Roles</h3>
                            
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="sec-roles-grid">
                            <div class="card rounded-xl p-4 text-center text-gray-500">Loading roles...</div>
                        </div>
                    </div>

                    <!-- Groups Tab -->
                    <div id="sec-content-groups" class="hidden" data-permission="users:view">
                        <div class="flex justify-between items-center mb-4">
                            <div>
                                <h3 class="text-lg font-semibold">User Groups</h3>
                                <p class="text-sm text-gray-400">Organize users into groups for easier access management</p>
                            </div>
                            <button onclick="showAddGroupModal()" class="btn-primary px-4 py-2 rounded-lg">+ Create Group</button>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="sec-groups-grid">
                            <div class="card rounded-xl p-4 text-center text-gray-500">Loading groups...</div>
                        </div>
                    </div>

                    <!-- Add Group Modal -->
                    <div id="add-group-modal" class="fixed inset-0 bg-black/70 hidden items-center justify-center z-50">
                        <div class="modal-content-box rounded-2xl w-full max-w-lg mx-4">
                            <div class="p-4 border-b border-gray-700 flex items-center justify-between">
                                <h3 class="font-bold text-lg">üë• Create User Group</h3>
                                <button onclick="closeAddGroupModal()" class="p-2 hover:bg-gray-700 rounded-lg">‚úï</button>
                            </div>
                            <div class="p-6 space-y-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Group Name *</label>
                                    <input type="text" id="group-name" class="w-full input-field rounded-lg px-4 py-2" placeholder="e.g., HR Team, Engineering, Support">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Description</label>
                                    <textarea id="group-description" class="w-full input-field rounded-lg px-4 py-2 h-20" placeholder="What is this group for?"></textarea>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Add Members</label>
                                    <input type="text" id="group-member-search" class="w-full input-field rounded-lg px-4 py-2 mb-2" placeholder="üîç Search users to add..." oninput="searchGroupMembers(this.value)">
                                    <div id="group-member-results" class="hidden max-h-32 overflow-y-auto rounded-lg border border-gray-600 bg-gray-800"></div>
                                    <div id="group-selected-members" class="flex flex-wrap gap-2 mt-2">
                                        <!-- Selected members will appear here -->
                                    </div>
                                </div>
                            </div>
                            <div class="p-4 border-t border-gray-700 flex justify-end gap-3">
                                <button onclick="closeAddGroupModal()" class="px-4 py-2 rounded-lg bg-gray-700 hover:bg-gray-600">Cancel</button>
                                <button onclick="saveGroup()" class="px-6 py-2 rounded-lg bg-purple-600 hover:bg-purple-700">Create Group</button>
                            </div>
                        </div>
                    </div>

                    <!-- Organization Tab (Departments, Managers, Org Chart) -->
                    <div id="sec-content-org" class="hidden" data-permission="users:view">
                        <!-- Sub-tabs for Organization -->
                        <div class="flex gap-2 mb-4">
                            <button onclick="switchOrgSubTab('departments')" id="org-sub-departments" class="px-3 py-1.5 rounded-lg bg-purple-600/20 text-purple-400 text-sm font-medium">üè¢ Departments</button>
                            <button onclick="switchOrgSubTab('managers')" id="org-sub-managers" class="px-3 py-1.5 rounded-lg hover:bg-gray-700 text-sm">üë§ Manager Assignment</button>
                            <button onclick="switchOrgSubTab('orgchart')" id="org-sub-orgchart" class="px-3 py-1.5 rounded-lg hover:bg-gray-700 text-sm">üå≥ Org Chart</button>
                            <button onclick="switchOrgSubTab('directory')" id="org-sub-directory" class="px-3 py-1.5 rounded-lg hover:bg-gray-700 text-sm">‚öôÔ∏è Directory Config</button>
                            <button onclick="switchOrgSubTab('profilefields')" id="org-sub-profilefields" class="px-3 py-1.5 rounded-lg hover:bg-gray-700 text-sm">üß© Profile Fields</button>
                        </div>

                        <!-- Departments Sub-Tab -->
                        <div id="org-content-departments">
                            <div class="flex justify-between items-center mb-4">
                                <div>
                                    <h3 class="text-lg font-semibold">Departments</h3>
                                    <p class="text-sm text-gray-400">Manage organizational departments and hierarchy</p>
                                </div>
                                <button onclick="showCreateDepartmentModal()" class="btn-primary px-4 py-2 rounded-lg">+ Create Department</button>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="org-departments-grid">
                                <div class="card rounded-xl p-4 text-center text-gray-500">Loading departments...</div>
                            </div>
                        </div>

                        <!-- Manager Assignment Sub-Tab -->
                        <div id="org-content-managers" class="hidden">
                            <div class="flex justify-between items-center mb-4">
                                <div>
                                    <h3 class="text-lg font-semibold">Manager Assignment</h3>
                                    <p class="text-sm text-gray-400">Assign direct managers and employee IDs to users</p>
                                </div>
                            </div>
                            <div class="card rounded-xl overflow-hidden">
                                <div class="p-3 flex gap-3">
                                    <input type="text" id="org-manager-search" class="flex-1 input-field rounded-lg px-4 py-2 text-sm" placeholder="üîç Search users..." oninput="renderOrgManagerTable()">
                                </div>
                                <div class="overflow-x-auto">
                                    <table class="w-full">
                                        <thead class="bg-gray-800/50">
                                            <tr>
                                                <th class="text-left p-3 text-sm">Employee</th>
                                                <th class="text-left p-3 text-sm">Employee ID</th>
                                                <th class="text-left p-3 text-sm">Department</th>
                                                <th class="text-left p-3 text-sm">Manager</th>
                                                <th class="text-left p-3 text-sm">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="org-manager-table">
                                            <tr><td colspan="5" class="p-8 text-center text-gray-500">Loading...</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Org Chart Sub-Tab -->
                        <div id="org-content-orgchart" class="hidden">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-semibold">Organization Chart</h3>
                            </div>
                            <div id="org-chart-tree" class="card rounded-xl p-6 min-h-[300px]">
                                <div class="text-center text-gray-500">Loading org chart...</div>
                            </div>
                        </div>

                        <!-- Directory Config Sub-Tab -->
                        <div id="org-content-directory" class="hidden">
                            <div class="mb-4">
                                <h3 class="text-lg font-semibold">Identity Directory Configuration</h3>
                                <p class="text-sm text-gray-400">Configure how user identities and organizational data are resolved</p>
                                <div class="mt-2 p-3 rounded-lg bg-purple-600/10 border border-purple-500/20 text-sm">
                                    üí° <strong>Tip:</strong> This setting is also available in <button onclick="navigate('settings')" class="text-purple-400 underline hover:text-purple-300">Settings ‚Üí Identity & User Directory</button> for easier access during initial setup.
                                </div>
                            </div>
                            <div class="card rounded-xl p-6 space-y-4 max-w-2xl">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Directory Source</label>
                                    <select id="org-directory-source" class="w-full input-field rounded-lg px-4 py-2" onchange="onDirectorySourceChange()">
                                        <option value="internal">Internal (Built-in Org Chart)</option>
                                        <option value="ldap">LDAP / Active Directory</option>
                                        <option value="hr_api">External HR System API</option>
                                        <option value="hybrid">Hybrid (Internal + External)</option>
                                    </select>
                                    <p class="text-xs text-gray-500 mt-1" id="org-directory-desc">User hierarchy managed within the platform.</p>
                                </div>
                                <div id="org-hr-api-config" class="hidden space-y-3">
                                    <div>
                                        <label class="block text-sm font-medium mb-1">HR API Base URL</label>
                                        <input type="url" id="org-hr-api-url" class="w-full input-field rounded-lg px-4 py-2" placeholder="https://api.hrprovider.com/v1">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-1">Authentication Type</label>
                                        <select id="org-hr-api-auth" class="w-full input-field rounded-lg px-4 py-2">
                                            <option value="bearer">Bearer Token</option>
                                            <option value="api_key">API Key</option>
                                            <option value="oauth2">OAuth 2.0</option>
                                            <option value="basic">Basic Auth</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-1">API Key / Token</label>
                                        <input type="password" id="org-hr-api-key" class="w-full input-field rounded-lg px-4 py-2" placeholder="Enter API key or token">
                                    </div>
                                </div>
                                <button onclick="saveDirectoryConfig()" class="btn-primary px-6 py-2 rounded-lg">Save Configuration</button>
                            </div>
                        </div>

                        <!-- Profile Fields (Global Schema) Sub-Tab -->
                        <div id="org-content-profilefields" class="hidden">
                            <div class="mb-4">
                                <h3 class="text-lg font-semibold">Profile Fields (Global Schema)</h3>
                                <p class="text-sm text-gray-400">Define global custom profile fields for your organization. Values are still per-user, but this avoids hardcoding and lets the AI wizard discover fields even before values exist.</p>
                            </div>
                            <div class="card rounded-xl p-6 space-y-4 max-w-3xl">
                                <div class="flex items-center justify-between">
                                    <div class="text-sm text-gray-400">
                                        Add fields like <span class="text-gray-200">cost_center</span>, <span class="text-gray-200">national_id</span>, <span class="text-gray-200">office_location</span>.
                                    </div>
                                    <button onclick="addOrgProfileFieldRow()" class="btn-secondary px-4 py-2 rounded-lg">+ Add Field</button>
                                </div>
                                <div id="org-profilefields-list" class="space-y-2">
                                    <div class="text-sm text-gray-500">Loading...</div>
                                </div>
                                <div class="flex justify-end">
                                    <button onclick="saveOrgProfileFieldsSchema()" class="btn-primary px-6 py-2 rounded-lg">Save Global Fields</button>
                                </div>

                                <div class="border-t border-gray-700 pt-4">
                                    <h4 class="font-semibold mb-2">Bulk Apply Values (Optional)</h4>
                                    <p class="text-xs text-gray-500 mb-2">Use this to set per-user values without editing users one-by-one. Paste JSON array like: <code class="text-gray-300">[{"email":"user@x.com","attributes":{"cost_center":"CC-1"}}]</code></p>
                                    <textarea id="org-bulk-custom-attrs" class="w-full input-field rounded-lg px-4 py-2 text-sm h-28" placeholder='[{"email":"user@company.com","attributes":{"cost_center":"CC-ENG-01","employee_id":"E-1001"}}]'></textarea>
                                    <div class="flex justify-end gap-2 mt-2">
                                        <select id="org-bulk-custom-attrs-mode" class="input-field rounded-lg px-3 py-2 text-sm">
                                            <option value="merge">Merge</option>
                                            <option value="replace">Replace</option>
                                        </select>
                                        <button onclick="applyBulkUserCustomAttributes()" class="btn-primary px-5 py-2 rounded-lg">Apply Bulk Update</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Create Department Modal -->
                        <div id="create-dept-modal" class="fixed inset-0 bg-black/70 hidden items-center justify-center z-50">
                            <div class="modal-content-box rounded-2xl w-full max-w-lg mx-4">
                                <div class="p-4 border-b border-gray-700 flex items-center justify-between">
                                    <h3 class="font-bold text-lg" id="dept-modal-title">üè¢ Create Department</h3>
                                    <button onclick="closeDeptModal()" class="p-2 hover:bg-gray-700 rounded-lg">‚úï</button>
                                </div>
                                <div class="p-6 space-y-4">
                                    <input type="hidden" id="dept-edit-id" value="">
                                    <div>
                                        <label class="block text-sm font-medium mb-2">Department Name *</label>
                                        <input type="text" id="dept-name" class="w-full input-field rounded-lg px-4 py-2" placeholder="e.g., Engineering, HR, Finance">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-2">Description</label>
                                        <textarea id="dept-description" class="w-full input-field rounded-lg px-4 py-2 h-20" placeholder="What does this department do?"></textarea>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-2">Department Head</label>
                                        <select id="dept-manager" class="w-full input-field rounded-lg px-4 py-2">
                                            <option value="">‚Äî None ‚Äî</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-2">Parent Department</label>
                                        <select id="dept-parent" class="w-full input-field rounded-lg px-4 py-2">
                                            <option value="">‚Äî None (Top Level) ‚Äî</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="p-4 border-t border-gray-700 flex justify-end gap-3">
                                    <button onclick="closeDeptModal()" class="px-4 py-2 rounded-lg bg-gray-700 hover:bg-gray-600">Cancel</button>
                                    <button onclick="saveDepartment()" class="px-6 py-2 rounded-lg bg-purple-600 hover:bg-purple-700" id="dept-save-btn">Create</button>
                                </div>
                            </div>
                        </div>

                        <!-- Assign Manager Modal -->
                        <div id="assign-manager-modal" class="fixed inset-0 bg-black/70 hidden items-center justify-center z-50">
                            <div class="modal-content-box rounded-2xl w-full max-w-md mx-4">
                                <div class="p-4 border-b border-gray-700 flex items-center justify-between">
                                    <h3 class="font-bold text-lg">üë§ Assign Manager</h3>
                                    <button onclick="closeManagerModal()" class="p-2 hover:bg-gray-700 rounded-lg">‚úï</button>
                                </div>
                                <div class="p-6 space-y-4">
                                    <input type="hidden" id="mgr-user-id" value="">
                                    <p class="text-sm text-gray-400">Assigning manager for: <strong id="mgr-user-name"></strong></p>
                                    <div>
                                        <label class="block text-sm font-medium mb-2">Direct Manager</label>
                                        <select id="mgr-select" class="w-full input-field rounded-lg px-4 py-2">
                                            <option value="">‚Äî No Manager ‚Äî</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-2">Department</label>
                                        <select id="mgr-dept-select" class="w-full input-field rounded-lg px-4 py-2">
                                            <option value="">‚Äî No Department ‚Äî</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-2">Employee ID</label>
                                        <input type="text" id="mgr-employee-id" class="w-full input-field rounded-lg px-4 py-2" placeholder="e.g., EMP-001">
                                    </div>
                                </div>
                                <div class="p-4 border-t border-gray-700 flex justify-end gap-3">
                                    <button onclick="closeManagerModal()" class="px-4 py-2 rounded-lg bg-gray-700 hover:bg-gray-600">Cancel</button>
                                    <button onclick="saveManagerAssignment()" class="px-6 py-2 rounded-lg bg-purple-600 hover:bg-purple-700">Save</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Audit Log Tab -->
                    <div id="sec-content-audit" class="hidden card rounded-xl" data-permission="audit:view">
                        <div class="p-4 border-b border-gray-700 flex items-center gap-4">
                            <select id="sec-audit-action" class="input-field px-3 py-2 rounded-lg" onchange="loadAuditLogs()">
                                <option value="">All Actions</option>
                                <option value="login">Login</option>
                                <option value="logout">Logout</option>
                                <option value="create">Create</option>
                                <option value="update">Update</option>
                                <option value="delete">Delete</option>
                            </select>
                            
                            <button data-permission="audit:export" onclick="exportAuditLogs()" class="btn-secondary px-4 py-2 rounded-lg">üì• Export CSV</button>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-800/50">
                                    <tr>
                                        <th class="text-left p-4">Time</th>
                                        <th class="text-left p-4">User</th>
                                        <th class="text-left p-4">Action</th>
                                        <th class="text-left p-4">Resource</th>
                                        <th class="text-left p-4">IP</th>
                                        <th class="text-left p-4">Status</th>
                                    </tr>
                                </thead>
                                <tbody id="sec-audit-table">
                                    <tr><td colspan="6" class="p-8 text-center text-gray-500">Select action filter to load logs</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- MFA Tab -->
                    <div id="sec-content-mfa" class="hidden card rounded-xl p-6">
                        <div class="max-w-2xl mx-auto">
                            <div class="text-center mb-8">
                                <div class="text-6xl mb-4">üîê</div>
                                <h3 class="text-xl font-bold mb-2">Multi-Factor Authentication</h3>
                                <p class="text-gray-400">Secure your platform with email verification</p>
                            </div>
                            
                            <!-- Admin Controls -->
                            <div id="mfa-admin-controls" class="mb-8" data-permission="system:admin,security:settings">
                                <div class="bg-purple-500/10 border border-purple-500/30 rounded-xl p-6">
                                    <h4 class="font-bold text-purple-400 mb-6 flex items-center gap-2">
                                        <span>‚öôÔ∏è</span> Platform MFA Settings
                                    </h4>
                                    
                                    <!-- MFA Mode Selection -->
                                    <div class="space-y-3">
                                        <label class="block text-sm text-gray-400 mb-3">Choose MFA mode for your platform:</label>
                                        
                                        <label class="flex items-center p-4 rounded-lg border border-gray-700 hover:border-purple-500 cursor-pointer transition" onclick="selectMfaMode('off')">
                                            <input type="radio" name="mfa-mode" value="off" class="mr-4 accent-purple-500">
                                            <div class="flex-1">
                                                <span class="font-medium">üîì Disabled</span>
                                                <p class="text-sm text-gray-500">MFA is turned off for all users</p>
                                            </div>
                                        </label>
                                        
                                        <label class="flex items-center p-4 rounded-lg border border-gray-700 hover:border-purple-500 cursor-pointer transition" onclick="selectMfaMode('optional')">
                                            <input type="radio" name="mfa-mode" value="optional" class="mr-4 accent-purple-500">
                                            <div class="flex-1">
                                                <span class="font-medium">üîò Optional</span>
                                                <p class="text-sm text-gray-500">Users can enable/disable MFA from their profile</p>
                                            </div>
                                        </label>
                                        
                                        <label class="flex items-center p-4 rounded-lg border border-gray-700 hover:border-purple-500 cursor-pointer transition" onclick="selectMfaMode('admins')">
                                            <input type="radio" name="mfa-mode" value="admins" class="mr-4 accent-purple-500">
                                            <div class="flex-1">
                                                <span class="font-medium">üëë Required for Admins</span>
                                                <p class="text-sm text-gray-500">Administrators must use MFA, others optional</p>
                                            </div>
                                        </label>
                                        
                                        <label class="flex items-center p-4 rounded-lg border border-gray-700 hover:border-purple-500 cursor-pointer transition" onclick="selectMfaMode('all')">
                                            <input type="radio" name="mfa-mode" value="all" class="mr-4 accent-purple-500">
                                            <div class="flex-1">
                                                <span class="font-medium">üîí Required for Everyone</span>
                                                <p class="text-sm text-gray-500">All users must verify with email code</p>
                                            </div>
                                        </label>
                                    </div>
                                    
                                    <div id="mfa-save-status" class="mt-4 text-sm text-green-400 hidden">‚úì Settings saved automatically</div>
                                </div>
                            </div>
                            
                            <!-- User Status Section -->
                            <div class="bg-gray-800/50 rounded-xl p-6 mb-6">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="font-semibold mb-1">Your MFA Status</h4>
                                        <p id="mfa-status-text" class="text-sm text-gray-400">Loading...</p>
                                    </div>
                                    <div id="mfa-status-badge">
                                        <span class="px-3 py-1 rounded-full text-sm bg-gray-600 text-gray-300">Loading</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- How it works -->
                            <div class="bg-blue-500/10 border border-blue-500/30 rounded-xl p-4 mb-6">
                                <div class="flex items-start gap-3">
                                    <span class="text-2xl">üìß</span>
                                    <div>
                                        <h4 class="font-semibold text-blue-400 mb-1">How it works</h4>
                                        <p class="text-sm text-gray-400">When you log in, a 6-digit code will be sent to your email. Enter this code to complete sign-in.</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- User MFA Toggle (shows for Optional mode) -->
                            <div id="mfa-user-toggle-section" class="hidden">
                                <div class="border border-gray-700 rounded-xl p-4">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h4 class="font-semibold mb-1">MFA for my account</h4>
                                            <p class="text-sm text-gray-400">Enable or disable MFA for your login</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" id="mfa-user-enabled" class="sr-only peer" onchange="toggleUserMFA()">
                                            <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="sec-content-settings" class="hidden card rounded-xl p-6" data-permission="security:settings">
                        <h3 class="text-lg font-bold mb-6">Security Settings</h3>
                        <form id="security-settings-form" class="space-y-6">
                            <!-- Authentication Settings -->
                            <div>
                                <h4 class="font-semibold mb-4 text-purple-400">üîê Authentication</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm text-gray-400 mb-2">Registration Mode</label>
                                        <select id="sec-setting-registration_mode" name="registration_mode" class="input-field w-full px-4 py-2 rounded-lg">
                                            <option value="open">Open Registration</option>
                                            <option value="invite_only">Invite Only</option>
                                            <option value="disabled">Disabled</option>
                                        </select>
                            
                                    </div>
                                    <div>
                                        <label class="block text-sm text-gray-400 mb-2">Email Verification</label>
                                        <select id="sec-setting-email_verification" name="email_verification" class="input-field w-full px-4 py-2 rounded-lg">
                                            <option value="required">Required</option>
                                            <option value="optional">Optional</option>
                                            <option value="disabled">Disabled</option>
                                        </select>
                            
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Password Policy -->
                            <div>
                                <h4 class="font-semibold mb-4 text-purple-400">üîë Password Policy</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm text-gray-400 mb-2">Minimum Length</label>
                                        <input type="number" id="sec-setting-password_min_length" name="password_min_length" min="8" max="32" value="8" class="input-field w-full px-4 py-2 rounded-lg">
                                    </div>
                                    <div>
                                        <label class="block text-sm text-gray-400 mb-2">Password Expiry (days, 0=never)</label>
                                        <input type="number" id="sec-setting-password_expiry_days" name="password_expiry_days" min="0" value="0" class="input-field w-full px-4 py-2 rounded-lg">
                                    </div>
                                    <div class="col-span-2 space-y-2">
                                        <label class="flex items-center gap-2 cursor-pointer">
                                            <input type="checkbox" id="sec-setting-require_uppercase" name="require_uppercase" class="rounded">
                                            <span class="text-sm">Require uppercase letter</span>
                                        </label>
                                        <label class="flex items-center gap-2 cursor-pointer">
                                            <input type="checkbox" id="sec-setting-require_number" name="require_number" class="rounded">
                                            <span class="text-sm">Require number</span>
                                        </label>
                                        <label class="flex items-center gap-2 cursor-pointer">
                                            <input type="checkbox" id="sec-setting-require_symbol" name="require_symbol" class="rounded">
                                            <span class="text-sm">Require special character</span>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Session Settings -->
                            <div>
                                <h4 class="font-semibold mb-4 text-purple-400">‚è±Ô∏è Session</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm text-gray-400 mb-2">Session Timeout (minutes)</label>
                                        <input type="number" id="sec-setting-session_timeout" name="session_timeout" min="15" value="1440" class="input-field w-full px-4 py-2 rounded-lg">
                                    </div>
                                    <div>
                                        <label class="block text-sm text-gray-400 mb-2">Remember Me Duration (days)</label>
                                        <input type="number" id="sec-setting-remember_me_days" name="remember_me_days" min="1" value="30" class="input-field w-full px-4 py-2 rounded-lg">
                                    </div>
                                    <div>
                                        <label class="block text-sm text-gray-400 mb-2">Max Concurrent Sessions</label>
                                        <input type="number" id="sec-setting-max_sessions" name="max_sessions" min="1" value="3" class="input-field w-full px-4 py-2 rounded-lg">
                                    </div>
                                </div>
                            </div>

                            <!-- Security Policy -->
                            <div>
                                <h4 class="font-semibold mb-4 text-purple-400">üõ°Ô∏è Security</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm text-gray-400 mb-2">Account Lockout After (attempts)</label>
                                        <input type="number" id="sec-setting-lockout_attempts" name="lockout_attempts" min="3" value="5" class="input-field w-full px-4 py-2 rounded-lg">
                                    </div>
                                    <div>
                                        <label class="block text-sm text-gray-400 mb-2">Lockout Duration (minutes)</label>
                                        <input type="number" id="sec-setting-lockout_duration" name="lockout_duration" min="5" value="30" class="input-field w-full px-4 py-2 rounded-lg">
                                    </div>
                                </div>
                            </div>

                            <div class="flex justify-end pt-4 border-t border-gray-700">
                                <button type="button" onclick="saveSecuritySettings()" class="btn-primary px-6 py-2 rounded-lg">Save Settings</button>
                            </div>
                        </form>
                    </div>
                </div>
            </section>

            <!-- Create Agent Wizard - Unified (Modal) -->
            <section id="page-create" class="hidden create-wizard-modal" style="overflow:hidden;">
                <div class="create-wizard-modal-backdrop modal-backdrop" onclick="closeCreateWizardModal()" aria-hidden="true"></div>
                <div class="create-wizard-modal-panel" role="dialog" aria-modal="true" aria-label="Create Agent Wizard">
                
                <!-- STICKY HEADER: Progress + Navigation -->
                <div id="wizard-sticky-header" class="hidden sticky top-0 z-40 bg-[#1a1a2e] border-b border-gray-800 px-4 py-3 shadow-lg">
                    <div class="max-w-5xl mx-auto">
                        <!-- Top Row: Title + Actions -->
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center gap-3">
                                <div>
                                    <h2 id="wizard-header-title" class="text-sm font-semibold text-white">Create Agent</h2>
                                    <p id="wizard-header-step" class="text-xs text-gray-400">Step 1 of 7</p>
                                </div>
                            </div>
                            <div class="flex items-center gap-2">
                                <button onclick="closeCreateWizardModal()" class="text-sm px-3 py-1.5 rounded border border-gray-700 text-gray-300 hover:bg-gray-800 hover:text-white transition" title="Close">
                                    Close
                                </button>
                                <button onclick="cancelEdit()" class="text-sm px-4 py-1.5 rounded border border-gray-700 text-gray-300 hover:bg-gray-800 hover:text-white transition">
                                    Cancel
                                </button>
                                <button onclick="saveWizardProgress()" class="text-sm px-4 py-1.5 rounded border border-gray-700 text-gray-300 hover:bg-gray-800 hover:text-white transition">
                                    Save Draft
                                </button>
                                <button onclick="prevStep()" id="wizard-btn-back" class="text-sm px-4 py-1.5 rounded border border-gray-700 text-gray-300 hover:bg-gray-800 transition disabled:opacity-50" disabled>
                                    Back
                                </button>
                                <button onclick="nextStep()" id="wizard-btn-next" class="text-sm px-4 py-1.5 rounded bg-blue-600 text-white hover:bg-blue-700 transition">
                                    Next
                                </button>
                                <button onclick="deployAgent()" id="wizard-btn-deploy" class="hidden text-sm px-4 py-1.5 rounded bg-green-600 text-white hover:bg-green-700 transition">
                                    Deploy
                                </button>
                            </div>
                        </div>
                        
                        <!-- Progress Bar - 7 Steps (Test is final with Deploy) -->
                        <div class="flex items-center gap-1">
                            <div class="wizard-progress-step" data-step="1">
                                <div class="wizard-step-dot active" onclick="goStep(1)">1</div>
                                <span class="wizard-step-label">Setup</span>
                            </div>
                            <div class="wizard-progress-line"></div>
                            <div class="wizard-progress-step" data-step="2">
                                <div class="wizard-step-dot" onclick="goStep(2)">2</div>
                                <span class="wizard-step-label">Tasks</span>
                            </div>
                            <div class="wizard-progress-line"></div>
                            <div class="wizard-progress-step" data-step="3">
                                <div class="wizard-step-dot" onclick="goStep(3)">3</div>
                                <span class="wizard-step-label">Tools</span>
                            </div>
                            <div class="wizard-progress-line"></div>
                            <div class="wizard-progress-step" data-step="4">
                                <div class="wizard-step-dot" onclick="goStep(4)">4</div>
                                <span class="wizard-step-label">Access</span>
                            </div>
                            <div class="wizard-progress-line"></div>
                            <div class="wizard-progress-step" data-step="5">
                                <div class="wizard-step-dot" onclick="goStep(5)">5</div>
                                <span class="wizard-step-label">Safety</span>
                            </div>
                            <div class="wizard-progress-line"></div>
                            <div class="wizard-progress-step" data-step="6">
                                <div class="wizard-step-dot" onclick="goStep(6)">6</div>
                                <span class="wizard-step-label">Preview</span>
                            </div>
                            <div class="wizard-progress-line"></div>
                            <div class="wizard-progress-step" data-step="7">
                                <div class="wizard-step-dot" onclick="goStep(7)">7</div>
                                <span class="wizard-step-label">Test & Deploy</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Scrollable Content Area -->
                <div id="wizard-content-area" class="flex-1 overflow-y-auto p-4 md:p-6" style="-webkit-overflow-scrolling:touch;">
                
                <!-- OLD Steps Progress Bar (hidden, kept for backward compatibility) -->
                <div id="wizard-progress" class="hidden mb-8">
                    <div class="flex items-center justify-start md:justify-center gap-1 md:gap-2 overflow-x-auto pb-2">
                        <div class="flex items-center gap-1 flex-shrink-0">
                            <div id="step-1" class="w-6 h-6 md:w-8 md:h-8 rounded-full flex items-center justify-center step-active cursor-pointer text-xs md:text-sm" onclick="goStep(1)">1</div>
                            <span class="text-xs whitespace-nowrap hidden md:inline">Basics</span>
                        </div>
                        <div class="w-4 md:w-8 h-0.5 bg-gray-700 flex-shrink-0"></div>
                        <div class="flex items-center gap-1 flex-shrink-0">
                            <div id="step-2" class="w-6 h-6 md:w-8 md:h-8 rounded-full flex items-center justify-center step-pending cursor-pointer text-xs md:text-sm" onclick="goStep(2)">2</div>
                            <span class="text-xs text-gray-400 whitespace-nowrap hidden md:inline">Tasks</span>
                        </div>
                        <div class="w-4 md:w-8 h-0.5 bg-gray-700 flex-shrink-0"></div>
                        <div class="flex items-center gap-1 flex-shrink-0">
                            <div id="step-3" class="w-6 h-6 md:w-8 md:h-8 rounded-full flex items-center justify-center step-pending cursor-pointer text-xs md:text-sm" onclick="goStep(3)">3</div>
                            <span class="text-xs text-gray-400 whitespace-nowrap hidden md:inline">Tools</span>
                        </div>
                        <div class="w-4 md:w-8 h-0.5 bg-gray-700 flex-shrink-0"></div>
                        <div class="flex items-center gap-1 flex-shrink-0">
                            <div id="step-4" class="w-6 h-6 md:w-8 md:h-8 rounded-full flex items-center justify-center step-pending cursor-pointer text-xs md:text-sm" onclick="goStep(4)">4</div>
                            <span class="text-xs text-gray-400 whitespace-nowrap hidden md:inline">Access</span>
                        </div>
                        <div class="w-4 md:w-8 h-0.5 bg-gray-700 flex-shrink-0"></div>
                        <div class="flex items-center gap-1 flex-shrink-0">
                            <div id="step-5" class="w-6 h-6 md:w-8 md:h-8 rounded-full flex items-center justify-center step-pending cursor-pointer text-xs md:text-sm" onclick="goStep(5)">5</div>
                            <span class="text-xs text-gray-400 whitespace-nowrap hidden md:inline">Safety</span>
                        </div>
                        <div class="w-4 md:w-8 h-0.5 bg-gray-700 flex-shrink-0"></div>
                        <div class="flex items-center gap-1 flex-shrink-0">
                            <div id="step-6" class="w-6 h-6 md:w-8 md:h-8 rounded-full flex items-center justify-center step-pending cursor-pointer text-xs md:text-sm" onclick="goStep(6)">6</div>
                            <span class="text-xs text-gray-400 whitespace-nowrap hidden md:inline">Preview</span>
                        </div>
                        <div class="w-4 md:w-8 h-0.5 bg-gray-700 flex-shrink-0"></div>
                        <div class="flex items-center gap-1 flex-shrink-0">
                            <div id="step-7" class="w-6 h-6 md:w-8 md:h-8 rounded-full flex items-center justify-center step-pending cursor-pointer text-xs md:text-sm" onclick="goStep(7)">7</div>
                            <span class="text-xs text-gray-400 whitespace-nowrap hidden md:inline">Test</span>
                        </div>
                        <div class="w-4 md:w-8 h-0.5 bg-gray-700 flex-shrink-0"></div>
                        <div class="flex items-center gap-1 flex-shrink-0">
                            <div id="step-8" class="w-6 h-6 md:w-8 md:h-8 rounded-full flex items-center justify-center step-pending cursor-pointer text-xs md:text-sm" onclick="goStep(8)">8</div>
                            <span class="text-xs text-gray-400 whitespace-nowrap hidden md:inline">Deploy</span>
                        </div>
                    </div>
                </div>

                <!-- Step 0: Goal Input (Initial Step) -->
                <div id="wizard-step-0" class="max-w-2xl mx-auto">
                    <div class="flex justify-end mb-2">
                        <button onclick="closeCreateWizardModal()" class="w-10 h-10 rounded-lg bg-gray-900/40 border border-gray-800 hover:bg-gray-800 text-gray-300 flex items-center justify-center transition" title="Close">
                            ‚úï
                        </button>
                    </div>
                    <div class="text-center mb-8">
                        <div class="w-20 h-20 mx-auto rounded-2xl bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center mb-4">
                            <img src="data:image/png;base64,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" alt="" class="w-12 h-12">
                        </div>
                        <h2 class="text-2xl md:text-3xl font-bold mb-2">Deploy Your AI Agent</h2>
                        <p class="text-gray-400">Build enterprise-grade Conversational or Process AI agents that understand, decide, and act across your organization.</p>
                    </div>

                    <!-- Stepper -->
                    <div class="card rounded-xl p-4 mb-5 bg-gray-900/40 border border-gray-800">
                        <div class="create-flow-stepper">
                            <div class="create-flow-step" data-step="type">
                                <div class="create-flow-dot active">1</div>
                                <div>
                                    <div class="text-xs font-semibold text-gray-200">Agent Type</div>
                                    <div class="text-[11px] text-gray-500">Conversational or Process</div>
                                </div>
                            </div>
                            <div class="create-flow-divider"></div>
                            <div class="create-flow-step" data-step="method">
                                <div class="create-flow-dot">2</div>
                                <div>
                                    <div class="text-xs font-semibold text-gray-200">Build Method</div>
                                    <div class="text-[11px] text-gray-500">Manual or AI-generated</div>
                                </div>
                            </div>
                            <div class="create-flow-divider"></div>
                            <div class="create-flow-step" data-step="ai">
                                <div class="create-flow-dot">3</div>
                                <div>
                                    <div class="text-xs font-semibold text-gray-200">Describe</div>
                                    <div class="text-[11px] text-gray-500">AI generates everything</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Flow Step: Type -->
                    <div id="create-flow-step-type">
                        <div class="grid md:grid-cols-2 gap-4 mb-5">
                            <div id="type-card-conversational" onclick="selectAgentType('conversational')"
                                 class="card rounded-xl p-5 cursor-pointer border-2 border-purple-500 hover:border-purple-400 transition-all">
                                <div class="flex items-center gap-3 mb-3">
                                    <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center text-2xl">üí¨</div>
                                    <div>
                                        <h3 class="font-bold">Conversational Agent</h3>
                                        <p class="text-xs text-gray-400">Natural language AI assistant</p>
                                    </div>
                                </div>
                                <p class="text-sm text-gray-300 mb-3">Engage employees and customers with an AI assistant that understands context, answers questions, and resolves requests across any domain.</p>
                                <div class="flex flex-wrap gap-1 mb-2">
                                    <span class="px-2 py-0.5 rounded-full bg-purple-500/20 text-purple-300 text-xs">HR & IT Support</span>
                                    <span class="px-2 py-0.5 rounded-full bg-purple-500/20 text-purple-300 text-xs">Knowledge Base</span>
                                    <span class="px-2 py-0.5 rounded-full bg-purple-500/20 text-purple-300 text-xs">24/7 Availability</span>
                                </div>
                                <div class="text-sm text-purple-400 font-medium">‚úì Selected</div>
                            </div>

                            <div id="type-card-process" onclick="selectAgentType('process')"
                                 class="card rounded-xl p-5 cursor-pointer border-2 border-transparent hover:border-green-500 transition-all">
                                <div class="flex items-center gap-3 mb-3">
                                    <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-green-500 to-teal-500 flex items-center justify-center text-2xl">üîÑ</div>
                                    <div>
                                        <h3 class="font-bold">Process Agent</h3>
                                        <p class="text-xs text-gray-400">Intelligent workflow automation</p>
                                    </div>
                                </div>
                                <p class="text-sm text-gray-300 mb-3">Automate end-to-end business processes with AI-powered decisions, multi-level approvals, and system integrations ‚Äî built visually, no code required.</p>
                                <div class="flex flex-wrap gap-1 mb-2">
                                    <span class="px-2 py-0.5 rounded-full bg-green-500/20 text-green-300 text-xs">Approvals & Routing</span>
                                    <span class="px-2 py-0.5 rounded-full bg-green-500/20 text-green-300 text-xs">AI Decisions</span>
                                    <span class="px-2 py-0.5 rounded-full bg-green-500/20 text-green-300 text-xs">No-Code Builder</span>
                                </div>
                                <div class="text-sm text-gray-500">Click to select</div>
                            </div>
                        </div>

                        <div class="flex gap-3">
                            <button onclick="createFlowGo('method')" class="btn-primary px-6 py-3 rounded-lg flex-1 font-medium">
                                Continue
                            </button>
                        </div>
                    </div>

                    <!-- Flow Step: Setup Method -->
                    <div id="create-flow-step-method" class="hidden">
                        <div class="grid md:grid-cols-2 gap-4 mb-5">
                            <div id="build-card-manual" onclick="selectBuildMode('manual')" class="card rounded-xl p-5 cursor-pointer border-2 border-transparent hover:border-blue-500 transition-all">
                                <div class="flex items-center gap-3 mb-3">
                                    <div class="w-12 h-12 rounded-xl bg-gray-800 flex items-center justify-center text-2xl">üõ†Ô∏è</div>
                                    <div>
                                        <h3 class="font-bold">Build Manually</h3>
                                        <p class="text-xs text-gray-400">Full control, your way</p>
                                    </div>
                                </div>
                                <p class="text-sm text-gray-300 mb-2" id="build-manual-copy-conv">Start from a blank slate. Configure tasks, tools, personas, and access controls step by step ‚Äî ideal for tailored enterprise requirements.</p>
                                <p class="text-sm text-gray-300 mb-2 hidden" id="build-manual-copy-proc">Open the visual Process Builder and design your workflow with drag & drop ‚Äî full control over every step, condition, and integration.</p>
                                <div class="text-sm text-gray-500" id="build-manual-selected">Click to select</div>
                            </div>

                            <div id="build-card-ai" onclick="selectBuildMode('ai')" class="card rounded-xl p-5 cursor-pointer border-2 border-transparent hover:border-purple-500 transition-all">
                                <div class="flex items-center gap-3 mb-3">
                                    <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center text-2xl">‚ú®</div>
                                    <div>
                                        <h3 class="font-bold">Generate with AI</h3>
                                        <p class="text-xs text-gray-400">Describe it ‚Äî AI builds it</p>
                                    </div>
                                </div>
                                <p class="text-sm text-gray-300 mb-2" id="build-ai-copy-conv">Describe your use case in plain language. AgentForge AI will generate the full assistant configuration ‚Äî tasks, tools, and guardrails ‚Äî ready to review and deploy.</p>
                                <p class="text-sm text-gray-300 mb-2 hidden" id="build-ai-copy-proc">Describe your business process in plain language. AgentForge AI will generate the complete workflow and open it in the visual editor ‚Äî ready to review, adjust, and deploy.</p>
                                <div class="text-sm text-gray-500" id="build-ai-selected">Click to select</div>
                            </div>
                        </div>

                        <div class="flex gap-3">
                            <button onclick="createFlowGo('type')" class="px-5 py-3 rounded-lg bg-gray-800 hover:bg-gray-700 text-gray-200 transition">
                                Back
                            </button>
                            <button onclick="createFlowContinue()" id="create-flow-continue-btn" class="btn-primary px-6 py-3 rounded-lg flex-1 font-medium">
                                Continue
                            </button>
                        </div>
                    </div>

                    <!-- Flow Step: Describe (AI drafting) -->
                    <div id="create-flow-step-ai" class="hidden">
                        <div class="card rounded-xl p-6 md:p-7 border border-gray-800 bg-gray-900/30">
                            <div id="create-ai-conversational">
                                <label class="text-sm text-gray-400 mb-2 block">What should this assistant do for your organization? *</label>
                                <textarea id="w-initial-goal" rows="4" class="input-field w-full rounded-lg px-4 py-4 text-lg" placeholder="Example: Help employees submit leave requests, answer HR policy questions, and route complex cases to the right department..."></textarea>

                                <div class="mt-5 pt-5 border-t border-gray-800">
                                    <div class="flex items-center justify-between gap-3 mb-3">
                                        <p class="text-sm text-gray-500">Start from a template (optional):</p>
                                        <button onclick="openCreateTemplateGallery('conversational')" class="px-3 py-1.5 rounded-lg bg-gray-800 hover:bg-gray-700 text-sm transition flex items-center gap-2">
                                            <span>‚ú®</span> Browse templates
                                        </button>
                                    </div>
                                    <div id="conv-template-chips" class="flex flex-wrap gap-2"></div>
                                    <p class="text-xs text-gray-500 mt-3">Choosing a template only fills the text above ‚Äî you can edit it before you press ‚ÄúGenerate with AI‚Äù.</p>
                                </div>
                            </div>

                            <div id="create-ai-process" class="hidden">
                                <div class="text-center mb-5">
                                    <div class="w-14 h-14 mx-auto rounded-2xl bg-gradient-to-br from-green-500 to-teal-500 flex items-center justify-center text-2xl mb-3">üîÑ</div>
                                    <div class="font-bold text-lg">Describe your business process</div>
                                    <div class="text-sm text-gray-500">AgentForge AI generates the full workflow and opens it in the visual editor</div>
                                </div>
                                <label class="text-sm text-gray-400 mb-2 block">Workflow description *</label>
                                <textarea id="w-process-goal" rows="4" class="input-field w-full rounded-lg px-4 py-4" placeholder="Example: When an expense over $500 is submitted, send it to the requester‚Äôs manager for approval, then notify Finance and update the system..."></textarea>
                                <div class="mt-5 pt-5 border-t border-gray-800">
                                    <div class="flex items-center justify-between gap-3 mb-3">
                                        <p class="text-sm text-gray-500">Start from a template (optional):</p>
                                        <button onclick="openCreateTemplateGallery('process')" class="px-3 py-1.5 rounded-lg bg-gray-800 hover:bg-gray-700 text-sm transition flex items-center gap-2">
                                            <span>‚ú®</span> Browse templates
                                        </button>
                                    </div>
                                    <div id="proc-template-chips" class="flex flex-wrap gap-2"></div>
                                    <p class="text-xs text-gray-500 mt-3">Choosing a template only fills the description above ‚Äî you can edit it before you press ‚ÄúGenerate with AI‚Äù.</p>
                                </div>
                            </div>
                        </div>

                        <div class="mt-5 flex gap-3">
                            <button onclick="createFlowGo('method')" class="px-5 py-3 rounded-lg bg-gray-800 hover:bg-gray-700 text-gray-200 transition">
                                Back
                            </button>
                            <button onclick="createFlowGenerate()" id="create-flow-generate-btn" class="btn-primary px-6 py-3 rounded-lg flex-1 font-medium">
                                Generate with AI
                            </button>
                        </div>
                        <p class="text-xs text-gray-500 mt-3 text-center">You can review and edit everything after generation.</p>
                    </div>
                </div>

                <!-- Create Templates Gallery Modal -->
                <div id="create-template-modal" class="hidden fixed inset-0 z-[9998] bg-black/60 items-center justify-center p-4" onclick="if(event.target===this)closeCreateTemplateGallery()">
                    <div class="card rounded-2xl w-full max-w-4xl border border-gray-800 bg-gray-900/95" style="max-height:85vh;display:flex;flex-direction:column;" onclick="event.stopPropagation()">
                        <div class="p-5 border-b border-gray-800 flex items-start justify-between gap-4">
                            <div>
                                <div class="text-lg font-bold" id="create-template-modal-title">Templates</div>
                                <div class="text-xs text-gray-400" id="create-template-modal-subtitle">Pick one to prefill your description. You can edit it before generating.</div>
                            </div>
                            <button onclick="closeCreateTemplateGallery()" class="px-3 py-2 rounded-lg bg-gray-800 hover:bg-gray-700 text-gray-200 transition">‚úï</button>
                        </div>
                        <div class="p-5 border-b border-gray-800 flex flex-col md:flex-row gap-3 md:items-center md:justify-between">
                            <div class="flex gap-2">
                                <button id="create-template-tab-conv" onclick="switchCreateTemplateTab('conversational')" class="px-3 py-2 rounded-lg bg-gray-800 hover:bg-gray-700 text-sm transition">üí¨ Conversational</button>
                                <button id="create-template-tab-proc" onclick="switchCreateTemplateTab('process')" class="px-3 py-2 rounded-lg bg-gray-800 hover:bg-gray-700 text-sm transition">üîÑ Process</button>
                            </div>
                            <div class="flex-1 md:max-w-md">
                                <input id="create-template-search" type="text" class="input-field w-full rounded-lg px-4 py-2" placeholder="Search templates..." oninput="filterCreateTemplateGallery(this.value)">
                            </div>
                        </div>
                        <div class="p-5 overflow-auto" style="flex:1;">
                            <div id="create-template-grid" class="grid grid-cols-1 md:grid-cols-2 gap-3"></div>
                            <div id="create-template-empty" class="hidden text-center text-sm text-gray-500 py-10">No templates match your search.</div>
                        </div>
                    </div>
                </div>

                <!-- AI Generating Animation -->
                <div id="wizard-generating" class="hidden max-w-2xl mx-auto">
                    <div class="card rounded-xl p-8 text-center">
                        <div class="relative w-24 h-24 mx-auto mb-6">
                            <div class="absolute inset-0 rounded-full border-4 border-purple-500/30 animate-ping"></div>
                            <div class="absolute inset-2 rounded-full border-4 border-blue-500/30 animate-ping" style="animation-delay: 0.2s"></div>
                            <div class="absolute inset-4 rounded-full border-4 border-purple-500/30 animate-ping" style="animation-delay: 0.4s"></div>
                            <div class="relative w-full h-full rounded-full bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center text-3xl">
                                üß†
                            </div>
                        </div>
                        <h3 class="text-xl font-bold mb-2" id="generating-title">Configuring Your Agent...</h3>
                        <p class="text-gray-400 mb-6" id="generating-status">Analyzing your goal...</p>
                        <div class="space-y-2 text-left max-w-md mx-auto">
                            <div class="flex items-center gap-3 text-sm" id="gen-step-1">
                                <span class="w-5 h-5 rounded-full bg-purple-500 flex items-center justify-center animate-pulse">‚úì</span>
                                <span id="gen-label-1">Understanding your requirements</span>
                            </div>
                            <div class="flex items-center gap-3 text-sm text-gray-500" id="gen-step-2">
                                <span class="w-5 h-5 rounded-full bg-gray-700 flex items-center justify-center">‚óã</span>
                                <span id="gen-label-2">Selecting optimal AI model</span>
                            </div>
                            <div class="flex items-center gap-3 text-sm text-gray-500" id="gen-step-3">
                                <span class="w-5 h-5 rounded-full bg-gray-700 flex items-center justify-center">‚óã</span>
                                <span id="gen-label-3">Defining tasks & capabilities</span>
                            </div>
                            <div class="flex items-center gap-3 text-sm text-gray-500" id="gen-step-4">
                                <span class="w-5 h-5 rounded-full bg-gray-700 flex items-center justify-center">‚óã</span>
                                <span id="gen-label-4">Recommending tools</span>
                            </div>
                            <div class="flex items-center gap-3 text-sm text-gray-500" id="gen-step-5">
                                <span class="w-5 h-5 rounded-full bg-gray-700 flex items-center justify-center">‚óã</span>
                                <span id="gen-label-5">Setting up guardrails</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 1: Basics (AI-Generated, Editable) -->
                <div id="wizard-step-1" class="hidden max-w-5xl mx-auto">
                    <div class="flex items-center gap-2 mb-4">
                        <span class="text-xl">‚öôÔ∏è</span>
                        <div>
                            <h3 class="text-lg font-bold">Basic Configuration</h3>
                            <p class="text-xs text-gray-400" id="wizard-step1-subtitle">Recommended settings based on your goal</p>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-12 gap-4">
                        <!-- Main Config - Left Side -->
                        <div class="lg:col-span-8 space-y-4">
                            <!-- Agent Identity - Compact -->
                            <div class="card rounded-xl p-4">
                                <h4 class="text-sm font-semibold mb-3 flex items-center gap-2 text-gray-300">
                                    <span>ü§ñ</span> Agent Identity
                                </h4>
                                <div class="flex gap-4">
                                    <!-- Icon Upload -->
                                    <div class="flex-shrink-0">
                                        <label class="text-xs text-gray-400 mb-1 block">Icon</label>
                                        <div class="relative">
                                            <div id="w-icon-preview" class="w-16 h-16 rounded-xl bg-gray-800 border-2 border-dashed border-gray-600 hover:border-purple-500 cursor-pointer flex items-center justify-center text-2xl transition-all"
                                                 onclick="document.getElementById('w-icon-upload').click()">
                                                <span id="w-icon-emoji">ü§ñ</span>
                                                <img id="w-icon-image" class="hidden w-full h-full object-cover rounded-xl" src="" alt="Icon">
                                            </div>
                                            <input type="file" id="w-icon-upload" class="hidden" accept="image/*" onchange="handleIconUpload(event)">
                                            <input type="hidden" id="w-icon" value="ü§ñ">
                                            <input type="hidden" id="w-icon-type" value="emoji">
                                            <input type="hidden" id="w-icon-data" value="">
                                            <button onclick="showIconPicker()" class="absolute -bottom-1 -right-1 w-6 h-6 bg-purple-600 rounded-full text-xs flex items-center justify-center hover:bg-purple-500 transition" title="Change icon">
                                                ‚úèÔ∏è
                                            </button>
                                        </div>
                                        <p class="text-[10px] text-gray-500 mt-1 text-center">Click to upload</p>
                                    </div>
                                    <!-- Name -->
                                    <div class="flex-1">
                                        <label class="text-xs text-gray-400 mb-1 block">Name *</label>
                                        <input type="text" id="w-name" class="input-field w-full rounded-lg px-3 py-2 text-sm" placeholder="Agent Name" oninput="updateAgentNameInPersonality()">
                                        <p class="text-[10px] text-purple-400 mt-1" id="w-name-hint">Choose a clear name your users will recognize.</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Enhanced Goal - Compact -->
                            <div class="card rounded-xl p-4">
                                <div class="flex items-center justify-between mb-2">
                                    <h4 class="text-sm font-semibold flex items-center gap-2 text-gray-300">
                                        <span>üéØ</span> Enhanced Goal
                                        <span id="goal-ai-badge" class="text-[10px] bg-purple-500/20 text-purple-300 px-1.5 py-0.5 rounded">AI Generated</span>
                                    </h4>
                                    <div id="goal-update-indicator" class="hidden flex items-center gap-2">
                                        <div class="w-3 h-3 border-2 border-purple-500 border-t-transparent rounded-full animate-spin"></div>
                                        <span class="text-[10px] text-purple-400">Updating recommendations...</span>
                                    </div>
                                </div>
                                <textarea id="w-goal" rows="3" class="input-field w-full rounded-lg px-3 py-2 text-sm" placeholder="Your agent's goal..." oninput="onGoalChange()"></textarea>
                                <p class="text-[10px] text-gray-500 mt-1" id="goal-hint">Describe the outcome in clear business terms.</p>
                            </div>
                            
                            <!-- Personality - Interactive Sliders -->
                            <div class="card rounded-xl p-4">
                                <div class="flex items-center justify-between mb-4">
                                    <h4 class="text-sm font-semibold flex items-center gap-2 text-gray-300">
                                        <span>üé≠</span> Personality Configuration
                                    </h4>
                                    <button onclick="resetPersonalityDefaults()" class="text-[10px] text-gray-500 hover:text-gray-300 transition">
                                        ‚Ü∫ Reset to Defaults
                                    </button>
                                </div>
                                
                                <!-- Personality Preview -->
                                <div class="bg-gradient-to-r from-purple-900/20 to-blue-900/20 border border-purple-500/20 rounded-lg p-3 mb-4">
                                    <div class="flex items-start gap-2">
                                        <span class="text-lg">‚ú®</span>
                                        <div class="flex-1">
                                            <p class="text-xs font-medium text-purple-300 mb-1">Personality Preview</p>
                                            <p class="text-xs text-gray-400" id="personality-preview-text">
                                                Your agent will be professional and balanced in responses.
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Personality Sliders -->
                                <div class="space-y-4" id="personality-sliders">
                                    
                                    <!-- Creativity Slider -->
                                    <div class="personality-slider-group">
                                        <div class="flex items-center justify-between mb-1">
                                            <div class="flex items-center gap-2">
                                                <span class="text-sm">üé®</span>
                                                <span class="text-xs font-medium text-gray-300">Creativity</span>
                                            </div>
                                            <div class="flex items-center gap-2">
                                                <input type="number" id="p-creativity-num" min="1" max="10" value="5" 
                                                       class="w-12 text-center text-xs bg-gray-800 text-white border border-gray-700 rounded px-1 py-0.5"
                                                       onchange="syncSlider('creativity', this.value)">
                                                <span class="text-[10px] text-gray-500">/10</span>
                                            </div>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <span class="text-[10px] text-gray-500 w-16">Factual</span>
                                            <input type="range" id="p-creativity" min="1" max="10" value="5" 
                                                   class="personality-slider flex-1" 
                                                   oninput="updatePersonalitySlider('creativity', this.value)">
                                            <span class="text-[10px] text-gray-500 w-16 text-right">Creative</span>
                                        </div>
                                        <p class="text-[10px] text-gray-500 mt-1 ml-6" id="p-creativity-desc">
                                            Balanced between facts and creative suggestions.
                                        </p>
                                    </div>
                                    
                                    <!-- Response Length Slider -->
                                    <div class="personality-slider-group">
                                        <div class="flex items-center justify-between mb-1">
                                            <div class="flex items-center gap-2">
                                                <span class="text-sm">üìè</span>
                                                <span class="text-xs font-medium text-gray-300">Response Length</span>
                                            </div>
                                            <div class="flex items-center gap-2">
                                                <input type="number" id="p-length-num" min="1" max="10" value="5" 
                                                       class="w-12 text-center text-xs bg-gray-800 text-white border border-gray-700 rounded px-1 py-0.5"
                                                       onchange="syncSlider('length', this.value)">
                                                <span class="text-[10px] text-gray-500">/10</span>
                                            </div>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <span class="text-[10px] text-gray-500 w-16">Brief</span>
                                            <input type="range" id="p-length" min="1" max="10" value="5" 
                                                   class="personality-slider flex-1" 
                                                   oninput="updatePersonalitySlider('length', this.value)">
                                            <span class="text-[10px] text-gray-500 w-16 text-right">Detailed</span>
                                        </div>
                                        <p class="text-[10px] text-gray-500 mt-1 ml-6" id="p-length-desc">
                                            Moderately detailed responses with key information.
                                        </p>
                                    </div>
                                    
                                    <!-- Formality Slider -->
                                    <div class="personality-slider-group">
                                        <div class="flex items-center justify-between mb-1">
                                            <div class="flex items-center gap-2">
                                                <span class="text-sm">üëî</span>
                                                <span class="text-xs font-medium text-gray-300">Formality</span>
                                            </div>
                                            <div class="flex items-center gap-2">
                                                <input type="number" id="p-formality-num" min="1" max="10" value="7" 
                                                       class="w-12 text-center text-xs bg-gray-800 text-white border border-gray-700 rounded px-1 py-0.5"
                                                       onchange="syncSlider('formality', this.value)">
                                                <span class="text-[10px] text-gray-500">/10</span>
                                            </div>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <span class="text-[10px] text-gray-500 w-16">Casual</span>
                                            <input type="range" id="p-formality" min="1" max="10" value="7" 
                                                   class="personality-slider flex-1" 
                                                   oninput="updatePersonalitySlider('formality', this.value)">
                                            <span class="text-[10px] text-gray-500 w-16 text-right">Formal</span>
                                        </div>
                                        <p class="text-[10px] text-gray-500 mt-1 ml-6" id="p-formality-desc">
                                            Professional tone suitable for business communication.
                                        </p>
                                    </div>
                                    
                                    <!-- Empathy Slider -->
                                    <div class="personality-slider-group">
                                        <div class="flex items-center justify-between mb-1">
                                            <div class="flex items-center gap-2">
                                                <span class="text-sm">üíó</span>
                                                <span class="text-xs font-medium text-gray-300">Empathy</span>
                                            </div>
                                            <div class="flex items-center gap-2">
                                                <input type="number" id="p-empathy-num" min="1" max="10" value="6" 
                                                       class="w-12 text-center text-xs bg-gray-800 text-white border border-gray-700 rounded px-1 py-0.5"
                                                       onchange="syncSlider('empathy', this.value)">
                                                <span class="text-[10px] text-gray-500">/10</span>
                                            </div>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <span class="text-[10px] text-gray-500 w-16">Direct</span>
                                            <input type="range" id="p-empathy" min="1" max="10" value="6" 
                                                   class="personality-slider flex-1" 
                                                   oninput="updatePersonalitySlider('empathy', this.value)">
                                            <span class="text-[10px] text-gray-500 w-16 text-right">Empathetic</span>
                                        </div>
                                        <p class="text-[10px] text-gray-500 mt-1 ml-6" id="p-empathy-desc">
                                            Shows understanding while staying solution-focused.
                                        </p>
                                    </div>
                                    
                                    <!-- Proactivity Slider -->
                                    <div class="personality-slider-group">
                                        <div class="flex items-center justify-between mb-1">
                                            <div class="flex items-center gap-2">
                                                <span class="text-sm">üöÄ</span>
                                                <span class="text-xs font-medium text-gray-300">Proactivity</span>
                                            </div>
                                            <div class="flex items-center gap-2">
                                                <input type="number" id="p-proactivity-num" min="1" max="10" value="5" 
                                                       class="w-12 text-center text-xs bg-gray-800 text-white border border-gray-700 rounded px-1 py-0.5"
                                                       onchange="syncSlider('proactivity', this.value)">
                                                <span class="text-[10px] text-gray-500">/10</span>
                                            </div>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <span class="text-[10px] text-gray-500 w-16">Reactive</span>
                                            <input type="range" id="p-proactivity" min="1" max="10" value="5" 
                                                   class="personality-slider flex-1" 
                                                   oninput="updatePersonalitySlider('proactivity', this.value)">
                                            <span class="text-[10px] text-gray-500 w-16 text-right">Proactive</span>
                                        </div>
                                        <p class="text-[10px] text-gray-500 mt-1 ml-6" id="p-proactivity-desc">
                                            Answers questions and occasionally suggests next steps.
                                        </p>
                                    </div>
                                    
                                    <!-- Confidence Slider -->
                                    <div class="personality-slider-group">
                                        <div class="flex items-center justify-between mb-1">
                                            <div class="flex items-center gap-2">
                                                <span class="text-sm">üí™</span>
                                                <span class="text-xs font-medium text-gray-300">Confidence</span>
                                            </div>
                                            <div class="flex items-center gap-2">
                                                <input type="number" id="p-confidence-num" min="1" max="10" value="7" 
                                                       class="w-12 text-center text-xs bg-gray-800 text-white border border-gray-700 rounded px-1 py-0.5"
                                                       onchange="syncSlider('confidence', this.value)">
                                                <span class="text-[10px] text-gray-500">/10</span>
                                            </div>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <span class="text-[10px] text-gray-500 w-16">Cautious</span>
                                            <input type="range" id="p-confidence" min="1" max="10" value="7" 
                                                   class="personality-slider flex-1" 
                                                   oninput="updatePersonalitySlider('confidence', this.value)">
                                            <span class="text-[10px] text-gray-500 w-16 text-right">Confident</span>
                                        </div>
                                        <p class="text-[10px] text-gray-500 mt-1 ml-6" id="p-confidence-desc">
                                            Provides clear answers while acknowledging limitations when appropriate.
                                        </p>
                                    </div>
                                    
                                </div>
                            </div>
                        </div>
                        
                        <!-- LLM Model Selection - Right Side -->
                        <div class="lg:col-span-4">
                            <div class="card rounded-xl p-4 sticky top-4">
                                <h4 class="text-sm font-semibold mb-3 flex items-center gap-2 text-gray-300">
                                    <span>üß†</span> AI Model
                                </h4>
                                
                                <div id="llm-models-list" class="space-y-2 max-h-[280px] overflow-y-auto pr-1">
                                    <!-- Models will be populated dynamically based on configured providers -->
                                </div>
                                
                                <!-- Model Info -->
                                <div id="model-explanation" class="mt-3 p-2 bg-gray-800/50 rounded-lg text-xs">
                                    <p class="text-gray-400" id="model-why-text">Select a model to see details</p>
                                </div>
                                
                                <!-- Configure Link -->
                                <div class="mt-2 text-center">
                                    <a href="#" onclick="navigate('settings'); return false;" class="text-[10px] text-purple-400 hover:text-purple-300">
                                        ‚öôÔ∏è Configure API Keys in Settings
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Navigation handled by sticky header -->
                </div>

                <!-- Icon Picker Modal -->
                <div id="icon-picker-modal" class="hidden fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4">
                    <div class="modal-content-box rounded-xl p-4 w-full max-w-sm">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="font-semibold text-sm">Choose Icon</h3>
                            <button onclick="closeIconPicker()" class="text-gray-400 hover:text-white">‚úï</button>
                        </div>
                        
                        <div class="space-y-3">
                            <!-- Upload Option -->
                            <div class="p-3 rounded-lg border-2 border-dashed cursor-pointer transition text-center upload-box"
                                 style="background:var(--bg-input);border-color:var(--border-color);"
                                 onclick="document.getElementById('w-icon-upload').click(); closeIconPicker();">
                                <span class="text-2xl">üì§</span>
                                <p class="text-xs mt-1" style="color:var(--text-secondary);">Upload Image</p>
                                <p class="text-[10px]" style="color:var(--text-muted);">PNG, JPG, SVG (max 500KB)</p>
                            </div>
                            
                            <!-- Emoji Picker -->
                            <div>
                                <p class="text-xs mb-2" style="color:var(--text-secondary);">Or choose an emoji:</p>
                                <div id="emoji-grid" class="grid grid-cols-8 gap-1 max-h-32 overflow-y-auto">
                                    <!-- Emojis will be populated by JS -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Tasks (AI-Generated, Editable) -->
                <div id="wizard-step-2" class="hidden max-w-4xl mx-auto">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center gap-2">
                            <span class="text-2xl">üìã</span>
                            <div>
                                <h3 class="text-xl font-bold">Tasks & Capabilities</h3>
                                <p class="text-sm text-gray-400">What your agent can do. AI has suggested these based on your goal.</p>
                            </div>
                        </div>
                        <button onclick="addTask()" class="btn-primary px-4 py-2 rounded-lg text-sm flex items-center gap-2">
                            <span>+</span> Add Task
                        </button>
                    </div>
                    
                    <div id="w-tasks" class="space-y-4">
                        <!-- Tasks will be populated by JS -->
                    </div>
                    
                    <!-- Navigation handled by sticky header -->
                </div>

                <!-- Step 3: Tools Selection -->
                <div id="wizard-step-3" class="hidden max-w-4xl mx-auto">
                    <div class="flex items-center gap-3 mb-6">
                        <span class="text-2xl">üîß</span>
                        <div>
                            <h3 class="text-xl font-bold">Tools & Data Sources</h3>
                            <p class="text-sm text-gray-400">Select the tools your agent will use</p>
                        </div>
                    </div>
                    
                    <!-- Two Options -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <!-- Option 1: Select Configured Tool -->
                        <div onclick="showSelectToolModal()" class="card rounded-xl p-6 cursor-pointer hover:border-purple-500 transition-all border-2 border-transparent hover:bg-purple-500/5">
                            <div class="text-center">
                                <div class="w-16 h-16 mx-auto mb-4 rounded-2xl bg-purple-500/20 flex items-center justify-center">
                                    <span class="text-3xl">üì¶</span>
                                </div>
                                <h4 class="font-bold text-lg mb-2">Select Configured Tool</h4>
                                <p class="text-sm text-gray-400">Choose from existing tools you've already created</p>
                            </div>
                        </div>
                        
                        <!-- Configure New Tool option removed for cleaner UX -->
                    </div>
                    
                    <!-- Selected Tools -->
                    <div class="card rounded-xl p-5 mb-6">
                        <div class="flex items-center justify-between mb-4">
                            <h4 class="font-medium flex items-center gap-2">
                                <span>‚úÖ</span> Selected Tools
                                <span id="selected-tools-count" class="text-xs bg-purple-500/20 text-purple-300 px-2 py-0.5 rounded-full">0</span>
                            </h4>
                        </div>
                        <div id="w-tools-list" class="space-y-2">
                            <div class="text-center py-6 text-gray-500 text-sm">
                                <span class="text-2xl block mb-2">üîß</span>
                                No tools selected yet<br>
                                <span class="text-xs">Click one of the options above to add tools</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Navigation handled by sticky header -->
                </div>
                
                <!-- Select Tool Modal -->
                <div id="select-tool-modal" class="fixed inset-0 bg-black/70 hidden items-center justify-center z-50">
                    <div class="modal-content-box rounded-2xl w-full max-w-3xl mx-4 max-h-[85vh] overflow-hidden">
                        <div class="p-4 border-b border-gray-700 flex items-center justify-between">
                            <h3 class="font-bold text-lg">üì¶ Select Configured Tools</h3>
                            <button onclick="closeSelectToolModal()" class="p-2 hover:bg-gray-700 rounded-lg">‚úï</button>
                        </div>
                        <div class="p-6 overflow-y-auto max-h-[60vh]">
                            <div id="available-tools-list" class="space-y-3">
                                <div class="text-center py-8 text-gray-500">
                                    <div class="animate-spin w-6 h-6 border-2 border-purple-500 border-t-transparent rounded-full mx-auto mb-2"></div>
                                    <p class="text-sm">Loading tools...</p>
                                </div>
                            </div>
                        </div>
                        <div class="p-4 border-t border-gray-700 flex justify-end gap-2">
                            <button onclick="closeSelectToolModal()" class="px-4 py-2 rounded-lg bg-gray-700 hover:bg-gray-600">Cancel</button>
                            <button onclick="confirmToolSelection()" class="px-6 py-2 rounded-lg bg-purple-600 hover:bg-purple-500">Add Selected</button>
                        </div>
                    </div>
                </div>

                <!-- Step 4: Access Control (Separate Step) -->
                <div id="wizard-step-4" class="hidden max-w-4xl mx-auto">
                    <div class="flex items-center gap-2 mb-6">
                        <span class="text-2xl">üîê</span>
                        <div>
                            <h3 class="text-xl font-bold">Access Control</h3>
                            <p class="text-sm text-gray-400">Define who can use this agent and manage their permissions</p>
                        </div>
                    </div>
                    
                    <div class="space-y-6">
                        <!-- Access Control - Modern Design -->
                        <div id="wizard-access-control-section" class="rounded-2xl overflow-hidden" style="background: linear-gradient(145deg, rgba(139, 92, 246, 0.08) 0%, rgba(59, 130, 246, 0.05) 100%); border: 1px solid rgba(139, 92, 246, 0.2);">
                            
                            <!-- Header with ownership indicator -->
                            <div class="p-6 border-b border-purple-500/20" style="background: linear-gradient(90deg, rgba(139, 92, 246, 0.15) 0%, transparent 100%);">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-4">
                                        <div class="w-12 h-12 rounded-xl flex items-center justify-center" style="background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%); box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);">
                                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                                            </svg>
                                        </div>
                                        <div>
                                            <h4 class="text-lg font-bold text-white flex items-center gap-2">
                                                Access Control
                                                <span id="ac-owner-badge" class="hidden text-xs px-2 py-1 rounded-full font-medium" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: #fff;">
                                                    üëë Owner
                                                </span>
                                            </h4>
                                            <p class="text-sm text-gray-400">Define who can interact with this agent and their permissions</p>
                                        </div>
                                    </div>
                                    <div id="ac-quick-stats" class="hidden md:flex items-center gap-4 text-sm">
                                        <div class="text-center px-4 py-2 rounded-lg bg-white/5">
                                            <div class="text-2xl font-bold text-purple-400" id="ac-stat-users">0</div>
                                            <div class="text-xs text-gray-500">Users</div>
                                        </div>
                                        <div class="text-center px-4 py-2 rounded-lg bg-white/5">
                                            <div class="text-2xl font-bold text-blue-400" id="ac-stat-groups">0</div>
                                            <div class="text-xs text-gray-500">Groups</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="p-6 space-y-8">
                                
                                <!-- Step 1: Access Level Selection -->
                                <div class="space-y-4">
                                    <div class="flex items-center gap-3">
                                        <div class="w-8 h-8 rounded-full bg-purple-500/20 text-purple-400 flex items-center justify-center font-bold text-sm">1</div>
                                        <div>
                                            <h5 class="font-semibold text-white">Access Level</h5>
                                            <p class="text-xs text-gray-500">Who should be able to use this agent?</p>
                                        </div>
                                    </div>
                                    
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4" id="wizard-access-type-container">
                                        <!-- Public Access -->
                                        <div class="access-type-card group cursor-pointer rounded-2xl p-5 transition-all duration-300 hover:scale-[1.02]" 
                                             data-value="public" 
                                             onclick="selectWizardAccessType('public')"
                                             style="background: rgba(34, 197, 94, 0.05); border: 2px solid rgba(34, 197, 94, 0.2);">
                                            <div class="flex items-start gap-4">
                                                <div class="w-12 h-12 rounded-xl flex items-center justify-center flex-shrink-0 transition-all group-hover:scale-110" style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.2) 0%, rgba(34, 197, 94, 0.1) 100%);">
                                                    <svg class="w-6 h-6 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                                    </svg>
                                                </div>
                                                <div class="flex-1">
                                                    <h6 class="font-semibold text-white mb-1">Public</h6>
                                                    <p class="text-xs text-gray-400 leading-relaxed">Anyone can access without logging in. Best for public-facing assistants.</p>
                                                </div>
                                                <div class="access-check hidden w-6 h-6 rounded-full bg-green-500 flex items-center justify-center flex-shrink-0">
                                                    <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/>
                                                    </svg>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Authenticated Access -->
                                        <div class="access-type-card group cursor-pointer rounded-2xl p-5 transition-all duration-300 hover:scale-[1.02] ac-selected" 
                                             data-value="authenticated" 
                                             onclick="selectWizardAccessType('authenticated')"
                                             style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.15) 0%, rgba(59, 130, 246, 0.05) 100%); border: 2px solid rgba(59, 130, 246, 0.5); box-shadow: 0 4px 20px rgba(59, 130, 246, 0.2);">
                                            <div class="flex items-start gap-4">
                                                <div class="w-12 h-12 rounded-xl flex items-center justify-center flex-shrink-0 transition-all group-hover:scale-110" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.3) 0%, rgba(59, 130, 246, 0.1) 100%);">
                                                    <svg class="w-6 h-6 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"/>
                                                    </svg>
                                                </div>
                                                <div class="flex-1">
                                                    <h6 class="font-semibold text-white mb-1">Authenticated</h6>
                                                    <p class="text-xs text-gray-400 leading-relaxed">Any logged-in user in your organization can access. Recommended for internal tools.</p>
                                                    <span class="inline-block mt-2 text-xs px-2 py-0.5 rounded-full bg-blue-500/20 text-blue-400">Recommended</span>
                                                </div>
                                                <div class="access-check w-6 h-6 rounded-full bg-blue-500 flex items-center justify-center flex-shrink-0">
                                                    <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/>
                                                    </svg>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Specific Users -->
                                        <div class="access-type-card group cursor-pointer rounded-2xl p-5 transition-all duration-300 hover:scale-[1.02]" 
                                             data-value="specific" 
                                             onclick="selectWizardAccessType('specific')"
                                             style="background: rgba(168, 85, 247, 0.05); border: 2px solid rgba(168, 85, 247, 0.2);">
                                            <div class="flex items-start gap-4">
                                                <div class="w-12 h-12 rounded-xl flex items-center justify-center flex-shrink-0 transition-all group-hover:scale-110" style="background: linear-gradient(135deg, rgba(168, 85, 247, 0.2) 0%, rgba(168, 85, 247, 0.1) 100%);">
                                                    <svg class="w-6 h-6 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                                                    </svg>
                                                </div>
                                                <div class="flex-1">
                                                    <h6 class="font-semibold text-white mb-1">Specific Users</h6>
                                                    <p class="text-xs text-gray-400 leading-relaxed">Only selected users and groups can access. Maximum control over who uses this agent.</p>
                                                </div>
                                                <div class="access-check hidden w-6 h-6 rounded-full bg-purple-500 flex items-center justify-center flex-shrink-0">
                                                    <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/>
                                                    </svg>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Step 2: User/Group Selection (shown when "specific" is selected) -->
                                <div id="wizard-access-specific-section" class="hidden space-y-4 animate-fadeIn">
                                    <div class="flex items-center gap-3">
                                        <div class="w-8 h-8 rounded-full bg-purple-500/20 text-purple-400 flex items-center justify-center font-bold text-sm">2</div>
                                        <div>
                                            <h5 class="font-semibold text-white">Select Users & Groups</h5>
                                            <p class="text-xs text-gray-500">Choose who can access this agent</p>
                                        </div>
                                    </div>
                                    
                                    <!-- Smart Search -->
                                    <div class="relative">
                                        <div class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400">
                                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                                            </svg>
                                        </div>
                                        <input type="text" id="wizard-access-search" 
                                               class="w-full rounded-xl px-12 py-4 transition-all focus:ring-2 focus:ring-blue-500/50" 
                                               style="background: var(--bg-input); border: 2px solid var(--input-border); color: var(--text-primary);"
                                               placeholder="Search by name, email, or group...">
                                        <div class="absolute right-4 top-1/2 -translate-y-1/2 text-xs text-gray-400 hidden md:block">
                                            Press <kbd class="px-1.5 py-0.5 rounded bg-gray-600 text-gray-200">Enter</kbd> to add
                                        </div>
                                    </div>
                                    
                                    <!-- Search Results Dropdown -->
                                    <div id="wizard-access-search-results" class="hidden mt-2 rounded-xl overflow-hidden shadow-xl" style="background: var(--bg-card); border: 2px solid var(--input-border);">
                                        <!-- Results will be populated dynamically -->
                                    </div>
                                    
                                    <!-- Selected Entities -->
                                    <div id="wizard-access-selected" class="flex flex-wrap gap-3">
                                        <div class="text-sm text-gray-500 italic py-2">Select users or groups from the search above</div>
                                    </div>
                                </div>
                                
                                <!-- Step 3: Task Permissions -->
                                <div id="wizard-task-permissions-section" class="hidden space-y-4 animate-fadeIn">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center gap-3">
                                            <div class="w-8 h-8 rounded-full bg-purple-500/20 text-purple-400 flex items-center justify-center font-bold text-sm">3</div>
                                            <div>
                                                <h5 class="font-semibold text-white">Task Permissions</h5>
                                                <p class="text-xs text-gray-500">Fine-tune which tasks each user can perform</p>
                                            </div>
                                        </div>
                                        <div class="flex gap-2">
                                            <button onclick="allowAllTasks()" class="px-3 py-1.5 text-xs rounded-lg bg-green-500/20 text-green-400 hover:bg-green-500/30 transition-all flex items-center gap-1">
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                                </svg>
                                                Allow All
                                            </button>
                                            <button onclick="denyAllTasks()" class="px-3 py-1.5 text-xs rounded-lg bg-red-500/20 text-red-400 hover:bg-red-500/30 transition-all flex items-center gap-1">
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                                </svg>
                                                Deny All
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div id="wizard-task-permissions-grid" class="space-y-3 rounded-xl p-4" style="background: rgba(0,0,0,0.2);">
                                        <p class="text-sm text-gray-500 italic text-center py-4">Define tasks in the Tasks step first</p>
                                    </div>
                                </div>
                                
                                <!-- Step 4: Delegate Admin Access (Owner Only) -->
                                <div id="wizard-delegate-admin-section" class="hidden space-y-4 animate-fadeIn">
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="w-8 h-8 rounded-full bg-amber-500/20 text-amber-400 flex items-center justify-center font-bold text-sm">4</div>
                                        <div>
                                            <h5 class="font-semibold text-white flex items-center gap-2">
                                                Delegate Agent Management
                                                <span class="text-xs px-2 py-0.5 rounded-full bg-amber-500/20 text-amber-400">Owner Only</span>
                                            </h5>
                                            <p class="text-xs text-gray-500">Grant specific permissions to other users to help manage this agent</p>
                                        </div>
                                    </div>
                                    
                                    <div class="rounded-xl p-5" style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(217, 119, 6, 0.05) 100%); border: 1px solid rgba(245, 158, 11, 0.3);">
                                        
                                        <!-- Search for admins -->
                                        <div class="mb-5">
                                            <label class="text-sm font-medium text-gray-300 mb-2 block">Add Admin</label>
                                            <div class="relative">
                                                <div class="absolute left-4 top-1/2 -translate-y-1/2 text-amber-400/50">
                                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                                                    </svg>
                                                </div>
                                                <input type="text" id="wizard-admin-search" 
                                                       class="w-full rounded-xl px-12 py-3 transition-all focus:ring-2 focus:ring-amber-500/50" 
                                                       style="background: var(--bg-input); border: 2px solid var(--input-border); color: var(--text-primary);"
                                                       placeholder="Search users or groups to add as admin...">
                                            </div>
                                            <div id="wizard-admin-search-results" class="hidden mt-2 rounded-xl overflow-hidden max-h-48 overflow-y-auto shadow-xl" style="background: var(--bg-card); border: 2px solid var(--input-border);">
                                            </div>
                                        </div>
                                        
                                        <!-- Current Delegated Admins with Permissions -->
                                        <div class="space-y-4">
                                            <div class="flex items-center justify-between">
                                                <h6 class="text-sm font-medium text-gray-300">Delegated Admins & Permissions</h6>
                                                <button type="button" onclick="showPermissionsGuide()" class="text-xs text-amber-400 hover:text-amber-300 flex items-center gap-1">
                                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                                    </svg>
                                                    What do permissions mean?
                                                </button>
                                            </div>
                                            
                                            <div id="wizard-delegated-admins-list" class="space-y-3">
                                                <div class="text-sm text-gray-500 italic text-center py-4">
                                                    You are the only admin. Search above to add users or groups.
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Permissions Quick Reference (initially hidden) -->
                                        <div id="permissions-guide" class="hidden mt-5 p-4 rounded-lg" style="background: rgba(0,0,0,0.3);">
                                            <h6 class="text-sm font-medium text-amber-400 mb-3">üìã Permission Reference</h6>
                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-xs">
                                                <div class="space-y-2">
                                                    <div class="font-medium text-white">üé® Configuration</div>
                                                    <div class="text-gray-400 pl-4">
                                                        <div><span class="text-blue-400">edit_basic_info:</span> Name, icon, description</div>
                                                        <div><span class="text-blue-400">edit_personality:</span> Agent personality</div>
                                                        <div><span class="text-blue-400">edit_model:</span> LLM model selection</div>
                                                        <div><span class="text-blue-400">edit_guardrails:</span> Safety settings</div>
                                                    </div>
                                                </div>
                                                <div class="space-y-2">
                                                    <div class="font-medium text-white">üß© Components</div>
                                                    <div class="text-gray-400 pl-4">
                                                        <div><span class="text-purple-400">manage_tasks:</span> Add/edit/delete tasks</div>
                                                        <div><span class="text-purple-400">manage_tools:</span> Add/edit/delete tools</div>
                                                        <div><span class="text-purple-400">manage_knowledge:</span> Knowledge base</div>
                                                    </div>
                                                </div>
                                                <div class="space-y-2">
                                                    <div class="font-medium text-white">üîê Access Control</div>
                                                    <div class="text-gray-400 pl-4">
                                                        <div><span class="text-green-400">manage_access:</span> End-user access</div>
                                                        <div><span class="text-green-400">manage_task_permissions:</span> Task permissions</div>
                                                    </div>
                                                </div>
                                                <div class="space-y-2">
                                                    <div class="font-medium text-white">üöÄ Deployment</div>
                                                    <div class="text-gray-400 pl-4">
                                                        <div><span class="text-yellow-400">publish_agent:</span> Publish/unpublish</div>
                                                        <div><span class="text-red-400">delete_agent:</span> Delete (dangerous!)</div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="mt-3 pt-3 border-t border-gray-700">
                                                <div class="flex items-center gap-2 text-xs text-amber-400">
                                                    <span>‚≠ê</span>
                                                    <span><strong>full_admin</strong> = All permissions except delete_agent</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                    </div>
                    
                    <!-- Navigation handled by sticky header -->
                </div>

                <!-- Step 5: Guardrails & Safety (Moved from Step 4) -->
                <div id="wizard-step-5" class="hidden max-w-4xl mx-auto">
                    <div class="flex items-center gap-2 mb-6">
                        <span class="text-2xl">üõ°Ô∏è</span>
                        <div>
                            <h3 class="text-xl font-bold">Guardrails & Safety</h3>
                            <p class="text-sm text-gray-400">Protect your agent and users with these safety settings</p>
                        </div>
                    </div>
                    
                    <div class="space-y-6">
                        <!-- Anti-Hallucination -->
                        <div class="card rounded-xl p-6">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center gap-3">
                                    <span class="text-2xl">üéØ</span>
                                    <div>
                                        <h4 class="font-semibold">Anti-Hallucination</h4>
                                        <p class="text-sm text-gray-400">Ensure your agent only provides accurate information</p>
                                    </div>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="guard-anti-hallucination" class="sr-only peer" checked>
                                    <div class="w-11 h-6 bg-red-400 peer-focus:ring-2 peer-focus:ring-green-400 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-500"></div>
                                </label>
                            </div>
                            <div id="anti-hallucination-options" class="space-y-3 pl-10">
                                <label class="flex items-center gap-3 cursor-pointer">
                                    <input type="checkbox" id="guard-cite-sources" class="w-4 h-4 rounded" checked>
                                    <div>
                                        <span class="text-sm">Always cite sources</span>
                                        <p class="text-xs text-gray-500">Agent must reference where information comes from</p>
                                    </div>
                                </label>
                                <label class="flex items-center gap-3 cursor-pointer">
                                    <input type="checkbox" id="guard-admit-uncertainty" class="w-4 h-4 rounded" checked>
                                    <div>
                                        <span class="text-sm">Admit when uncertain</span>
                                        <p class="text-xs text-gray-500">Say "I don't know" instead of guessing</p>
                                    </div>
                                </label>
                                <label class="flex items-center gap-3 cursor-pointer">
                                    <input type="checkbox" id="guard-verify-facts" class="w-4 h-4 rounded" checked>
                                    <div>
                                        <span class="text-sm">Verify against knowledge base</span>
                                        <p class="text-xs text-gray-500">Cross-check answers with your data sources</p>
                                    </div>
                                </label>
                                <label class="flex items-center gap-3 cursor-pointer">
                                    <input type="checkbox" id="guard-no-speculation" class="w-4 h-4 rounded">
                                    <div>
                                        <span class="text-sm">No speculation</span>
                                        <p class="text-xs text-gray-500">Only state confirmed facts, never hypothesize</p>
                                    </div>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Content Boundaries -->
                        <div class="card rounded-xl p-6">
                            <div class="flex items-center gap-3 mb-4">
                                <span class="text-2xl">üöß</span>
                                <div>
                                    <h4 class="font-semibold">Content Boundaries</h4>
                                    <p class="text-sm text-gray-400">Define what your agent should and shouldn't discuss</p>
                                </div>
                            </div>
                            <div class="space-y-4">
                                <div>
                                    <label class="text-sm text-gray-400 mb-2 block">Topics to AVOID (one per line)</label>
                                    <textarea id="guard-avoid-topics" rows="3" class="input-field w-full rounded-lg px-4 py-3 text-sm" placeholder="Competitor pricing&#10;Legal advice&#10;Medical diagnoses"></textarea>
                                </div>
                                <div>
                                    <label class="text-sm text-gray-400 mb-2 block">Stay focused on (optional)</label>
                                    <textarea id="guard-focus-topics" rows="2" class="input-field w-full rounded-lg px-4 py-3 text-sm" placeholder="Only discuss topics related to your business"></textarea>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Response Limits -->
                        <div class="card rounded-xl p-6">
                            <div class="flex items-center gap-3 mb-4">
                                <span class="text-2xl">üìè</span>
                                <div>
                                    <h4 class="font-semibold">Response Limits</h4>
                                    <p class="text-sm text-gray-400">Control how your agent responds</p>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="text-sm text-gray-400 mb-2 block">Max response length</label>
                                    <select id="guard-max-length" class="input-field w-full rounded-lg px-4 py-3">
                                        <option value="short">Short (1-2 paragraphs)</option>
                                        <option value="medium" selected>Medium (3-4 paragraphs)</option>
                                        <option value="long">Long (detailed explanations)</option>
                                        <option value="unlimited">Unlimited</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="text-sm text-gray-400 mb-2 block">Language</label>
                                    <select id="guard-language" class="input-field w-full rounded-lg px-4 py-3">
                                        <option value="user">Match user's language</option>
                                        <option value="en">English only</option>
                                        <option value="ar">Arabic only</option>
                                        <option value="multi">Multilingual</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Escalation Rules -->
                        <div class="card rounded-xl p-6">
                            <div class="flex items-center gap-3 mb-4">
                                <span class="text-2xl">üö®</span>
                                <div>
                                    <h4 class="font-semibold">Escalation Rules</h4>
                                    <p class="text-sm text-gray-400">When to hand off to a human</p>
                                </div>
                            </div>
                            <div class="space-y-3">
                                <label class="flex items-center gap-3 cursor-pointer">
                                    <input type="checkbox" id="guard-escalate-angry" class="w-4 h-4 rounded" checked>
                                    <span class="text-sm">Escalate frustrated or angry users</span>
                                </label>
                                <label class="flex items-center gap-3 cursor-pointer">
                                    <input type="checkbox" id="guard-escalate-complex" class="w-4 h-4 rounded" checked>
                                    <span class="text-sm">Escalate complex issues agent can't handle</span>
                                </label>
                                <label class="flex items-center gap-3 cursor-pointer">
                                    <input type="checkbox" id="guard-escalate-request" class="w-4 h-4 rounded" checked>
                                    <span class="text-sm">Escalate when user asks for human</span>
                                </label>
                                <label class="flex items-center gap-3 cursor-pointer">
                                    <input type="checkbox" id="guard-escalate-sensitive" class="w-4 h-4 rounded">
                                    <span class="text-sm">Escalate sensitive topics (legal, financial)</span>
                                </label>
                            </div>
                        </div>
                        
                        <!-- PII Protection -->
                        <div class="card rounded-xl p-6">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center gap-3">
                                    <span class="text-2xl">üîê</span>
                                    <div>
                                        <h4 class="font-semibold">PII Protection</h4>
                                        <p class="text-sm text-gray-400">Protect personal information</p>
                                    </div>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="guard-pii-protection" class="sr-only peer" checked>
                                    <div class="w-11 h-6 bg-red-400 peer-focus:ring-2 peer-focus:ring-green-400 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-500"></div>
                                </label>
                            </div>
                            <div class="space-y-3 pl-10">
                                <label class="flex items-center gap-3 cursor-pointer">
                                    <input type="checkbox" id="guard-mask-pii" class="w-4 h-4 rounded" checked>
                                    <span class="text-sm">Mask sensitive data in logs (SSN, credit cards)</span>
                                </label>
                                <label class="flex items-center gap-3 cursor-pointer">
                                    <input type="checkbox" id="guard-no-store-pii" class="w-4 h-4 rounded" checked>
                                    <span class="text-sm">Don't store personal data in conversation history</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Navigation handled by sticky header -->
                </div>

                <!-- Step 6: Preview -->
                <div id="wizard-step-6" class="hidden max-w-4xl mx-auto">
                    <div class="flex items-center gap-2 mb-6">
                        <span class="text-2xl">üëÅÔ∏è</span>
                        <div>
                            <h3 class="text-xl font-bold">Review Your Agent</h3>
                            <p class="text-sm text-gray-400">Make sure everything looks good before testing</p>
                        </div>
                    </div>
                    
                    <div id="w-preview" class="space-y-4">
                        <!-- Preview content will be populated by JS -->
                    </div>
                    
                    <!-- Navigation handled by sticky header -->
                </div>

                <!-- Step 7: Test -->
                <div id="wizard-step-7" class="hidden max-w-4xl mx-auto">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center gap-2">
                            <span class="text-2xl">üß™</span>
                            <div>
                                <h3 class="text-xl font-bold">Test Your Agent</h3>
                                <p class="text-sm text-gray-400">Try a conversation to see how your agent responds</p>
                            </div>
                        </div>
                        <button onclick="resetTestConversation()" class="btn-secondary px-4 py-2 rounded-lg text-sm flex items-center gap-2" title="Clear conversation and start fresh">
                            üîÑ Reset Chat
                        </button>
                    </div>
                    
                    <div class="card rounded-xl p-4 md:p-6 mb-4">
                        <div id="test-messages" class="h-64 md:h-80 overflow-y-auto rounded-lg p-4 mb-4 space-y-3" style="background:var(--bg-primary);"></div>
                        <div id="test-attachments" class="hidden flex flex-wrap gap-2 mb-2"></div>
                        <div class="flex gap-2 items-end">
                            <button onclick="document.getElementById('test-file-input').click()" class="btn-secondary p-2 rounded-lg flex-shrink-0" title="Attach file">
                                üìé
                            </button>
                            <input type="file" id="test-file-input" class="hidden" accept=".pdf,.doc,.docx,.txt,.csv,.xlsx,.xls,.pptx,.ppt,.md,.png,.jpg,.jpeg,.gif,.webp,.bmp,.svg" onchange="handleTestFile(event)" multiple>
                            <input type="text" id="test-input" class="input-field flex-1 rounded-lg px-4 py-3" placeholder="Ask your agent something..." onkeypress="if(event.key==='Enter')sendTest()">
                            <button onclick="sendTest()" class="btn-primary px-6 py-3 rounded-lg">Send</button>
                        </div>
                    </div>
                    
                    <div class="card rounded-xl p-4 mb-4">
                        <h4 class="text-sm font-medium mb-3">üí° Try asking:</h4>
                        <div id="test-suggestions" class="flex flex-wrap gap-2">
                            <!-- Suggestions will be populated based on agent goal -->
                        </div>
                    </div>
                    
                    <!-- Deploy buttons are in sticky header - removed duplicate section -->
                </div>

                <!-- Step 8: Deploy (kept for direct navigation) -->
                <div id="wizard-step-8" class="hidden max-w-4xl mx-auto">
                    <div class="flex items-center gap-2 mb-6">
                        <span class="text-2xl">üöÄ</span>
                        <div>
                            <h3 class="text-xl font-bold">Deploy Your Agent</h3>
                            <p class="text-sm text-gray-400">Choose how to save and deploy your agent</p>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <!-- Save as Draft -->
                        <div class="card rounded-xl p-6 border-2 border-transparent hover:border-gray-600 cursor-pointer transition" onclick="selectDeployOption('draft')">
                            <div class="flex items-center gap-4 mb-4">
                                <div class="w-12 h-12 rounded-xl bg-gray-700 flex items-center justify-center text-2xl">üíæ</div>
                                <div>
                                    <h4 class="font-semibold">Save as Draft</h4>
                                    <p class="text-sm text-gray-400">Continue editing later</p>
                                </div>
                            </div>
                            <p class="text-sm text-gray-500">Your agent will be saved but not active. You can come back and finish the configuration anytime.</p>
                        </div>
                        
                        <!-- Deploy Now -->
                        <div class="card rounded-xl p-6 border-2 border-purple-500 bg-purple-500/10 cursor-pointer" onclick="selectDeployOption('deploy')">
                            <div class="flex items-center gap-4 mb-4">
                                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center text-2xl">üöÄ</div>
                                <div>
                                    <h4 class="font-semibold">Deploy Now</h4>
                                    <p class="text-sm text-gray-400">Make your agent live</p>
                                </div>
                            </div>
                            <p class="text-sm text-gray-500">Your agent will be published and ready to use immediately.</p>
                        </div>
                    </div>
                    
                    <!-- Deployment Options (shown when Deploy is selected) -->
                    <div id="deploy-options" class="hidden space-y-6">
                        <h4 class="font-semibold flex items-center gap-2">
                            <span>‚òÅÔ∏è</span> Deployment Target
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <!-- Cloud Deployment -->
                            <div class="card rounded-xl p-4 border-2 border-transparent hover:border-purple-500 cursor-pointer transition deploy-target" data-target="cloud" onclick="selectDeployTarget('cloud')">
                                <div class="flex items-center gap-3 mb-3">
                                    <span class="text-2xl">‚òÅÔ∏è</span>
                                    <div>
                                        <h5 class="font-medium">Cloud Hosted</h5>
                                        <p class="text-xs text-gray-400">We manage everything for you</p>
                                    </div>
                                </div>
                                <ul class="text-xs text-gray-500 space-y-1">
                                    <li>‚úì No infrastructure to manage</li>
                                    <li>‚úì Auto-scaling</li>
                                    <li>‚úì 99.9% uptime SLA</li>
                                </ul>
                            </div>
                            
                            <!-- On-Premises -->
                            <div class="card rounded-xl p-4 border-2 border-transparent hover:border-purple-500 cursor-pointer transition deploy-target" data-target="onprem" onclick="selectDeployTarget('onprem')">
                                <div class="flex items-center gap-3 mb-3">
                                    <span class="text-2xl">üè¢</span>
                                    <div>
                                        <h5 class="font-medium">On-Premises</h5>
                                        <p class="text-xs text-gray-400">Deploy in your own infrastructure</p>
                                    </div>
                                </div>
                                <ul class="text-xs text-gray-500 space-y-1">
                                    <li>‚úì Full data control</li>
                                    <li>‚úì Custom security policies</li>
                                    <li>‚úì Air-gapped environments</li>
                                </ul>
                            </div>
                        </div>
                        
                        <!-- Cloud Provider Selection -->
                        <div id="cloud-providers" class="hidden">
                            <h5 class="text-sm font-medium text-gray-400 mb-3">Select Cloud Provider</h5>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                <div class="card rounded-lg p-3 text-center cursor-pointer border-2 border-transparent hover:border-purple-500 transition cloud-provider" data-provider="aws" onclick="selectCloudProvider('aws')">
                                    <span class="text-2xl block mb-1">üü†</span>
                                    <span class="text-sm">AWS</span>
                                </div>
                                <div class="card rounded-lg p-3 text-center cursor-pointer border-2 border-transparent hover:border-purple-500 transition cloud-provider" data-provider="azure" onclick="selectCloudProvider('azure')">
                                    <span class="text-2xl block mb-1">üîµ</span>
                                    <span class="text-sm">Azure</span>
                                </div>
                                <div class="card rounded-lg p-3 text-center cursor-pointer border-2 border-transparent hover:border-purple-500 transition cloud-provider" data-provider="gcp" onclick="selectCloudProvider('gcp')">
                                    <span class="text-2xl block mb-1">üî¥</span>
                                    <span class="text-sm">Google Cloud</span>
                                </div>
                                <div class="card rounded-lg p-3 text-center cursor-pointer border-2 border-transparent hover:border-purple-500 transition cloud-provider" data-provider="oci" onclick="selectCloudProvider('oci')">
                                    <span class="text-2xl block mb-1">üî∂</span>
                                    <span class="text-sm">Oracle OCI</span>
                                </div>
                            </div>
                            
                            <!-- AWS Config -->
                            <div id="cloud-config-aws" class="hidden mt-4 card rounded-xl p-4 space-y-4">
                                <h5 class="font-medium flex items-center gap-2">üü† AWS Configuration</h5>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="text-sm text-gray-400 mb-1 block">Region</label>
                                        <select class="input-field w-full rounded-lg px-4 py-2">
                                            <option>us-east-1 (N. Virginia)</option>
                                            <option>us-west-2 (Oregon)</option>
                                            <option>eu-west-1 (Ireland)</option>
                                            <option>ap-southeast-1 (Singapore)</option>
                                        </select>
                            
                                    </div>
                                    <div>
                                        <label class="text-sm text-gray-400 mb-1 block">Instance Type</label>
                                        <select class="input-field w-full rounded-lg px-4 py-2">
                                            <option>t3.medium (2 vCPU, 4 GB)</option>
                                            <option>t3.large (2 vCPU, 8 GB)</option>
                                            <option>m5.large (2 vCPU, 8 GB)</option>
                                        </select>
                            
                                    </div>
                                    <div>
                                        <label class="text-sm text-gray-400 mb-1 block">Access Key ID</label>
                                        <input type="password" class="input-field w-full rounded-lg px-4 py-2" placeholder="AKIA...">
                                    </div>
                                    <div>
                                        <label class="text-sm text-gray-400 mb-1 block">Secret Access Key</label>
                                        <input type="password" class="input-field w-full rounded-lg px-4 py-2">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Azure Config -->
                            <div id="cloud-config-azure" class="hidden mt-4 card rounded-xl p-4 space-y-4">
                                <h5 class="font-medium flex items-center gap-2">üîµ Azure Configuration</h5>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="text-sm text-gray-400 mb-1 block">Region</label>
                                        <select class="input-field w-full rounded-lg px-4 py-2">
                                            <option>East US</option>
                                            <option>West Europe</option>
                                            <option>Southeast Asia</option>
                                        </select>
                            
                                    </div>
                                    <div>
                                        <label class="text-sm text-gray-400 mb-1 block">Resource Group</label>
                                        <input type="text" class="input-field w-full rounded-lg px-4 py-2" placeholder="my-resource-group">
                                    </div>
                                    <div>
                                        <label class="text-sm text-gray-400 mb-1 block">Subscription ID</label>
                                        <input type="text" class="input-field w-full rounded-lg px-4 py-2">
                                    </div>
                                    <div>
                                        <label class="text-sm text-gray-400 mb-1 block">Tenant ID</label>
                                        <input type="text" class="input-field w-full rounded-lg px-4 py-2">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- GCP Config -->
                            <div id="cloud-config-gcp" class="hidden mt-4 card rounded-xl p-4 space-y-4">
                                <h5 class="font-medium flex items-center gap-2">üî¥ Google Cloud Configuration</h5>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="text-sm text-gray-400 mb-1 block">Project ID</label>
                                        <input type="text" class="input-field w-full rounded-lg px-4 py-2" placeholder="my-project-id">
                                    </div>
                                    <div>
                                        <label class="text-sm text-gray-400 mb-1 block">Region</label>
                                        <select class="input-field w-full rounded-lg px-4 py-2">
                                            <option>us-central1</option>
                                            <option>europe-west1</option>
                                            <option>asia-east1</option>
                                        </select>
                            
                                    </div>
                                    <div class="md:col-span-2">
                                        <label class="text-sm text-gray-400 mb-1 block">Service Account JSON</label>
                                        <textarea rows="3" class="input-field w-full rounded-lg px-4 py-2 font-mono text-xs" placeholder="Paste service account JSON"></textarea>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- OCI Config -->
                            <div id="cloud-config-oci" class="hidden mt-4 card rounded-xl p-4 space-y-4">
                                <h5 class="font-medium flex items-center gap-2">üî∂ Oracle OCI Configuration</h5>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="text-sm text-gray-400 mb-1 block">Region</label>
                                        <select class="input-field w-full rounded-lg px-4 py-2">
                                            <option>us-ashburn-1 (US East)</option>
                                            <option>us-phoenix-1 (US West)</option>
                                            <option>eu-frankfurt-1 (Germany)</option>
                                            <option>uk-london-1 (UK)</option>
                                            <option>ap-tokyo-1 (Japan)</option>
                                            <option>me-jeddah-1 (Saudi Arabia)</option>
                                            <option>me-dubai-1 (UAE)</option>
                                        </select>
                            
                                    </div>
                                    <div>
                                        <label class="text-sm text-gray-400 mb-1 block">Compartment OCID</label>
                                        <input type="text" class="input-field w-full rounded-lg px-4 py-2" placeholder="ocid1.compartment.oc1..">
                                    </div>
                                    <div>
                                        <label class="text-sm text-gray-400 mb-1 block">Tenancy OCID</label>
                                        <input type="text" class="input-field w-full rounded-lg px-4 py-2" placeholder="ocid1.tenancy.oc1..">
                                    </div>
                                    <div>
                                        <label class="text-sm text-gray-400 mb-1 block">User OCID</label>
                                        <input type="text" class="input-field w-full rounded-lg px-4 py-2" placeholder="ocid1.user.oc1..">
                                    </div>
                                    <div>
                                        <label class="text-sm text-gray-400 mb-1 block">API Key Fingerprint</label>
                                        <input type="text" class="input-field w-full rounded-lg px-4 py-2" placeholder="xx:xx:xx:...">
                                    </div>
                                    <div>
                                        <label class="text-sm text-gray-400 mb-1 block">Shape</label>
                                        <select class="input-field w-full rounded-lg px-4 py-2">
                                            <option>VM.Standard.E4.Flex</option>
                                            <option>VM.Standard3.Flex</option>
                                            <option>VM.Standard.A1.Flex (ARM)</option>
                                        </select>
                            
                                    </div>
                                    <div class="md:col-span-2">
                                        <label class="text-sm text-gray-400 mb-1 block">Private Key (PEM)</label>
                                        <textarea rows="3" class="input-field w-full rounded-lg px-4 py-2 font-mono text-xs" placeholder="-----BEGIN RSA PRIVATE KEY-----"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- On-Premises Config -->
                        <div id="onprem-config" class="hidden">
                            <h5 class="text-sm font-medium text-gray-400 mb-3">On-Premises Configuration</h5>
                            <div class="card rounded-xl p-4 space-y-4">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="text-sm text-gray-400 mb-1 block">Deployment Method</label>
                                        <select id="onprem-method" class="input-field w-full rounded-lg px-4 py-2" onchange="onOnpremMethodChange()">
                                            <option value="docker">Docker Container</option>
                                            <option value="kubernetes">Kubernetes</option>
                                            <option value="vm">Virtual Machine</option>
                                            <option value="bare">Bare Metal</option>
                                        </select>
                            
                                    </div>
                                    <div>
                                        <label class="text-sm text-gray-400 mb-1 block">Environment</label>
                                        <select class="input-field w-full rounded-lg px-4 py-2">
                                            <option>Production</option>
                                            <option>Staging</option>
                                            <option>Development</option>
                                        </select>
                            
                                    </div>
                                </div>
                                
                                <!-- Docker Config -->
                                <div id="onprem-docker" class="space-y-4">
                                    <div class="bg-gray-800/50 rounded-lg p-4">
                                        <h6 class="text-sm font-medium mb-2">Docker Run Command</h6>
                                        <pre class="text-xs bg-black/50 p-3 rounded overflow-x-auto"><code>docker run -d \
  --name agentforge-agent \
  -p 8080:8080 \
  -e OPENAI_API_KEY=your-key \
  -e AGENT_CONFIG=/config/agent.json \
  -v ./config:/config \
  agentforge/agent:latest</code></pre>
                                        <button onclick="copyDockerCommand()" class="mt-2 text-xs text-purple-400 hover:text-purple-300">üìã Copy command</button>
                                    </div>
                                </div>
                                
                                <!-- Kubernetes Config -->
                                <div id="onprem-kubernetes" class="hidden space-y-4">
                                    <div class="bg-gray-800/50 rounded-lg p-4">
                                        <h6 class="text-sm font-medium mb-2">Kubernetes Manifest</h6>
                                        <pre class="text-xs bg-black/50 p-3 rounded overflow-x-auto max-h-48"><code>apiVersion: apps/v1
kind: Deployment
metadata:
  name: agentforge-agent
spec:
  replicas: 2
  selector:
    matchLabels:
      app: agentforge-agent
  template:
    metadata:
      labels:
        app: agentforge-agent
    spec:
      containers:
      - name: agent
        image: agentforge/agent:latest
        ports:
        - containerPort: 8080
        env:
        - name: OPENAI_API_KEY
          valueFrom:
            secretKeyRef:
              name: agent-secrets
              key: openai-key</code></pre>
                                        <button onclick="downloadK8sManifest()" class="mt-2 text-xs text-purple-400 hover:text-purple-300">‚¨áÔ∏è Download YAML</button>
                                    </div>
                                </div>
                                
                                <!-- Server Config -->
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="text-sm text-gray-400 mb-1 block">Server Host</label>
                                        <input type="text" class="input-field w-full rounded-lg px-4 py-2" placeholder="192.168.1.100 or hostname">
                                    </div>
                                    <div>
                                        <label class="text-sm text-gray-400 mb-1 block">Port</label>
                                        <input type="number" class="input-field w-full rounded-lg px-4 py-2" value="8080">
                                    </div>
                                    <div>
                                        <label class="text-sm text-gray-400 mb-1 block">SSL Certificate</label>
                                        <input type="file" class="input-field w-full rounded-lg px-4 py-2" accept=".pem,.crt">
                                    </div>
                                    <div>
                                        <label class="text-sm text-gray-400 mb-1 block">SSL Key</label>
                                        <input type="file" class="input-field w-full rounded-lg px-4 py-2" accept=".pem,.key">
                                    </div>
                                </div>
                                
                                <!-- Resource Requirements -->
                                <div class="border-t border-gray-700 pt-4">
                                    <h6 class="text-sm font-medium mb-3">Minimum Requirements</h6>
                                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                                        <div class="text-center p-3 bg-gray-800/50 rounded-lg">
                                            <div class="text-lg font-bold text-purple-400">2</div>
                                            <div class="text-xs text-gray-500">CPU Cores</div>
                                        </div>
                                        <div class="text-center p-3 bg-gray-800/50 rounded-lg">
                                            <div class="text-lg font-bold text-purple-400">4 GB</div>
                                            <div class="text-xs text-gray-500">RAM</div>
                                        </div>
                                        <div class="text-center p-3 bg-gray-800/50 rounded-lg">
                                            <div class="text-lg font-bold text-purple-400">20 GB</div>
                                            <div class="text-xs text-gray-500">Storage</div>
                                        </div>
                                        <div class="text-center p-3 bg-gray-800/50 rounded-lg">
                                            <div class="text-lg font-bold text-purple-400">HTTPS</div>
                                            <div class="text-xs text-gray-500">Network</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Navigation handled by sticky header -->
                </div>
                
                </div><!-- End wizard-content-area -->
                </div><!-- End create-wizard-modal-panel -->
            </section>

            <!-- Demo Lab Page - NEW DESIGN -->
            <section id="page-demo" class="hidden flex flex-col" style="height:100%;max-height:100%;min-height:0;overflow:hidden;">
                <!-- Header -->
                <div class="p-4 border-b border-gray-800 flex items-center justify-between bg-gradient-to-r from-purple-900/30 to-blue-900/30" style="flex-shrink:0;">
                    <div>
                        <h2 class="text-xl font-bold flex items-center gap-2">
                            <span class="w-10 h-10 rounded-xl bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center">üß™</span>
                            Demo Lab
                        </h2>
                        <p class="text-sm text-gray-400 mt-1">Create demo environments with APIs, Knowledge Bases & Test Assets</p>
                    </div>
                </div>

                <!-- Main Content -->
                <div class="flex flex-1 overflow-hidden">
                    <!-- Left Sidebar - Demo Kits List -->
                    <div class="w-72 border-r flex flex-col demo-sidebar" style="background:var(--bg-secondary);border-color:var(--border-color);">
                        <div class="p-3 border-b" style="border-color:var(--border-color);">
                            <button onclick="showCreateKitModal()" class="w-full btn-primary py-2.5 rounded-lg text-sm flex items-center justify-center gap-2">
                                <span>‚ú®</span> Create Demo Kit
                            </button>
                        </div>
                        
                        <!-- Kits List -->
                        <div id="demo-kits-list" class="flex-1 overflow-y-auto p-2 space-y-2">
                            <div class="text-center py-8" style="color:var(--text-muted);">
                                <span class="text-3xl block mb-2">üì¶</span>
                                <p class="text-sm">No demo kits yet</p>
                                <p class="text-xs mt-1">Create one to get started!</p>
                            </div>
                        </div>
                    </div>

                    <!-- Right Content Area -->
                    <div class="flex-1 flex flex-col overflow-hidden">
                        <!-- Welcome / Kit Details -->
                        <div id="demo-content-area" class="flex-1 overflow-y-auto p-6">
                            <!-- Welcome Screen -->
                            <div id="demo-welcome" class="text-center py-12">
                                <div class="w-24 h-24 mx-auto rounded-2xl bg-gradient-to-br from-purple-500/20 to-blue-500/20 flex items-center justify-center mb-6">
                                    <span class="text-5xl">üß™</span>
                                </div>
                                <h3 class="text-2xl font-bold mb-3">Welcome to Demo Lab</h3>
                                <p class="mb-8 max-w-lg mx-auto" style="color:var(--text-secondary);">
                                    Describe your agent's needs in plain language and we'll generate everything you need: 
                                    Mock APIs, Knowledge Bases, and sample documents for testing.
                                </p>
                                
                                <div class="max-w-2xl mx-auto">
                                    <div class="card rounded-xl p-6 text-left">
                                        <p class="text-sm font-medium mb-4" style="color:var(--accent-primary);">üí° Example Request:</p>
                                        <div class="rounded-lg p-4 text-sm italic" style="background:var(--bg-input);color:var(--text-secondary);">
                                            "I need tools for an HR agent that can check employee vacation balance, 
                                            submit vacation requests, process expense claims with receipt uploads, 
                                            and answer questions about HR policies including benefits and leave policies. 
                                            Also need sample invoices and receipts for testing."
                                        </div>
                                        <button onclick="useDemoKitExample()" class="mt-4 text-sm hover:underline" style="color:var(--accent-primary);">
                                            ‚Üí Use this example
                                        </button>
                                    </div>
                                    
                                    <div class="grid grid-cols-3 gap-4 mt-6">
                                        <div class="card rounded-lg p-4 text-center">
                                            <span class="text-2xl">üîå</span>
                                            <p class="text-sm font-medium mt-2">Mock APIs</p>
                                            <p class="text-xs" style="color:var(--text-muted);">Testable endpoints</p>
                                        </div>
                                        <div class="card rounded-lg p-4 text-center">
                                            <span class="text-2xl">üß†</span>
                                            <p class="text-sm font-medium mt-2">Knowledge Bases</p>
                                            <p class="text-xs" style="color:var(--text-muted);">Searchable docs</p>
                                        </div>
                                        <div class="card rounded-lg p-4 text-center">
                                            <span class="text-2xl">üìé</span>
                                            <p class="text-sm font-medium mt-2">Demo Assets</p>
                                            <p class="text-xs" style="color:var(--text-muted);">Test files</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Kit Details (hidden by default) -->
                            <div id="demo-kit-details" class="hidden">
                                <!-- Kit Header -->
                                <div class="flex items-start justify-between mb-6">
                                    <div>
                                        <h3 id="kit-detail-name" class="text-2xl font-bold">Kit Name</h3>
                                        <p id="kit-detail-desc" class="mt-1" style="color:var(--text-secondary);">Description</p>
                                    </div>
                                    <button onclick="deleteCurrentKit()" class="px-3 py-1.5 rounded-lg text-sm bg-red-500/20 text-red-400 hover:bg-red-500/30">
                                        üóëÔ∏è Delete Kit
                                    </button>
                                </div>
                                
                                <!-- APIs Section -->
                                <div class="mb-8">
                                    <div class="flex items-center gap-2 mb-4">
                                        <span class="w-8 h-8 rounded-lg bg-purple-500/20 flex items-center justify-center">üîå</span>
                                        <h4 class="text-lg font-semibold">APIs</h4>
                                        <span id="kit-api-count" class="text-xs bg-purple-500/20 text-purple-300 px-2 py-0.5 rounded-full">0</span>
                                        <span class="text-xs text-gray-500 ml-2">‚Ä¢ Available as tools in AgentForge Studio</span>
                                    </div>
                                    <div id="kit-apis-list" class="space-y-3">
                                        <!-- APIs will be rendered here -->
                                    </div>
                                </div>
                                
                                <!-- Knowledge Bases Section -->
                                <div class="mb-8">
                                    <div class="flex items-center gap-2 mb-4">
                                        <span class="w-8 h-8 rounded-lg bg-blue-500/20 flex items-center justify-center">üß†</span>
                                        <h4 class="text-lg font-semibold">Knowledge Bases</h4>
                                        <span id="kit-kb-count" class="text-xs bg-blue-500/20 text-blue-300 px-2 py-0.5 rounded-full">0</span>
                                        <span class="text-xs text-gray-500 ml-2">‚Ä¢ Available as tools in AgentForge Studio</span>
                                    </div>
                                    <div id="kit-kb-list" class="space-y-3">
                                        <!-- Knowledge Bases will be rendered here -->
                                    </div>
                                </div>
                                
                                <!-- Demo Assets Section -->
                                <div class="mb-8">
                                    <div class="flex items-center gap-2 mb-4">
                                        <span class="w-8 h-8 rounded-lg bg-green-500/20 flex items-center justify-center">üìé</span>
                                        <h4 class="text-lg font-semibold">Demo Assets</h4>
                                        <span id="kit-asset-count" class="text-xs bg-green-500/20 text-green-300 px-2 py-0.5 rounded-full">0</span>
                                        <span class="text-xs text-gray-500 ml-2">‚Ä¢ For testing only (not linked to agent)</span>
                                    </div>
                                    <div id="kit-assets-list" class="grid grid-cols-2 md:grid-cols-3 gap-3">
                                        <!-- Assets will be rendered here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Create Kit Modal -->
                <div id="create-kit-modal" class="fixed inset-0 bg-black/70 hidden items-center justify-center z-50">
                    <div class="modal-content-box rounded-2xl w-full max-w-2xl mx-4 max-h-[80vh] overflow-hidden">
                        <div class="p-4 border-b border-gray-700 flex items-center justify-between">
                            <h3 class="font-bold text-lg">‚ú® Create Demo Kit</h3>
                            <button onclick="closeCreateKitModal()" class="p-2 hover:bg-gray-700 rounded-lg">‚úï</button>
                        </div>
                        <div class="p-6">
                            <label class="block text-sm font-medium mb-2">Kit Name (optional)</label>
                            <input type="text" id="new-kit-name" class="w-full input-field rounded-lg px-4 py-2 mb-4" placeholder="e.g., HR Assistant Tools">
                            
                            <label class="block text-sm font-medium mb-2">Describe what you need</label>
                            <textarea id="new-kit-description" class="w-full input-field rounded-lg px-4 py-3 h-40 resize-none" placeholder="Describe the APIs, knowledge bases, and test documents you need for your agent...

Example: I need an HR agent that can:
- Check employee vacation balance from HR system
- Submit vacation requests
- Process expense claims with receipts
- Answer questions about HR policies (benefits, leave, etc.)
- Need sample invoices and receipts for testing"></textarea>
                            
                            <div id="kit-generation-status" class="hidden mt-4 p-4 bg-purple-500/10 rounded-lg">
                                <div class="flex items-center gap-3">
                                    <div class="animate-spin w-5 h-5 border-2 border-purple-500 border-t-transparent rounded-full"></div>
                                    <span class="text-sm text-purple-300">Generating your demo kit...</span>
                                </div>
                            </div>
                        </div>
                        <div class="p-4 border-t border-gray-700 flex justify-end gap-2">
                            <button onclick="closeCreateKitModal()" class="px-4 py-2 rounded-lg bg-gray-700 hover:bg-gray-600">Cancel</button>
                            <button onclick="generateDemoKit()" id="generate-kit-btn" class="px-6 py-2 rounded-lg bg-purple-600 hover:bg-purple-500 flex items-center gap-2">
                                <span>‚ú®</span> Generate Kit
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- API Test Modal (business-friendly, no technical terms) -->
                <div id="api-test-modal" class="fixed inset-0 bg-black/80 hidden items-center justify-center z-50 p-4">
                    <div class="bg-gradient-to-br from-gray-900 to-gray-800 rounded-2xl w-full max-w-5xl border border-purple-500/30 shadow-2xl overflow-hidden flex flex-col max-h-[90vh]">
                        <div class="p-6 border-b border-purple-500/20 flex items-center justify-between bg-gradient-to-r from-purple-900/30 via-purple-800/10 to-transparent shrink-0">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center text-2xl shadow-lg shadow-purple-500/30">
                                    üîç
                                </div>
                                <div>
                                    <h3 class="font-bold text-xl text-white" id="api-test-title">Try It Out</h3>
                                    <p class="text-sm text-purple-200 mt-0.5">Enter information to see results</p>
                                </div>
                            </div>
                            <button onclick="closeApiTestModal()" class="p-2 hover:bg-white/10 rounded-xl transition text-gray-200 hover:text-white" aria-label="Close">‚úï</button>
                        </div>
                        <div class="p-6 overflow-y-auto flex-1 min-h-0">
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div class="space-y-4">
                                    <div id="api-test-params-wrapper" class="space-y-4">
                                        <div id="api-test-params" class="space-y-4">
                                            <!-- Parameters rendered here -->
                                        </div>
                                    </div>
                                    <textarea id="api-test-body" class="hidden w-full input-field rounded-lg px-3 py-2 text-sm font-mono h-28" placeholder="{}"></textarea>
                                    <button type="button" id="api-test-send-btn" onclick="sendApiTestRequest()" class="w-full px-6 py-3 rounded-xl bg-gradient-to-r from-purple-600 to-purple-500 hover:from-purple-500 hover:to-purple-400 text-white font-semibold flex items-center justify-center gap-2 transition shadow-lg shadow-purple-500/20">
                                        <span>‚úì</span>
                                        <span>Get Results</span>
                                    </button>
                                </div>
                                <div class="bg-gradient-to-br from-gray-950 to-gray-900 rounded-xl p-5 border-2 border-gray-700/30 shadow-inner min-h-[300px] flex flex-col">
                                    <div class="flex items-center gap-2 text-sm font-semibold text-purple-300 mb-4">
                                        <span>üìä</span>
                                        <span>Results</span>
                                    </div>
                                    <div id="api-test-response" class="text-sm overflow-auto flex-1">
                                        <div class="text-center py-12 text-gray-400">
                                            <div class="text-4xl mb-3">üí°</div>
                                            <p>Results will appear here</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="p-4 border-t border-purple-500/20 flex justify-between items-center shrink-0 bg-gray-900/50">
                            <div class="text-xs text-gray-500">
                                <span id="api-test-method" class="hidden"></span>
                                <code id="api-test-endpoint" class="hidden"></code>
                            </div>
                            <button type="button" onclick="closeApiTestModal()" class="px-5 py-2 rounded-lg bg-purple-600 hover:bg-purple-500 text-white transition text-sm font-medium">Close</button>
                        </div>
                    </div>
                </div>
                
                <!-- Knowledge Base View Modal -->
                <div id="kb-view-modal" class="fixed inset-0 bg-black/70 hidden items-center justify-center z-50">
                    <div class="modal-content-box rounded-2xl w-full max-w-4xl mx-4 max-h-[85vh] overflow-hidden">
                        <div class="p-4 border-b border-gray-700 flex items-center justify-between">
                            <h3 class="font-bold text-lg" id="kb-view-title">Knowledge Base</h3>
                            <button onclick="closeKbViewModal()" class="p-2 hover:bg-gray-700 rounded-lg">‚úï</button>
                        </div>
                        <div class="p-6 overflow-y-auto max-h-[70vh]">
                            <div id="kb-view-content" class="prose prose-invert max-w-none">
                                <!-- Content will be rendered here -->
                            </div>
                        </div>
                        <div class="p-4 border-t border-gray-700 flex justify-end">
                            <button onclick="closeKbViewModal()" class="px-4 py-2 rounded-lg bg-gray-700 hover:bg-gray-600">Close</button>
                        </div>
                    </div>
                </div>
                
                <!-- Access Control is now integrated in the Agent Wizard (Step 4: Guardrails & Safety) -->

                <!-- Edit Asset Modal (Assets don't have a Tools page) -->
                <div id="edit-asset-modal" class="fixed inset-0 bg-black/70 hidden items-center justify-center z-50">
                    <div class="modal-content-box rounded-2xl w-full max-w-xl mx-4 max-h-[85vh] overflow-hidden">
                        <div class="p-4 border-b border-gray-700 flex items-center justify-between">
                            <h3 class="font-bold text-lg">‚úèÔ∏è Edit Asset</h3>
                            <button onclick="closeEditAssetModal()" class="p-2 hover:bg-gray-700 rounded-lg">‚úï</button>
                        </div>
                        <div class="p-6 overflow-y-auto max-h-[60vh] space-y-4">
                            <div>
                                <label class="block text-sm font-medium mb-1">Name</label>
                                <input type="text" id="edit-asset-name" class="w-full input-field rounded-lg px-4 py-2">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">Description</label>
                                <textarea id="edit-asset-description" class="w-full input-field rounded-lg px-4 py-2 h-16"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">Type</label>
                                <select id="edit-asset-type" class="w-full input-field rounded-lg px-4 py-2">
                                    <option value="invoice">Invoice</option>
                                    <option value="receipt">Receipt</option>
                                    <option value="document">Document</option>
                                    <option value="image">Image</option>
                                </select>
                            
                            </div>
                        </div>
                        <div class="p-4 border-t border-gray-700 flex justify-end gap-2">
                            <button onclick="closeEditAssetModal()" class="px-4 py-2 rounded-lg bg-gray-700 hover:bg-gray-600">Cancel</button>
                            <button onclick="saveEditAsset()" class="px-6 py-2 rounded-lg bg-purple-600 hover:bg-purple-500">Save</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Chat Page -->
            <section id="page-chat" class="hidden chat-page">
                <!-- Sidebar -->
                <div id="chat-sidebar" class="chat-sidebar hidden md:flex">
                    <!-- Agent Selector -->
                    <div class="agent-selector">
                        <select id="chat-agent" onchange="onAgentChange()">
                            <option value="">Select Agent...</option>
                        </select>
                    </div>
                    
                    <!-- Conversations Header -->
                    <div class="conv-header">
                        <span class="conv-header-title">History</span>
                        <div class="conv-header-actions">
                            <button onclick="startNewChatConversation()" class="conv-btn-new">+ New</button>
                            <button id="chat-edit-btn" onclick="toggleChatSelectionMode()" class="conv-btn-edit">Edit</button>
                        </div>
                    </div>
                    
                    <!-- Selection Actions Bar -->
                    <div id="chat-selection-bar" class="conv-selection-bar hidden">
                        <button onclick="toggleChatSelectAll()" class="conv-select-all">
                            <span id="chat-select-all-text">Select All</span>
                        </button>
                        <button id="chat-delete-selected-btn" onclick="deleteChatSelectedConvs()" disabled class="conv-delete-btn">
                            Delete (0)
                        </button>
                    </div>
                    
                    <!-- Conversations List -->
                    <div id="chat-conv-list" class="conv-list">
                        <div class="conv-empty">
                            <div class="conv-empty-icon">üí¨</div>
                            <p class="conv-empty-text">Select an agent to start</p>
                        </div>
                    </div>
                </div>
                
                <!-- Main Chat Area -->
                <div class="chat-main">
                    <!-- Desktop Header -->
                    <div id="chat-desktop-header" class="chat-header">
                        <div class="chat-header-avatar">ü§ñ</div>
                        <div class="chat-header-info">
                            <h3 id="chat-agent-name">Select an Agent</h3>
                            <p id="chat-agent-status">Choose an agent to start chatting</p>
                        </div>
                        <span class="chat-header-status" style="display:none" id="chat-online-dot"></span>
                    </div>
                    
                    <!-- Mobile Header -->
                    <div class="chat-mobile-header">
                        <select id="chat-agent-mobile" onchange="document.getElementById('chat-agent').value=this.value;onAgentChange()">
                            <option value="">Select Agent...</option>
                        </select>
                        <button onclick="toggleChatSidebar()" class="chat-mobile-toggle">‚ò∞</button>
                    </div>
                    
                    <!-- Messages Container -->
                    <div id="chat-messages" class="chat-messages-container">
                        <div class="chat-welcome">
                            <div class="chat-welcome-icon">üí¨</div>
                            <h2>Welcome to Chat</h2>
                            <p>Select an agent to start a conversation</p>
                        </div>
                    </div>
                    
                    <!-- Input Area -->
                    <div class="chat-input-area">
                        <div id="chat-attachments" class="chat-attachments-preview hidden"></div>
                        <div class="chat-input-wrapper">
                            <button onclick="document.getElementById('chat-file-input').click()" class="chat-attach-btn" title="Attach file">üìé</button>
                            <input type="file" id="chat-file-input" class="hidden" accept=".pdf,.doc,.docx,.txt,.csv,.xlsx,.xls,.pptx,.ppt,.md,.png,.jpg,.jpeg,.gif,.webp,.bmp,.svg" onchange="handleChatFile(event)" multiple>
                            <input type="text" id="chat-input" class="chat-input-field" placeholder="Type your message..." onkeypress="if(event.key==='Enter')sendMsg()">
                            <button onclick="sendMsg()" class="chat-send-btn">Send</button>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Mobile Bottom Navigation -->
    <nav class="mobile-nav">
        <button onclick="navigate('dashboard')" id="mob-dashboard" class="active"><span>üè†</span><span>Home</span></button>
        <button onclick="navigate('chat')" id="mob-chat" data-permission="chat:use" class=""><span>üí¨</span><span>Chat</span></button>
        <button onclick="navigate('agents')" id="mob-agents" data-permission="agents:view" class=""><span>üîó</span><span>Hub</span></button>
        <button onclick="navigate('create')" id="mob-create" data-permission="agents:create" class=""><span>üî®</span><span>Studio</span></button>
        <button onclick="navigate('tools')" id="mob-tools" data-permission="tools:view" class=""><span>üß©</span><span>Tools</span></button>
        <button onclick="navigate('settings')" id="mob-settings" data-permission="system:settings" class=""><span>‚öôÔ∏è</span><span>Settings</span></button>
    </nav>

    <!-- Task Modal - Clean popup for adding/editing tasks -->
    <div id="modal-task" class="hidden fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4">
        <div class="bg-gray-800 rounded-xl w-full max-w-2xl max-h-[85vh] flex flex-col shadow-2xl border border-gray-700">
            <!-- Header -->
            <div class="p-5 flex items-center justify-between border-b border-gray-700">
                <div class="flex items-center gap-3">
                    <span class="text-2xl">üìã</span>
                    <div>
                        <h3 class="text-lg font-bold text-white" id="task-modal-title">Add New Task</h3>
                        <p class="text-xs text-gray-400">Define what this agent can do</p>
                    </div>
                </div>
                <button onclick="closeTaskModal()" class="text-gray-400 hover:text-white text-2xl p-2 hover:bg-gray-700 rounded-lg transition">√ó</button>
            </div>

            <!-- Content -->
            <div class="p-5 overflow-y-auto flex-1 space-y-5">
                <!-- Task Name -->
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Task Name <span class="text-red-400">*</span></label>
                    <input type="text" id="task-modal-name" 
                           class="w-full bg-gray-900 border border-gray-600 rounded-lg px-4 py-3 text-white placeholder-gray-500 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition"
                           placeholder="e.g., Answer HR Questions, Process Leave Requests">
                </div>

                <!-- Task Description -->
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Description <span class="text-gray-500">(optional)</span></label>
                    <textarea id="task-modal-desc" rows="2"
                              class="w-full bg-gray-900 border border-gray-600 rounded-lg px-4 py-3 text-white placeholder-gray-500 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition resize-none"
                              placeholder="Brief description of what this task does..."></textarea>
                </div>

                <!-- Instructions -->
                <div>
                    <div class="flex items-center justify-between mb-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-300">Instructions</label>
                            <p class="text-xs text-gray-500">Step-by-step guide for the AI to follow</p>
                        </div>
                        <button onclick="addTaskModalInstruction()" 
                                class="px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition flex items-center gap-1">
                            <span>+</span> Add Step
                        </button>
                    </div>
                    <div id="task-modal-instructions" class="space-y-2">
                        <!-- Instructions will be added here -->
                    </div>
                    <p id="task-modal-no-instructions" class="text-sm text-gray-500 italic text-center py-4">
                        No instructions yet. Click "+ Add Step" to add instructions.
                    </p>
                </div>
            </div>

            <!-- Footer -->
            <div class="p-5 border-t border-gray-700 flex justify-end gap-3">
                <button onclick="closeTaskModal()" 
                        class="px-5 py-2.5 bg-gray-700 hover:bg-gray-600 text-gray-300 rounded-lg font-medium transition">
                    Cancel
                </button>
                <button onclick="saveTaskModal()" 
                        class="px-5 py-2.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition">
                    Save Task
                </button>
            </div>
        </div>
    </div>

    <!-- Tool Creation Modal -->
<!-- Tool Wizard Modal -->
<div id="modal-tool" class="hidden fixed inset-0 modal-backdrop flex items-end md:items-center justify-center z-50">
    <div class="card rounded-t-xl md:rounded-xl w-full md:max-w-4xl md:mx-4 max-h-[90vh] flex flex-col">
        <!-- Header -->
        <div class="p-4 md:p-6 flex items-center justify-between shrink-0" style="border-bottom:1px solid var(--border-color)">
            <div class="flex items-center gap-3">
                <span id="wizard-icon" class="text-2xl">üîß</span>
                <div>
                    <h3 class="text-lg md:text-xl font-bold" id="wizard-title">Create Tool</h3>
                    <p class="text-xs text-gray-400" id="wizard-subtitle">Select a tool type</p>
                </div>
            </div>
            <button onclick="closeWizard()" class="text-gray-400 hover:text-white text-2xl p-2">√ó</button>
        </div>

        <!-- Steps Indicator -->
        <div id="wizard-steps-bar" class="hidden px-4 md:px-6 py-3 border-b shrink-0" style="background:var(--bg-secondary);border-color:var(--border-color);">
            <div class="flex items-center justify-center gap-2 md:gap-4">
                <div class="wizard-step flex items-center gap-2 cursor-pointer hover:opacity-80 transition" data-step="1" onclick="goToStep(1)">
                    <div class="step-num w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold bg-purple-600">1</div>
                    <span class="step-label text-sm hidden md:inline">Basics</span>
                </div>
                <div class="w-6 md:w-10 h-0.5 bg-gray-700 step-connector"></div>
                <div class="wizard-step flex items-center gap-2 opacity-50 cursor-pointer hover:opacity-80 transition" data-step="2" onclick="goToStep(2)">
                    <div class="step-num w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold bg-gray-700">2</div>
                    <span class="step-label text-sm hidden md:inline">Tasks</span>
                </div>
                <div class="w-6 md:w-10 h-0.5 bg-gray-700 step-connector"></div>
                <div class="wizard-step flex items-center gap-2 opacity-50 cursor-pointer hover:opacity-80 transition" data-step="3" onclick="goToStep(3)">
                    <div class="step-num w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold bg-gray-700">3</div>
                    <span class="step-label text-sm hidden md:inline">Tools</span>
                </div>
                <div class="w-6 md:w-10 h-0.5 bg-gray-700 step-connector"></div>
                <div class="wizard-step flex items-center gap-2 opacity-50 cursor-pointer hover:opacity-80 transition" data-step="4" onclick="goToStep(4)">
                    <div class="step-num w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold bg-gray-700">4</div>
                    <span class="step-label text-sm hidden md:inline">Guardrails</span>
                </div>
                <div class="w-6 md:w-10 h-0.5 bg-gray-700 step-connector"></div>
                <div class="wizard-step flex items-center gap-2 opacity-50 cursor-pointer hover:opacity-80 transition" data-step="5" onclick="goToStep(5)">
                    <div class="step-num w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold bg-gray-700">5</div>
                    <span class="step-label text-sm hidden md:inline">Preview</span>
                </div>
                <div class="w-6 md:w-10 h-0.5 bg-gray-700 step-connector"></div>
                <div class="wizard-step flex items-center gap-2 opacity-50 cursor-pointer hover:opacity-80 transition" data-step="6" onclick="goToStep(6)">
                    <div class="step-num w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold bg-gray-700">6</div>
                    <span class="step-label text-sm hidden md:inline">Test</span>
                </div>
                <div class="w-6 md:w-10 h-0.5 bg-gray-700 step-connector"></div>
                <div class="wizard-step flex items-center gap-2 opacity-50 cursor-pointer hover:opacity-80 transition" data-step="7" onclick="goToStep(7)">
                    <div class="step-num w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold bg-gray-700">7</div>
                    <span class="step-label text-sm hidden md:inline">Deploy</span>
                </div>
            </div>
        </div>

        <!-- Content Area (Scrollable) -->
        <div class="p-4 md:p-6 overflow-y-auto flex-1">
            
            <!-- Step 0: Tool Type Selection -->
            <div id="wiz-step-0" class="space-y-4">
                <!-- Active Tools: Knowledge & Data -->
                <div>
                    <h4 class="text-xs uppercase text-gray-500 mb-2 font-semibold">üìö Knowledge & Data</h4>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                        <button onclick="startWizard('knowledge')" class="card p-3 rounded-lg text-center hover:border-purple-500 transition border-2 border-transparent">
                            <span class="text-xl block mb-1">üß†</span>
                            <span class="font-medium text-sm">Knowledge Base</span>
                            <p class="text-xs text-gray-500 mt-1">RAG with config</p>
                        </button>
                        <button onclick="startWizard('document')" class="card p-3 rounded-lg text-center hover:border-purple-500 transition border-2 border-transparent">
                            <span class="text-xl block mb-1">üìÑ</span>
                            <span class="font-medium text-sm">Documents</span>
                            <p class="text-xs text-gray-500 mt-1">Upload files</p>
                        </button>
                        <button onclick="startWizard('website')" class="card p-3 rounded-lg text-center hover:border-purple-500 transition border-2 border-transparent">
                            <span class="text-xl block mb-1">üåê</span>
                            <span class="font-medium text-sm">Website</span>
                            <p class="text-xs text-gray-500 mt-1">Scrape pages</p>
                        </button>
                        <button onclick="startWizard('database')" class="card p-3 rounded-lg text-center hover:border-purple-500 transition border-2 border-transparent">
                            <span class="text-xl block mb-1">üóÑÔ∏è</span>
                            <span class="font-medium text-sm">Database</span>
                            <p class="text-xs text-gray-500 mt-1">SQL, MongoDB</p>
                        </button>
                    </div>
                </div>
                
                <!-- Active Tools: Integrations -->
                <div>
                    <h4 class="text-xs uppercase text-gray-500 mb-2 font-semibold">üîå Integrations</h4>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                        <button onclick="startWizard('api')" class="card p-3 rounded-lg text-center hover:border-purple-500 transition border-2 border-transparent">
                            <span class="text-xl block mb-1">üîó</span>
                            <span class="font-medium text-sm">REST API</span>
                            <p class="text-xs text-gray-500 mt-1">HTTP endpoints</p>
                        </button>
                        <button onclick="startWizard('email')" class="card p-3 rounded-lg text-center hover:border-purple-500 transition border-2 border-transparent">
                            <span class="text-xl block mb-1">üìß</span>
                            <span class="font-medium text-sm">Email</span>
                            <p class="text-xs text-gray-500 mt-1">SMTP, SendGrid</p>
                        </button>
                        <button onclick="startWizard('webhook')" class="card p-3 rounded-lg text-center hover:border-purple-500 transition border-2 border-transparent">
                            <span class="text-xl block mb-1">ü™ù</span>
                            <span class="font-medium text-sm">Webhook</span>
                            <p class="text-xs text-gray-500 mt-1">HTTP callbacks</p>
                        </button>
                        <button onclick="startWizard('slack')" class="card p-3 rounded-lg text-center hover:border-purple-500 transition border-2 border-transparent">
                            <span class="text-xl block mb-1">üí¨</span>
                            <span class="font-medium text-sm">Slack</span>
                            <p class="text-xs text-gray-500 mt-1">Messaging</p>
                        </button>
                        <button onclick="startWizard('websearch')" class="card p-3 rounded-lg text-center hover:border-purple-500 transition border-2 border-transparent">
                            <span class="text-xl block mb-1">üîç</span>
                            <span class="font-medium text-sm">Web Search</span>
                            <p class="text-xs text-gray-500 mt-1">Tavily, Google</p>
                        </button>
                    </div>
                </div>
                
                <!-- Coming Soon -->
                <div>
                    <h4 class="text-xs uppercase text-gray-500 mb-2 font-semibold">üöÄ Coming Soon</h4>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-2 opacity-60">
                        <div class="card p-3 rounded-lg text-center border-2 border-dashed border-gray-600 cursor-not-allowed relative">
                            <span class="absolute top-1 right-1 text-[10px] bg-yellow-500/20 text-yellow-400 px-1.5 py-0.5 rounded">Soon</span>
                            <span class="text-xl block mb-1">üìä</span>
                            <span class="font-medium text-sm">Spreadsheet</span>
                            <p class="text-xs text-gray-500 mt-1">Sheets, Airtable</p>
                        </div>
                        <div class="card p-3 rounded-lg text-center border-2 border-dashed border-gray-600 cursor-not-allowed relative">
                            <span class="absolute top-1 right-1 text-[10px] bg-yellow-500/20 text-yellow-400 px-1.5 py-0.5 rounded">Soon</span>
                            <span class="text-xl block mb-1">‚òÅÔ∏è</span>
                            <span class="font-medium text-sm">Cloud Storage</span>
                            <p class="text-xs text-gray-500 mt-1">S3, GCS, Azure</p>
                        </div>
                        <div class="card p-3 rounded-lg text-center border-2 border-dashed border-gray-600 cursor-not-allowed relative">
                            <span class="absolute top-1 right-1 text-[10px] bg-yellow-500/20 text-yellow-400 px-1.5 py-0.5 rounded">Soon</span>
                            <span class="text-xl block mb-1">üìÖ</span>
                            <span class="font-medium text-sm">Calendar</span>
                            <p class="text-xs text-gray-500 mt-1">Google, Outlook</p>
                        </div>
                        <div class="card p-3 rounded-lg text-center border-2 border-dashed border-gray-600 cursor-not-allowed relative">
                            <span class="absolute top-1 right-1 text-[10px] bg-yellow-500/20 text-yellow-400 px-1.5 py-0.5 rounded">Soon</span>
                            <span class="text-xl block mb-1">üéØ</span>
                            <span class="font-medium text-sm">CRM</span>
                            <p class="text-xs text-gray-500 mt-1">Salesforce, HubSpot</p>
                        </div>
                        <div class="card p-3 rounded-lg text-center border-2 border-dashed border-gray-600 cursor-not-allowed relative">
                            <span class="absolute top-1 right-1 text-[10px] bg-yellow-500/20 text-yellow-400 px-1.5 py-0.5 rounded">Soon</span>
                            <span class="text-xl block mb-1">üè¢</span>
                            <span class="font-medium text-sm">ERP</span>
                            <p class="text-xs text-gray-500 mt-1">SAP, Oracle</p>
                        </div>
                        <div class="card p-3 rounded-lg text-center border-2 border-dashed border-gray-600 cursor-not-allowed relative">
                            <span class="absolute top-1 right-1 text-[10px] bg-yellow-500/20 text-yellow-400 px-1.5 py-0.5 rounded">Soon</span>
                            <span class="text-xl block mb-1">üé®</span>
                            <span class="font-medium text-sm">Image Gen</span>
                            <p class="text-xs text-gray-500 mt-1">DALL-E, SD</p>
                        </div>
                        <div class="card p-3 rounded-lg text-center border-2 border-dashed border-gray-600 cursor-not-allowed relative">
                            <span class="absolute top-1 right-1 text-[10px] bg-yellow-500/20 text-yellow-400 px-1.5 py-0.5 rounded">Soon</span>
                            <span class="text-xl block mb-1">üé§</span>
                            <span class="font-medium text-sm">Speech to Text</span>
                            <p class="text-xs text-gray-500 mt-1">Whisper</p>
                        </div>
                        <div class="card p-3 rounded-lg text-center border-2 border-dashed border-gray-600 cursor-not-allowed relative">
                            <span class="absolute top-1 right-1 text-[10px] bg-yellow-500/20 text-yellow-400 px-1.5 py-0.5 rounded">Soon</span>
                            <span class="text-xl block mb-1">üîä</span>
                            <span class="font-medium text-sm">Text to Speech</span>
                            <p class="text-xs text-gray-500 mt-1">ElevenLabs</p>
                        </div>
                        <div class="card p-3 rounded-lg text-center border-2 border-dashed border-gray-600 cursor-not-allowed relative">
                            <span class="absolute top-1 right-1 text-[10px] bg-yellow-500/20 text-yellow-400 px-1.5 py-0.5 rounded">Soon</span>
                            <span class="text-xl block mb-1">üåç</span>
                            <span class="font-medium text-sm">Translation</span>
                            <p class="text-xs text-gray-500 mt-1">DeepL, Google</p>
                        </div>
                        <div class="card p-3 rounded-lg text-center border-2 border-dashed border-gray-600 cursor-not-allowed relative">
                            <span class="absolute top-1 right-1 text-[10px] bg-yellow-500/20 text-yellow-400 px-1.5 py-0.5 rounded">Soon</span>
                            <span class="text-xl block mb-1">üì∑</span>
                            <span class="font-medium text-sm">OCR / Vision</span>
                            <p class="text-xs text-gray-500 mt-1">Extract text</p>
                        </div>
                        <div class="card p-3 rounded-lg text-center border-2 border-dashed border-gray-600 cursor-not-allowed relative">
                            <span class="absolute top-1 right-1 text-[10px] bg-yellow-500/20 text-yellow-400 px-1.5 py-0.5 rounded">Soon</span>
                            <span class="text-xl block mb-1">üíª</span>
                            <span class="font-medium text-sm">Code Exec</span>
                            <p class="text-xs text-gray-500 mt-1">Python, JS</p>
                        </div>
                        <div class="card p-3 rounded-lg text-center border-2 border-dashed border-gray-600 cursor-not-allowed relative">
                            <span class="absolute top-1 right-1 text-[10px] bg-yellow-500/20 text-yellow-400 px-1.5 py-0.5 rounded">Soon</span>
                            <span class="text-xl block mb-1">üë§</span>
                            <span class="font-medium text-sm">Human in Loop</span>
                            <p class="text-xs text-gray-500 mt-1">Approval</p>
                        </div>
                    </div>
                </div>
            </div>
            <div id="wiz-step-1" class="hidden space-y-4">
                <div class="flex items-center gap-3 p-3 rounded-lg step-header-box">
                    <span id="step1-icon" class="text-2xl">üîß</span>
                    <div>
                        <h4 class="font-semibold" id="step1-title">Tool Name</h4>
                        <p class="text-xs text-gray-400">Step 1 of 4: Basic Information</p>
                    </div>
                </div>
                <div>
                    <label class="text-sm text-gray-400 mb-1 block">Name *</label>
                    <input type="text" id="wiz-name" class="input-field w-full rounded-lg px-4 py-3 text-lg" placeholder="Enter a descriptive name...">
                </div>
                <div>
                    <label class="text-sm text-gray-400 mb-1 block">Description</label>
                    <textarea id="wiz-desc" rows="3" class="input-field w-full rounded-lg px-4 py-3" placeholder="What does this tool do? What data does it contain?"></textarea>
                </div>
            </div>

            <!-- Step 2: Configuration (Tool-specific) -->
            <div id="wiz-step-2" class="hidden space-y-4">
                <div class="flex items-center gap-3 p-3 rounded-lg step-header-box">
                    <span class="text-2xl">‚öôÔ∏è</span>
                    <div>
                        <h4 class="font-semibold">Configuration</h4>
                        <p class="text-xs text-gray-400">Step 2 of 4: Tool-specific settings</p>
                    </div>
                </div>
                
                <!-- Knowledge Base Config -->
                <div id="cfg-knowledge" class="hidden space-y-4">
                    <!-- Embedding -->
                    <div class="card rounded-lg p-4">
                        <div class="flex items-center justify-between mb-3">
                            <h5 class="font-medium">üìê Embedding Model</h5>
                            <label class="flex items-center gap-2 text-sm cursor-pointer">
                                <input type="checkbox" id="kb-emb-global" class="w-4 h-4" checked onchange="toggleKBEmb()">
                                <span class="text-gray-400">Use global</span>
                            </label>
                        </div>
                        <div id="kb-emb-fields" class="hidden grid md:grid-cols-2 gap-3">
                            <div>
                                <label class="text-xs text-gray-400 mb-1 block">Provider</label>
                                <select id="kb-emb-provider" class="input-field w-full rounded-lg px-3 py-2" onchange="onKBEmbChange()">
                                    <option value="openai">OpenAI</option>
                                    <option value="local">Sentence Transformers (Free)</option>
                                </select>
                            
                            </div>
                            <div>
                                <label class="text-xs text-gray-400 mb-1 block">Model</label>
                                <select id="kb-emb-model" class="input-field w-full rounded-lg px-3 py-2">
                                    <option value="text-embedding-3-small">text-embedding-3-small</option>
                                    <option value="text-embedding-3-large">text-embedding-3-large</option>
                                </select>
                            
                            </div>
                        </div>
                    </div>
                    
                    <!-- Search Settings -->
                    <div class="card rounded-lg p-4">
                        <h5 class="font-medium mb-3">üîç Search Settings</h5>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                            <div>
                                <label class="text-xs text-gray-400 mb-1 block">Chunk Size</label>
                                <input type="number" id="kb-chunk" class="input-field w-full rounded-lg px-3 py-2" value="1000">
                            </div>
                            <div>
                                <label class="text-xs text-gray-400 mb-1 block">Overlap</label>
                                <input type="number" id="kb-overlap" class="input-field w-full rounded-lg px-3 py-2" value="200">
                            </div>
                            <div>
                                <label class="text-xs text-gray-400 mb-1 block">Top K</label>
                                <input type="number" id="kb-topk" class="input-field w-full rounded-lg px-3 py-2" value="5">
                            </div>
                            <div>
                                <label class="text-xs text-gray-400 mb-1 block">Search Type</label>
                                <select id="kb-search" class="input-field w-full rounded-lg px-3 py-2">
                                    <option value="hybrid">Hybrid</option>
                                    <option value="semantic">Semantic</option>
                                    <option value="keyword">Keyword</option>
                                </select>
                            
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Website Config -->
                <div id="cfg-website" class="hidden space-y-4">
                    <div>
                        <label class="text-sm text-gray-400 mb-1 block">Website URL *</label>
                        <input type="url" id="web-url" class="input-field w-full rounded-lg px-4 py-2" placeholder="https://example.com">
                    </div>
                    <div class="flex items-center gap-4">
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" id="web-recursive" class="w-4 h-4">
                            <span class="text-sm">Recursive scraping</span>
                        </label>
                        <div class="flex items-center gap-2">
                            <label class="text-sm text-gray-400">Max pages:</label>
                            <input type="number" id="web-max" class="input-field w-20 rounded px-2 py-1" value="10">
                        </div>
                    </div>
                    
                    <!-- Existing Scraped Pages (shown when editing) -->
                    <div id="web-scraped-pages" class="hidden">
                        <div class="border-t border-gray-700 pt-4 mt-4">
                            <div class="flex items-center justify-between mb-3">
                                <h5 class="font-medium text-sm">üåê Scraped Pages</h5>
                                <button onclick="rescrapeWebsite()" class="btn-secondary px-3 py-1 rounded text-xs">üîÑ Re-scrape All</button>
                            </div>
                            <div id="web-scraped-list" class="space-y-2 max-h-48 overflow-y-auto"></div>
                        </div>
                    </div>
                </div>

                <!-- Database Config -->
                <div id="cfg-database" class="hidden space-y-4">
                    <div>
                        <label class="text-sm text-gray-400 mb-1 block">Database Type</label>
                        <select id="db-type" class="input-field w-full rounded-lg px-4 py-2" onchange="onDBTypeChange()">
                            <optgroup label="Relational Databases">
                                <option value="postgresql">PostgreSQL</option>
                                <option value="mysql">MySQL / MariaDB</option>
                                <option value="mssql">Microsoft SQL Server</option>
                                <option value="oracle">Oracle Database</option>
                                <option value="oracle_autonomous">Oracle Autonomous Database</option>
                                <option value="sqlite">SQLite</option>
                                <option value="db2">IBM Db2</option>
                                <option value="sybase">SAP Sybase</option>
                                <option value="teradata">Teradata</option>
                                <option value="snowflake">Snowflake</option>
                                <option value="redshift">Amazon Redshift</option>
                                <option value="bigquery">Google BigQuery</option>
                                <option value="azure_sql">Azure SQL Database</option>
                                <option value="cockroachdb">CockroachDB</option>
                                <option value="tidb">TiDB</option>
                            </optgroup>
                            <optgroup label="NoSQL Databases">
                                <option value="mongodb">MongoDB</option>
                                <option value="mongodb_atlas">MongoDB Atlas</option>
                                <option value="dynamodb">Amazon DynamoDB</option>
                                <option value="cosmosdb">Azure Cosmos DB</option>
                                <option value="firestore">Google Firestore</option>
                                <option value="couchdb">CouchDB</option>
                                <option value="cassandra">Apache Cassandra</option>
                                <option value="scylladb">ScyllaDB</option>
                                <option value="hbase">Apache HBase</option>
                            </optgroup>
                            <optgroup label="In-Memory / Cache">
                                <option value="redis">Redis</option>
                                <option value="memcached">Memcached</option>
                                <option value="elasticache">Amazon ElastiCache</option>
                            </optgroup>
                            <optgroup label="Search Engines">
                                <option value="elasticsearch">Elasticsearch</option>
                                <option value="opensearch">OpenSearch</option>
                                <option value="solr">Apache Solr</option>
                                <option value="meilisearch">Meilisearch</option>
                            </optgroup>
                            <optgroup label="Vector Databases">
                                <option value="pinecone">Pinecone</option>
                                <option value="weaviate">Weaviate</option>
                                <option value="qdrant">Qdrant</option>
                                <option value="milvus">Milvus</option>
                                <option value="chroma">ChromaDB</option>
                            </optgroup>
                            <optgroup label="Time Series">
                                <option value="influxdb">InfluxDB</option>
                                <option value="timescaledb">TimescaleDB</option>
                                <option value="questdb">QuestDB</option>
                            </optgroup>
                            <optgroup label="Graph Databases">
                                <option value="neo4j">Neo4j</option>
                                <option value="neptune">Amazon Neptune</option>
                                <option value="arangodb">ArangoDB</option>
                            </optgroup>
                        </select>
                            
                    </div>
                    
                    <!-- Standard Connection Fields -->
                    <div id="db-standard-fields">
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Host</label>
                                <input type="text" id="db-host" class="input-field w-full rounded-lg px-4 py-2" placeholder="localhost or hostname">
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Port</label>
                                <input type="number" id="db-port" class="input-field w-full rounded-lg px-4 py-2" value="5432">
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Database Name</label>
                                <input type="text" id="db-name" class="input-field w-full rounded-lg px-4 py-2">
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Schema (optional)</label>
                                <input type="text" id="db-schema" class="input-field w-full rounded-lg px-4 py-2" placeholder="public">
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Username</label>
                                <input type="text" id="db-user" class="input-field w-full rounded-lg px-4 py-2">
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Password</label>
                                <input type="password" id="db-pass" class="input-field w-full rounded-lg px-4 py-2">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Oracle Specific Fields -->
                    <div id="db-oracle-fields" class="hidden space-y-4">
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Connection Type</label>
                                <select id="oracle-conn-type" class="input-field w-full rounded-lg px-4 py-2" onchange="onOracleConnTypeChange()">
                                    <option value="basic">Basic (Host/Port/Service)</option>
                                    <option value="tns">TNS Name</option>
                                    <option value="connection_string">Connection String</option>
                                    <option value="wallet">Wallet (Cloud)</option>
                                </select>
                            
                            </div>
                            <div id="oracle-service-field">
                                <label class="text-sm text-gray-400 mb-1 block">Service Name / SID</label>
                                <input type="text" id="oracle-service" class="input-field w-full rounded-lg px-4 py-2" placeholder="ORCL or service_name">
                            </div>
                        </div>
                        <div id="oracle-tns-field" class="hidden">
                            <label class="text-sm text-gray-400 mb-1 block">TNS Name</label>
                            <input type="text" id="oracle-tns" class="input-field w-full rounded-lg px-4 py-2" placeholder="MY_TNS_ALIAS">
                        </div>
                        <div id="oracle-wallet-fields" class="hidden">
                            <div class="grid md:grid-cols-2 gap-4">
                                <div>
                                    <label class="text-sm text-gray-400 mb-1 block">Wallet Location</label>
                                    <input type="text" id="oracle-wallet-loc" class="input-field w-full rounded-lg px-4 py-2" placeholder="/path/to/wallet">
                                </div>
                                <div>
                                    <label class="text-sm text-gray-400 mb-1 block">Wallet Password</label>
                                    <input type="password" id="oracle-wallet-pass" class="input-field w-full rounded-lg px-4 py-2">
                                </div>
                            </div>
                            <div class="mt-3">
                                <label class="text-sm text-gray-400 mb-1 block">Or Upload Wallet ZIP</label>
                                <input type="file" id="oracle-wallet-file" class="input-field w-full rounded-lg px-4 py-2" accept=".zip">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Oracle Autonomous DB Fields -->
                    <div id="db-oracle-adb-fields" class="hidden space-y-4">
                        <div class="bg-amber-500/10 border border-amber-500/30 rounded-lg p-3 text-sm text-amber-300 mb-4">
                            ‚ÑπÔ∏è Oracle Autonomous Database requires a wallet for secure connections. Download it from OCI Console.
                        </div>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">ADB Type</label>
                                <select id="oracle-adb-type" class="input-field w-full rounded-lg px-4 py-2">
                                    <option value="atp">Autonomous Transaction Processing (ATP)</option>
                                    <option value="adw">Autonomous Data Warehouse (ADW)</option>
                                    <option value="ajd">Autonomous JSON Database (AJD)</option>
                                    <option value="apex">APEX Service</option>
                                </select>
                            
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Connection Service</label>
                                <select id="oracle-adb-service" class="input-field w-full rounded-lg px-4 py-2">
                                    <option value="high">High (Parallel Queries)</option>
                                    <option value="medium">Medium (Balanced)</option>
                                    <option value="low">Low (Serial)</option>
                                    <option value="tp">TP (Transaction Processing)</option>
                                    <option value="tpurgent">TP Urgent</option>
                                </select>
                            
                            </div>
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Database Name</label>
                            <input type="text" id="oracle-adb-name" class="input-field w-full rounded-lg px-4 py-2" placeholder="myatp_high">
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Wallet ZIP File</label>
                            <input type="file" id="oracle-adb-wallet" class="input-field w-full rounded-lg px-4 py-2" accept=".zip">
                        </div>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Username</label>
                                <input type="text" id="oracle-adb-user" class="input-field w-full rounded-lg px-4 py-2" placeholder="ADMIN">
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Password</label>
                                <input type="password" id="oracle-adb-pass" class="input-field w-full rounded-lg px-4 py-2">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Cloud DB Fields (BigQuery, Snowflake, etc) -->
                    <div id="db-cloud-fields" class="hidden space-y-4">
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Account / Project ID</label>
                                <input type="text" id="db-cloud-account" class="input-field w-full rounded-lg px-4 py-2" placeholder="my-project-id">
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Warehouse / Dataset</label>
                                <input type="text" id="db-cloud-warehouse" class="input-field w-full rounded-lg px-4 py-2">
                            </div>
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Service Account / API Key JSON</label>
                            <textarea id="db-cloud-creds" rows="3" class="input-field w-full rounded-lg px-4 py-2 font-mono text-xs" placeholder="Paste credentials JSON or API key"></textarea>
                        </div>
                        <div id="db-snowflake-extra" class="hidden grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Role</label>
                                <input type="text" id="db-snowflake-role" class="input-field w-full rounded-lg px-4 py-2" placeholder="ACCOUNTADMIN">
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Region</label>
                                <input type="text" id="db-snowflake-region" class="input-field w-full rounded-lg px-4 py-2" placeholder="us-east-1">
                            </div>
                        </div>
                    </div>
                    
                    <!-- NoSQL Fields (MongoDB, etc) -->
                    <div id="db-nosql-fields" class="hidden space-y-4">
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Connection String</label>
                            <input type="text" id="db-nosql-uri" class="input-field w-full rounded-lg px-4 py-2" placeholder="mongodb+srv://user:pass@cluster.mongodb.net/db">
                        </div>
                        <div class="flex items-center gap-4">
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="db-nosql-ssl" class="w-4 h-4" checked>
                                <span class="text-sm">Use SSL/TLS</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="db-nosql-srv" class="w-4 h-4">
                                <span class="text-sm">SRV Record</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Vector DB Fields -->
                    <div id="db-vector-fields" class="hidden space-y-4">
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">API Key</label>
                                <input type="password" id="db-vector-key" class="input-field w-full rounded-lg px-4 py-2">
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Environment / Region</label>
                                <input type="text" id="db-vector-env" class="input-field w-full rounded-lg px-4 py-2" placeholder="us-east-1-aws">
                            </div>
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Index / Collection Name</label>
                            <input type="text" id="db-vector-index" class="input-field w-full rounded-lg px-4 py-2" placeholder="my-index">
                        </div>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Dimensions</label>
                                <input type="number" id="db-vector-dims" class="input-field w-full rounded-lg px-4 py-2" value="1536">
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Metric</label>
                                <select id="db-vector-metric" class="input-field w-full rounded-lg px-4 py-2">
                                    <option value="cosine">Cosine Similarity</option>
                                    <option value="euclidean">Euclidean Distance</option>
                                    <option value="dotproduct">Dot Product</option>
                                </select>
                            
                            </div>
                        </div>
                    </div>
                    
                    <!-- Connection Options -->
                    <div class="border-t border-gray-700 pt-4 mt-4">
                        <p class="text-sm text-gray-400 mb-3">Connection Options</p>
                        <div class="flex flex-wrap gap-4">
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="db-ssl" class="w-4 h-4">
                                <span class="text-sm">Use SSL/TLS</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="db-readonly" class="w-4 h-4">
                                <span class="text-sm">Read-only mode</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="db-pool" class="w-4 h-4" checked>
                                <span class="text-sm">Connection pooling</span>
                            </label>
                        </div>
                        <div class="grid md:grid-cols-2 gap-4 mt-3">
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Connection Timeout (sec)</label>
                                <input type="number" id="db-timeout" class="input-field w-full rounded-lg px-4 py-2" value="30">
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Max Connections</label>
                                <input type="number" id="db-max-conn" class="input-field w-full rounded-lg px-4 py-2" value="10">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- API Config -->
                <div id="cfg-api" class="hidden space-y-4">
                    <div class="grid md:grid-cols-4 gap-4">
                        <div class="md:col-span-3">
                            <label class="text-sm text-gray-400 mb-1 block">Base URL *</label>
                            <input type="url" id="api-url" class="input-field w-full rounded-lg px-4 py-2" placeholder="https://api.example.com">
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Method</label>
                            <select id="api-method" class="input-field w-full rounded-lg px-4 py-2">
                                <option>GET</option>
                                <option>POST</option>
                                <option>PUT</option>
                                <option>DELETE</option>
                            </select>
                            
                        </div>
                    </div>
                    <div>
                        <label class="text-sm text-gray-400 mb-1 block">Endpoint Path</label>
                        <input type="text" id="api-path" class="input-field w-full rounded-lg px-4 py-2" placeholder="/v1/data">
                    </div>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Authentication</label>
                            <select id="api-auth" class="input-field w-full rounded-lg px-4 py-2" onchange="onApiAuthChange()">
                                <option value="none">None</option>
                                <option value="api_key">API Key</option>
                                <option value="bearer">Bearer Token</option>
                            </select>
                            
                        </div>
                        <div id="api-auth-val-group" class="hidden">
                            <label class="text-sm text-gray-400 mb-1 block">Auth Value</label>
                            <input type="password" id="api-auth-val" class="input-field w-full rounded-lg px-4 py-2">
                        </div>
                    </div>

                    <!-- Parameters (optional) - non-technical: user gets list from IT -->
                    <div class="border-t border-gray-700/60 pt-4 mt-4">
                        <h5 class="text-sm font-semibold text-gray-300 mb-1">Fields this API needs <span class="text-gray-500 font-normal">(optional)</span></h5>
                        <p class="text-xs text-gray-500 mb-3">If your IT team gave you a list of fields (e.g. city, ID, date), add them here. Leave empty if the API doesn‚Äôt need any.</p>
                        <div id="api-params-list" class="space-y-3 mb-3"></div>
                        <button type="button" onclick="addApiParam()" class="btn-secondary px-4 py-2 rounded-lg text-sm flex items-center gap-2">
                            <span>+</span> Add field
                        </button>
                    </div>

                    <!-- Try API (test from wizard) -->
                    <div class="border-t border-gray-700/60 pt-4 mt-4">
                        <p class="text-sm text-gray-400 mb-3">Check that the connection works before saving.</p>
                        <button type="button" onclick="openWizardApiTestModal()" class="btn-primary px-5 py-2.5 rounded-lg flex items-center gap-2">
                            <span>üß™</span> Try this API
                        </button>
                    </div>
                </div>

                <!-- Email Config -->
                <div id="cfg-email" class="hidden space-y-4">
                    <!-- Super Simple - Just Connect -->
                    <div class="space-y-3">
                        <!-- Google / Gmail -->
                        <div id="gmail-connect-card" class="card rounded-xl p-5 border-2 border-transparent hover:border-purple-500 transition">
                            <div class="flex items-center gap-4">
                                <div class="w-14 h-14 rounded-xl bg-white flex items-center justify-center shadow-sm shrink-0">
                                    <svg width="32" height="32" viewBox="0 0 24 24">
                                        <path fill="#EA4335" d="M24 5.457v13.909c0 .904-.732 1.636-1.636 1.636h-3.819V11.73L12 16.64l-6.545-4.91v9.273H1.636A1.636 1.636 0 0 1 0 19.366V5.457c0-2.023 2.309-3.178 3.927-1.964L5.455 4.64 12 9.548l6.545-4.91 1.528-1.145C21.69 2.28 24 3.434 24 5.457z"/>
                                    </svg>
                                </div>
                                <div class="flex-1">
                                    <h5 class="font-semibold text-lg" style="color:var(--text-primary);">Gmail</h5>
                                    <p class="text-sm" style="color:var(--text-muted);">Send emails from your Gmail account</p>
                                </div>
                                <button onclick="connectEmailProvider('google')" id="gmail-connect-btn" class="btn-primary px-5 py-2.5 rounded-lg flex items-center gap-2">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                                    </svg>
                                    Connect
                                </button>
                            </div>
                            <!-- Connected State (hidden by default) -->
                            <div id="gmail-connected" class="hidden mt-4 pt-4 border-t" style="border-color:var(--border-color);">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-3">
                                        <div class="w-8 h-8 rounded-full bg-green-500/20 flex items-center justify-center">
                                            <span class="text-green-500">‚úì</span>
                                        </div>
                                        <div>
                                            <p class="text-sm font-medium" style="color:var(--text-primary);">Connected</p>
                                            <p class="text-xs" style="color:var(--text-muted);" id="gmail-connected-email"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="265355435466435e474b564a430845494b">[email&#160;protected]</a></p>
                                        </div>
                                    </div>
                                    <button onclick="disconnectEmailProvider('google')" class="text-xs px-3 py-1.5 rounded-lg hover:bg-red-500/10 text-red-400">
                                        Disconnect
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Microsoft / Outlook -->
                        <div id="outlook-connect-card" class="card rounded-xl p-5 border-2 border-transparent hover:border-purple-500 transition">
                            <div class="flex items-center gap-4">
                                <div class="w-14 h-14 rounded-xl bg-white flex items-center justify-center shadow-sm shrink-0">
                                    <svg width="32" height="32" viewBox="0 0 24 24">
                                        <path fill="#0078D4" d="M24 7.387v10.478c0 .23-.08.424-.238.576-.158.154-.352.23-.58.23h-8.547v-6.959l1.6 1.229c.102.086.228.13.378.13.15 0 .276-.044.378-.13l6.771-5.186c.076-.056.142-.076.199-.06.057.017.086.063.086.138v10.054c0 .077-.03.14-.09.186-.06.047-.126.07-.2.07H15.91v1.14h8.908c.076 0 .14-.028.188-.084.047-.056.07-.12.07-.19V7.387z"/>
                                        <path fill="#0078D4" d="M15.635 9.807v11.57H.818c-.227 0-.42-.078-.577-.234C.083 21.013 0 20.83 0 20.604V7.387l7.818 5.642 7.817-3.222z"/>
                                        <path fill="#28A8EA" d="M15.635 2.623v7.184l-7.817 3.222L0 7.387V3.396c0-.227.083-.42.241-.577C.398 2.662.591 2.58.818 2.58h14.043c.227 0 .42.082.577.24.157.158.197.35.197.577v-.774z"/>
                                    </svg>
                                </div>
                                <div class="flex-1">
                                    <h5 class="font-semibold text-lg" style="color:var(--text-primary);">Outlook</h5>
                                    <p class="text-sm" style="color:var(--text-muted);">Send emails from your Microsoft account</p>
                                </div>
                                <button onclick="connectEmailProvider('microsoft')" id="outlook-connect-btn" class="btn-secondary px-5 py-2.5 rounded-lg flex items-center gap-2">
                                    Connect
                                </button>
                            </div>
                            <!-- Connected State -->
                            <div id="outlook-connected" class="hidden mt-4 pt-4 border-t" style="border-color:var(--border-color);">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-3">
                                        <div class="w-8 h-8 rounded-full bg-green-500/20 flex items-center justify-center">
                                            <span class="text-green-500">‚úì</span>
                                        </div>
                                        <div>
                                            <p class="text-sm font-medium" style="color:var(--text-primary);">Connected</p>
                                            <p class="text-xs" style="color:var(--text-muted);" id="outlook-connected-email"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="dda8aeb8af9db8a5bcb0adb1b8f3beb2b0">[email&#160;protected]</a></p>
                                        </div>
                                    </div>
                                    <button onclick="disconnectEmailProvider('microsoft')" class="text-xs px-3 py-1.5 rounded-lg hover:bg-red-500/10 text-red-400">
                                        Disconnect
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- SendGrid (for power users) -->
                        <div id="sendgrid-connect-card" class="card rounded-xl p-5 border-2 border-transparent hover:border-purple-500 transition">
                            <div class="flex items-center gap-4">
                                <div class="w-14 h-14 rounded-xl bg-[#1A82E2] flex items-center justify-center shadow-sm shrink-0">
                                    <span class="text-white font-bold text-xl">SG</span>
                                </div>
                                <div class="flex-1">
                                    <div class="flex items-center gap-2">
                                        <h5 class="font-semibold text-lg" style="color:var(--text-primary);">SendGrid</h5>
                                        <span class="text-xs px-2 py-0.5 rounded-full bg-blue-500/20 text-blue-400">Pro</span>
                                    </div>
                                    <p class="text-sm" style="color:var(--text-muted);">Professional email delivery service</p>
                                </div>
                                <button onclick="toggleSendGridSetup()" id="sendgrid-setup-btn" class="btn-secondary px-5 py-2.5 rounded-lg">
                                    Setup
                                </button>
                            </div>
                            <!-- SendGrid Setup -->
                            <div id="sendgrid-setup" class="hidden mt-4 pt-4 border-t space-y-3" style="border-color:var(--border-color);">
                                <div>
                                    <label class="text-sm mb-1 block" style="color:var(--text-secondary);">API Key</label>
                                    <input type="password" id="sendgrid-api-key" class="input-field w-full rounded-lg px-4 py-2.5" placeholder="SG.xxxxxxxxxxxx">
                                </div>
                                <div>
                                    <label class="text-sm mb-1 block" style="color:var(--text-secondary);">From Email</label>
                                    <input type="email" id="sendgrid-from-email" class="input-field w-full rounded-lg px-4 py-2.5" placeholder="notifications@yourdomain.com">
                                </div>
                                <div class="flex justify-end">
                                    <button onclick="saveSendGridConfig()" class="btn-primary px-4 py-2 rounded-lg text-sm">Save</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Hidden field -->
                    <input type="hidden" id="email-provider" value="">
                    <input type="hidden" id="email-config-data" value="">
                </div>

                <!-- Webhook Config -->
                <div id="cfg-webhook" class="hidden space-y-4">
                    <div>
                        <label class="text-sm text-gray-400 mb-1 block">Webhook URL *</label>
                        <input type="url" id="hook-url" class="input-field w-full rounded-lg px-4 py-2" placeholder="https://api.example.com/webhook">
                    </div>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Method</label>
                            <select id="hook-method" class="input-field w-full rounded-lg px-4 py-2">
                                <option>POST</option>
                                <option>PUT</option>
                            </select>
                            
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Secret (optional)</label>
                            <input type="password" id="hook-secret" class="input-field w-full rounded-lg px-4 py-2">
                        </div>
                    </div>
                </div>

                <!-- Web Search Config -->
                <div id="cfg-websearch" class="hidden space-y-4">
                    <div>
                        <label class="text-sm text-gray-400 mb-1 block">Search Provider</label>
                        <select id="search-provider" class="input-field w-full rounded-lg px-4 py-2">
                            <option value="tavily">Tavily (AI-optimized)</option>
                            <option value="serper">Serper (Google)</option>
                            <option value="bing">Bing Search</option>
                        </select>
                            
                    </div>
                    <div>
                        <label class="text-sm text-gray-400 mb-1 block">API Key *</label>
                        <input type="password" id="search-key" class="input-field w-full rounded-lg px-4 py-2">
                    </div>
                </div>

                <!-- Code Exec Config -->
                <div id="cfg-code" class="hidden space-y-4">
                    <div>
                        <label class="text-sm text-gray-400 mb-1 block">Execution Mode</label>
                        <select id="code-mode" class="input-field w-full rounded-lg px-4 py-2" onchange="onCodeModeChange()">
                            <option value="execute">Execute Provided Code</option>
                            <option value="generate">Generate Code from Description (AI)</option>
                            <option value="both">Both (Generate & Execute)</option>
                        </select>
                            
                    </div>
                    
                    <!-- Code Generation Section -->
                    <div id="code-gen-section" class="hidden space-y-4">
                        <div class="bg-purple-500/10 border border-purple-500/30 rounded-lg p-3 text-sm text-purple-300 mb-2">
                            ‚ú® AI will generate tool code based on your description. Describe what the tool should do and the AI will create the implementation.
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Tool Description *</label>
                            <textarea id="code-description" rows="4" class="input-field w-full rounded-lg px-4 py-2" placeholder="Describe what this tool should do in detail...

Example: A tool that fetches weather data from OpenWeatherMap API. It should accept a city name as input and return current temperature, humidity, and weather conditions. Handle API errors gracefully."></textarea>
                        </div>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Input Parameters</label>
                                <input type="text" id="code-inputs" class="input-field w-full rounded-lg px-4 py-2" placeholder="city: string, units: string">
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Output Format</label>
                                <select id="code-output-format" class="input-field w-full rounded-lg px-4 py-2">
                                    <option value="json">JSON Object</option>
                                    <option value="text">Plain Text</option>
                                    <option value="number">Number</option>
                                    <option value="boolean">Boolean</option>
                                    <option value="array">Array</option>
                                </select>
                            
                            </div>
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">API Keys / Credentials (will be injected as env vars)</label>
                            <textarea id="code-env-vars" rows="2" class="input-field w-full rounded-lg px-4 py-2 font-mono text-xs" placeholder="OPENWEATHER_API_KEY=xxxxx
OTHER_API_KEY=yyyyy"></textarea>
                        </div>
                        <button onclick="generateToolCode()" class="w-full bg-purple-600 hover:bg-purple-500 rounded-lg py-3 font-medium flex items-center justify-center gap-2">
                            <span>‚ú®</span> Generate Code
                        </button>
                        <div id="generated-code-preview" class="hidden">
                            <label class="text-sm text-gray-400 mb-1 block">Generated Code (editable)</label>
                            <textarea id="code-generated" rows="12" class="input-field w-full rounded-lg px-4 py-2 font-mono text-xs"></textarea>
                        </div>
                    </div>
                    
                    <!-- Manual Code Section -->
                    <div id="code-manual-section">
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Language</label>
                            <select id="code-lang" class="input-field w-full rounded-lg px-4 py-2">
                                <option value="python">Python 3</option>
                                <option value="javascript">JavaScript (Node.js)</option>
                                <option value="typescript">TypeScript</option>
                                <option value="bash">Bash Script</option>
                                <option value="ruby">Ruby</option>
                                <option value="go">Go</option>
                                <option value="rust">Rust</option>
                            </select>
                            
                        </div>
                        <div id="code-manual-input">
                            <label class="text-sm text-gray-400 mb-1 block">Code Template (optional)</label>
                            <textarea id="code-template" rows="6" class="input-field w-full rounded-lg px-4 py-2 font-mono text-xs" placeholder="# Your code here
def run(input_data):
    # Process input
    result = process(input_data)
    return result"></textarea>
                        </div>
                    </div>
                    
                    <!-- Execution Settings -->
                    <div class="border-t border-gray-700 pt-4 mt-4">
                        <p class="text-sm text-gray-400 mb-3">Execution Settings</p>
                        <div class="grid md:grid-cols-3 gap-4">
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Timeout (seconds)</label>
                                <input type="number" id="code-timeout" class="input-field w-full rounded-lg px-4 py-2" value="30">
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Memory (MB)</label>
                                <input type="number" id="code-memory" class="input-field w-full rounded-lg px-4 py-2" value="256">
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Max Retries</label>
                                <input type="number" id="code-retries" class="input-field w-full rounded-lg px-4 py-2" value="3">
                            </div>
                        </div>
                        <div class="flex flex-wrap gap-4 mt-3">
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="code-sandbox" class="w-4 h-4" checked>
                                <span class="text-sm">Run in sandbox</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="code-network" class="w-4 h-4" checked>
                                <span class="text-sm">Allow network access</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="code-filesystem" class="w-4 h-4">
                                <span class="text-sm">Allow file system</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Dependencies -->
                    <div>
                        <label class="text-sm text-gray-400 mb-1 block">Dependencies / Packages</label>
                        <input type="text" id="code-deps" class="input-field w-full rounded-lg px-4 py-2" placeholder="requests, pandas, numpy (comma separated)">
                    </div>
                </div>

                <!-- Human in the Loop Config -->
                <div id="cfg-hitl" class="hidden space-y-4">
                    <div class="bg-blue-500/10 border border-blue-500/30 rounded-lg p-3 text-sm text-blue-300 mb-2">
                        üë§ Human in the Loop allows you to pause agent execution for human approval, input collection, or decision making.
                    </div>
                    
                    <div>
                        <label class="text-sm text-gray-400 mb-1 block">Interaction Type</label>
                        <select id="hitl-type" class="input-field w-full rounded-lg px-4 py-2" onchange="onHITLTypeChange()">
                            <option value="approval">Approval (Yes/No/Maybe)</option>
                            <option value="input">Text Input</option>
                            <option value="selection">Selection (Multiple Choice)</option>
                            <option value="form">Custom Form</option>
                            <option value="review">Review & Edit</option>
                            <option value="escalation">Escalation to Human</option>
                        </select>
                            
                    </div>
                    
                    <!-- Approval Fields -->
                    <div id="hitl-approval-fields" class="space-y-4">
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Approval Question</label>
                            <input type="text" id="hitl-question" class="input-field w-full rounded-lg px-4 py-2" placeholder="Should we proceed with this action?">
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Options</label>
                            <div class="flex flex-wrap gap-2">
                                <label class="flex items-center gap-2"><input type="checkbox" id="hitl-opt-yes" checked> Yes</label>
                                <label class="flex items-center gap-2"><input type="checkbox" id="hitl-opt-no" checked> No</label>
                                <label class="flex items-center gap-2"><input type="checkbox" id="hitl-opt-maybe"> Maybe/Later</label>
                                <label class="flex items-center gap-2"><input type="checkbox" id="hitl-opt-custom"> Custom options</label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Selection Fields -->
                    <div id="hitl-selection-fields" class="hidden space-y-4">
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Selection Prompt</label>
                            <input type="text" id="hitl-select-prompt" class="input-field w-full rounded-lg px-4 py-2" placeholder="Please select an option:">
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Options (one per line)</label>
                            <textarea id="hitl-options" rows="4" class="input-field w-full rounded-lg px-4 py-2" placeholder="Option 1
Option 2
Option 3"></textarea>
                        </div>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" id="hitl-multi-select" class="w-4 h-4">
                            <span class="text-sm">Allow multiple selections</span>
                        </label>
                    </div>
                    
                    <!-- Form Builder Fields -->
                    <div id="hitl-form-fields" class="hidden space-y-4">
                        <div class="bg-purple-500/10 border border-purple-500/30 rounded-lg p-3 text-sm text-purple-300 mb-2">
                            üìù Build a custom form that will be presented to users. You can optionally deploy it as a web form.
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Form Title</label>
                            <input type="text" id="hitl-form-title" class="input-field w-full rounded-lg px-4 py-2" placeholder="Customer Feedback Form">
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Form Description</label>
                            <textarea id="hitl-form-desc" rows="2" class="input-field w-full rounded-lg px-4 py-2" placeholder="Please provide your feedback..."></textarea>
                        </div>
                        
                        <!-- Form Fields Builder -->
                        <div>
                            <label class="text-sm text-gray-400 mb-2 block">Form Fields</label>
                            <div id="hitl-form-builder" class="space-y-2">
                                <!-- Dynamic form fields will be added here -->
                            </div>
                            <button onclick="addHITLFormField()" class="mt-2 text-sm text-purple-400 hover:text-purple-300 flex items-center gap-1">
                                <span>+</span> Add Field
                            </button>
                        </div>
                        
                        <!-- Form Field Template (hidden) -->
                        <template id="hitl-field-template">
                            <div class="card rounded-lg p-3 space-y-2 hitl-field-item">
                                <div class="flex items-center justify-between">
                                    <input type="text" class="input-field flex-1 rounded px-2 py-1 text-sm hitl-field-label" placeholder="Field Label">
                                    <button onclick="removeHITLFormField(this)" class="text-red-400 hover:text-red-300 p-1">üóëÔ∏è</button>
                                </div>
                                <div class="grid grid-cols-2 gap-2">
                                    <select class="input-field rounded px-2 py-1 text-sm hitl-field-type" onchange="onHITLFieldTypeChange(this)">
                                        <option value="text">Text Input</option>
                                        <option value="textarea">Text Area</option>
                                        <option value="number">Number</option>
                                        <option value="email">Email</option>
                                        <option value="phone">Phone</option>
                                        <option value="date">Date</option>
                                        <option value="time">Time</option>
                                        <option value="select">Dropdown</option>
                                        <option value="radio">Radio Buttons</option>
                                        <option value="checkbox">Checkboxes</option>
                                        <option value="file">File Upload</option>
                                        <option value="rating">Rating (1-5)</option>
                                    </select>
                            
                                    <label class="flex items-center gap-1 text-sm">
                                        <input type="checkbox" class="hitl-field-required">
                                        Required
                                    </label>
                                </div>
                                <input type="text" class="input-field w-full rounded px-2 py-1 text-sm hitl-field-options hidden" placeholder="Options (comma separated)">
                            </div>
                        </template>
                        
                        <!-- Web Form Deployment (optional) -->
                        <div class="border-t border-gray-700 pt-4 mt-4">
                            <label class="flex items-center gap-2 cursor-pointer mb-3">
                                <input type="checkbox" id="hitl-deploy-form" class="w-4 h-4" onchange="toggleHITLDeployment()">
                                <span class="text-sm font-medium">Deploy as Web Form</span>
                            </label>
                            <div id="hitl-deployment-fields" class="hidden space-y-4">
                                <div class="grid md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="text-sm text-gray-400 mb-1 block">Form URL Slug</label>
                                        <div class="flex items-center gap-1">
                                            <span class="text-sm text-gray-500">/forms/</span>
                                            <input type="text" id="hitl-form-slug" class="input-field flex-1 rounded-lg px-3 py-2" placeholder="customer-feedback">
                                        </div>
                                    </div>
                                    <div>
                                        <label class="text-sm text-gray-400 mb-1 block">Expiration</label>
                                        <select id="hitl-form-expiry" class="input-field w-full rounded-lg px-4 py-2">
                                            <option value="never">Never</option>
                                            <option value="1h">1 Hour</option>
                                            <option value="24h">24 Hours</option>
                                            <option value="7d">7 Days</option>
                                            <option value="30d">30 Days</option>
                                        </select>
                            
                                    </div>
                                </div>
                                <div class="flex flex-wrap gap-4">
                                    <label class="flex items-center gap-2 cursor-pointer">
                                        <input type="checkbox" id="hitl-form-public" class="w-4 h-4">
                                        <span class="text-sm">Public (no auth required)</span>
                                    </label>
                                    <label class="flex items-center gap-2 cursor-pointer">
                                        <input type="checkbox" id="hitl-form-notify" class="w-4 h-4" checked>
                                        <span class="text-sm">Notify on submission</span>
                                    </label>
                                </div>
                                <div>
                                    <label class="text-sm text-gray-400 mb-1 block">Notification Email</label>
                                    <input type="email" id="hitl-notify-email" class="input-field w-full rounded-lg px-4 py-2" placeholder="admin@company.com">
                                </div>
                                <div>
                                    <label class="text-sm text-gray-400 mb-1 block">Webhook URL (optional)</label>
                                    <input type="url" id="hitl-webhook" class="input-field w-full rounded-lg px-4 py-2" placeholder="https://your-server.com/webhook">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Common Settings -->
                    <div class="border-t border-gray-700 pt-4 mt-4">
                        <p class="text-sm text-gray-400 mb-3">Behavior Settings</p>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Timeout (minutes)</label>
                                <input type="number" id="hitl-timeout" class="input-field w-full rounded-lg px-4 py-2" value="60" placeholder="0 = no timeout">
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Default Action (on timeout)</label>
                                <select id="hitl-default" class="input-field w-full rounded-lg px-4 py-2">
                                    <option value="wait">Keep Waiting</option>
                                    <option value="approve">Auto Approve</option>
                                    <option value="reject">Auto Reject</option>
                                    <option value="escalate">Escalate</option>
                                </select>
                            
                            </div>
                        </div>
                        <div class="flex flex-wrap gap-4 mt-3">
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="hitl-notify-slack" class="w-4 h-4">
                                <span class="text-sm">Notify via Slack</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="hitl-notify-email-opt" class="w-4 h-4">
                                <span class="text-sm">Notify via Email</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="hitl-log" class="w-4 h-4" checked>
                                <span class="text-sm">Log all interactions</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Spreadsheet Config -->
                <div id="cfg-spreadsheet" class="hidden space-y-4">
                    <div>
                        <label class="text-sm text-gray-400 mb-1 block">Provider</label>
                        <select id="sheet-provider" class="input-field w-full rounded-lg px-4 py-2" onchange="onSheetProvChange()">
                            <option value="google">Google Sheets</option>
                            <option value="airtable">Airtable</option>
                            <option value="excel">Excel Online</option>
                        </select>
                            
                    </div>
                    <div id="sheet-google-fields">
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Spreadsheet ID</label>
                            <input type="text" id="sheet-id" class="input-field w-full rounded-lg px-4 py-2" placeholder="From URL: docs.google.com/spreadsheets/d/[ID]">
                        </div>
                        <div class="mt-3">
                            <label class="text-sm text-gray-400 mb-1 block">Service Account JSON</label>
                            <textarea id="sheet-creds" rows="3" class="input-field w-full rounded-lg px-4 py-2 font-mono text-xs" placeholder='{"type": "service_account", ...}'></textarea>
                        </div>
                    </div>
                    <div id="sheet-airtable-fields" class="hidden">
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">API Key</label>
                            <input type="password" id="airtable-key" class="input-field w-full rounded-lg px-4 py-2">
                        </div>
                        <div class="mt-3">
                            <label class="text-sm text-gray-400 mb-1 block">Base ID</label>
                            <input type="text" id="airtable-base" class="input-field w-full rounded-lg px-4 py-2" placeholder="appXXXXXXXXXXXXXX">
                        </div>
                    </div>
                </div>

                <!-- Cloud Storage Config -->
                <div id="cfg-storage" class="hidden space-y-4">
                    <div>
                        <label class="text-sm text-gray-400 mb-1 block">Storage Type</label>
                        <select id="storage-type" class="input-field w-full rounded-lg px-4 py-2" onchange="onStorageTypeChange()">
                            <option value="cloud">Cloud Storage</option>
                            <option value="local">Local / Network Storage</option>
                        </select>
                            
                    </div>
                    
                    <!-- Cloud Storage Providers -->
                    <div id="storage-cloud-section">
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Provider</label>
                            <select id="storage-provider" class="input-field w-full rounded-lg px-4 py-2" onchange="onStorageProvChange()">
                                <optgroup label="Amazon Web Services">
                                    <option value="s3">Amazon S3</option>
                                    <option value="s3_glacier">Amazon S3 Glacier</option>
                                    <option value="efs">Amazon EFS</option>
                                </optgroup>
                                <optgroup label="Google Cloud">
                                    <option value="gcs">Google Cloud Storage</option>
                                    <option value="gcs_nearline">GCS Nearline</option>
                                    <option value="gcs_coldline">GCS Coldline</option>
                                    <option value="gcs_archive">GCS Archive</option>
                                </optgroup>
                                <optgroup label="Microsoft Azure">
                                    <option value="azure_blob">Azure Blob Storage</option>
                                    <option value="azure_files">Azure Files</option>
                                    <option value="azure_datalake">Azure Data Lake Storage</option>
                                    <option value="azure_archive">Azure Archive Storage</option>
                                </optgroup>
                                <optgroup label="Oracle Cloud Infrastructure">
                                    <option value="oci_object">OCI Object Storage</option>
                                    <option value="oci_archive">OCI Archive Storage</option>
                                    <option value="oci_file">OCI File Storage</option>
                                    <option value="oci_block">OCI Block Volume</option>
                                </optgroup>
                                <optgroup label="Other Cloud Providers">
                                    <option value="ibm_cos">IBM Cloud Object Storage</option>
                                    <option value="alibaba_oss">Alibaba Cloud OSS</option>
                                    <option value="digitalocean_spaces">DigitalOcean Spaces</option>
                                    <option value="backblaze_b2">Backblaze B2</option>
                                    <option value="wasabi">Wasabi</option>
                                    <option value="cloudflare_r2">Cloudflare R2</option>
                                    <option value="linode_obj">Linode Object Storage</option>
                                    <option value="vultr_obj">Vultr Object Storage</option>
                                    <option value="minio">MinIO (S3 Compatible)</option>
                                </optgroup>
                            </select>
                            
                        </div>
                        
                        <!-- Standard S3-Compatible Fields -->
                        <div id="storage-s3-fields" class="mt-4 space-y-4">
                            <div class="grid md:grid-cols-2 gap-4">
                                <div>
                                    <label class="text-sm text-gray-400 mb-1 block">Bucket / Container Name</label>
                                    <input type="text" id="storage-bucket" class="input-field w-full rounded-lg px-4 py-2">
                                </div>
                                <div>
                                    <label class="text-sm text-gray-400 mb-1 block">Region</label>
                                    <input type="text" id="storage-region" class="input-field w-full rounded-lg px-4 py-2" placeholder="us-east-1">
                                </div>
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Access Key ID</label>
                                <input type="password" id="storage-key" class="input-field w-full rounded-lg px-4 py-2">
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Secret Access Key</label>
                                <input type="password" id="storage-secret" class="input-field w-full rounded-lg px-4 py-2">
                            </div>
                            <div id="storage-endpoint-field" class="hidden">
                                <label class="text-sm text-gray-400 mb-1 block">Custom Endpoint URL</label>
                                <input type="url" id="storage-endpoint" class="input-field w-full rounded-lg px-4 py-2" placeholder="https://s3.custom-endpoint.com">
                            </div>
                        </div>
                        
                        <!-- OCI Object Storage Fields -->
                        <div id="storage-oci-fields" class="hidden mt-4 space-y-4">
                            <div class="bg-orange-500/10 border border-orange-500/30 rounded-lg p-3 text-sm text-orange-300 mb-2">
                                ‚ÑπÔ∏è OCI requires API Key authentication. Generate keys from OCI Console ‚Üí User Settings ‚Üí API Keys
                            </div>
                            <div class="grid md:grid-cols-2 gap-4">
                                <div>
                                    <label class="text-sm text-gray-400 mb-1 block">Namespace</label>
                                    <input type="text" id="oci-namespace" class="input-field w-full rounded-lg px-4 py-2" placeholder="your-tenancy-namespace">
                                </div>
                                <div>
                                    <label class="text-sm text-gray-400 mb-1 block">Bucket Name</label>
                                    <input type="text" id="oci-bucket" class="input-field w-full rounded-lg px-4 py-2">
                                </div>
                                <div>
                                    <label class="text-sm text-gray-400 mb-1 block">Compartment OCID</label>
                                    <input type="text" id="oci-compartment" class="input-field w-full rounded-lg px-4 py-2" placeholder="ocid1.compartment.oc1..">
                                </div>
                                <div>
                                    <label class="text-sm text-gray-400 mb-1 block">Region</label>
                                    <select id="oci-region" class="input-field w-full rounded-lg px-4 py-2">
                                        <option value="us-ashburn-1">US East (Ashburn)</option>
                                        <option value="us-phoenix-1">US West (Phoenix)</option>
                                        <option value="eu-frankfurt-1">Germany (Frankfurt)</option>
                                        <option value="eu-london-1">UK (London)</option>
                                        <option value="ap-tokyo-1">Japan (Tokyo)</option>
                                        <option value="ap-sydney-1">Australia (Sydney)</option>
                                        <option value="ap-mumbai-1">India (Mumbai)</option>
                                        <option value="me-jeddah-1">Saudi Arabia (Jeddah)</option>
                                        <option value="me-dubai-1">UAE (Dubai)</option>
                                        <option value="sa-saopaulo-1">Brazil (Sao Paulo)</option>
                                    </select>
                            
                                </div>
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">User OCID</label>
                                <input type="text" id="oci-user-ocid" class="input-field w-full rounded-lg px-4 py-2" placeholder="ocid1.user.oc1..">
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Tenancy OCID</label>
                                <input type="text" id="oci-tenancy-ocid" class="input-field w-full rounded-lg px-4 py-2" placeholder="ocid1.tenancy.oc1..">
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">API Key Fingerprint</label>
                                <input type="text" id="oci-fingerprint" class="input-field w-full rounded-lg px-4 py-2" placeholder="xx:xx:xx:xx:xx:...">
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Private Key (PEM)</label>
                                <textarea id="oci-private-key" rows="4" class="input-field w-full rounded-lg px-4 py-2 font-mono text-xs" placeholder="-----BEGIN RSA PRIVATE KEY-----..."></textarea>
                            </div>
                        </div>
                        
                        <!-- Azure Fields -->
                        <div id="storage-azure-fields" class="hidden mt-4 space-y-4">
                            <div class="grid md:grid-cols-2 gap-4">
                                <div>
                                    <label class="text-sm text-gray-400 mb-1 block">Storage Account Name</label>
                                    <input type="text" id="azure-account" class="input-field w-full rounded-lg px-4 py-2">
                                </div>
                                <div>
                                    <label class="text-sm text-gray-400 mb-1 block">Container Name</label>
                                    <input type="text" id="azure-container" class="input-field w-full rounded-lg px-4 py-2">
                                </div>
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Authentication Method</label>
                                <select id="azure-auth-type" class="input-field w-full rounded-lg px-4 py-2" onchange="onAzureAuthChange()">
                                    <option value="connection_string">Connection String</option>
                                    <option value="account_key">Account Key</option>
                                    <option value="sas_token">SAS Token</option>
                                    <option value="service_principal">Service Principal</option>
                                    <option value="managed_identity">Managed Identity</option>
                                </select>
                            
                            </div>
                            <div id="azure-conn-string-field">
                                <label class="text-sm text-gray-400 mb-1 block">Connection String</label>
                                <textarea id="azure-conn-string" rows="2" class="input-field w-full rounded-lg px-4 py-2 font-mono text-xs"></textarea>
                            </div>
                            <div id="azure-sp-fields" class="hidden space-y-4">
                                <div class="grid md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="text-sm text-gray-400 mb-1 block">Tenant ID</label>
                                        <input type="text" id="azure-tenant" class="input-field w-full rounded-lg px-4 py-2">
                                    </div>
                                    <div>
                                        <label class="text-sm text-gray-400 mb-1 block">Client ID</label>
                                        <input type="text" id="azure-client" class="input-field w-full rounded-lg px-4 py-2">
                                    </div>
                                </div>
                                <div>
                                    <label class="text-sm text-gray-400 mb-1 block">Client Secret</label>
                                    <input type="password" id="azure-secret" class="input-field w-full rounded-lg px-4 py-2">
                                </div>
                            </div>
                        </div>
                        
                        <!-- GCS Fields -->
                        <div id="storage-gcs-fields" class="hidden mt-4 space-y-4">
                            <div class="grid md:grid-cols-2 gap-4">
                                <div>
                                    <label class="text-sm text-gray-400 mb-1 block">Project ID</label>
                                    <input type="text" id="gcs-project" class="input-field w-full rounded-lg px-4 py-2">
                                </div>
                                <div>
                                    <label class="text-sm text-gray-400 mb-1 block">Bucket Name</label>
                                    <input type="text" id="gcs-bucket" class="input-field w-full rounded-lg px-4 py-2">
                                </div>
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Service Account JSON</label>
                                <textarea id="gcs-credentials" rows="4" class="input-field w-full rounded-lg px-4 py-2 font-mono text-xs" placeholder="Paste service account JSON"></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Local/Network Storage Section -->
                    <div id="storage-local-section" class="hidden space-y-4">
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Storage Protocol</label>
                            <select id="local-storage-type" class="input-field w-full rounded-lg px-4 py-2" onchange="onLocalStorageTypeChange()">
                                <option value="local">Local Filesystem</option>
                                <option value="nfs">NFS (Network File System)</option>
                                <option value="smb">SMB/CIFS (Windows Share)</option>
                                <option value="sftp">SFTP</option>
                                <option value="ftp">FTP</option>
                                <option value="webdav">WebDAV</option>
                            </select>
                            
                        </div>
                        
                        <!-- Local Path -->
                        <div id="local-path-field">
                            <label class="text-sm text-gray-400 mb-1 block">Base Path</label>
                            <input type="text" id="local-path" class="input-field w-full rounded-lg px-4 py-2" placeholder="/data/storage or C:\Storage">
                        </div>
                        
                        <!-- Network Storage Fields -->
                        <div id="network-storage-fields" class="hidden space-y-4">
                            <div class="grid md:grid-cols-2 gap-4">
                                <div>
                                    <label class="text-sm text-gray-400 mb-1 block">Host / Server</label>
                                    <input type="text" id="net-host" class="input-field w-full rounded-lg px-4 py-2" placeholder="192.168.1.100 or server.local">
                                </div>
                                <div>
                                    <label class="text-sm text-gray-400 mb-1 block">Port</label>
                                    <input type="number" id="net-port" class="input-field w-full rounded-lg px-4 py-2" value="22">
                                </div>
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Share / Path</label>
                                <input type="text" id="net-share" class="input-field w-full rounded-lg px-4 py-2" placeholder="/share or \\server\share">
                            </div>
                            <div class="grid md:grid-cols-2 gap-4">
                                <div>
                                    <label class="text-sm text-gray-400 mb-1 block">Username</label>
                                    <input type="text" id="net-user" class="input-field w-full rounded-lg px-4 py-2">
                                </div>
                                <div>
                                    <label class="text-sm text-gray-400 mb-1 block">Password</label>
                                    <input type="password" id="net-pass" class="input-field w-full rounded-lg px-4 py-2">
                                </div>
                            </div>
                            <div id="sftp-key-field" class="hidden">
                                <label class="text-sm text-gray-400 mb-1 block">SSH Private Key (optional)</label>
                                <textarea id="sftp-key" rows="3" class="input-field w-full rounded-lg px-4 py-2 font-mono text-xs" placeholder="-----BEGIN OPENSSH PRIVATE KEY-----"></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Storage Options -->
                    <div class="border-t border-gray-700 pt-4 mt-4">
                        <p class="text-sm text-gray-400 mb-3">Storage Options</p>
                        <div class="flex flex-wrap gap-4">
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="storage-public" class="w-4 h-4">
                                <span class="text-sm">Public access</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="storage-versioning" class="w-4 h-4">
                                <span class="text-sm">Enable versioning</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="storage-encryption" class="w-4 h-4" checked>
                                <span class="text-sm">Server-side encryption</span>
                            </label>
                        </div>
                        <div class="grid md:grid-cols-2 gap-4 mt-3">
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Prefix / Folder</label>
                                <input type="text" id="storage-prefix" class="input-field w-full rounded-lg px-4 py-2" placeholder="uploads/">
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Max File Size (MB)</label>
                                <input type="number" id="storage-max-size" class="input-field w-full rounded-lg px-4 py-2" value="100">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Calendar Config -->
                <div id="cfg-calendar" class="hidden space-y-4">
                    <div>
                        <label class="text-sm text-gray-400 mb-1 block">Provider</label>
                        <select id="cal-provider" class="input-field w-full rounded-lg px-4 py-2">
                            <option value="google">Google Calendar</option>
                            <option value="outlook">Microsoft Outlook</option>
                            <option value="caldav">CalDAV</option>
                        </select>
                            
                    </div>
                    <div>
                        <label class="text-sm text-gray-400 mb-1 block">Calendar ID</label>
                        <input type="text" id="cal-id" class="input-field w-full rounded-lg px-4 py-2" placeholder="primary or specific calendar ID">
                    </div>
                    <div>
                        <label class="text-sm text-gray-400 mb-1 block">Service Account / API Key</label>
                        <textarea id="cal-creds" rows="3" class="input-field w-full rounded-lg px-4 py-2 font-mono text-xs" placeholder="Paste credentials JSON"></textarea>
                    </div>
                    <div class="flex gap-4">
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" id="cal-read" class="w-4 h-4" checked>
                            <span class="text-sm">Read events</span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" id="cal-write" class="w-4 h-4">
                            <span class="text-sm">Create/Edit events</span>
                        </label>
                    </div>
                </div>

                <!-- CRM Config -->
                <div id="cfg-crm" class="hidden space-y-4">
                    <div>
                        <label class="text-sm text-gray-400 mb-1 block">Platform</label>
                        <select id="crm-platform" class="input-field w-full rounded-lg px-4 py-2" onchange="onCRMChange()">
                            <option value="salesforce">Salesforce</option>
                            <option value="hubspot">HubSpot</option>
                            <option value="zoho">Zoho CRM</option>
                            <option value="pipedrive">Pipedrive</option>
                        </select>
                            
                    </div>
                    <div id="crm-salesforce-fields">
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Instance URL</label>
                                <input type="url" id="sf-url" class="input-field w-full rounded-lg px-4 py-2" placeholder="https://yourorg.salesforce.com">
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Consumer Key</label>
                                <input type="text" id="sf-key" class="input-field w-full rounded-lg px-4 py-2">
                            </div>
                        </div>
                        <div class="mt-3">
                            <label class="text-sm text-gray-400 mb-1 block">Consumer Secret</label>
                            <input type="password" id="sf-secret" class="input-field w-full rounded-lg px-4 py-2">
                        </div>
                    </div>
                    <div id="crm-hubspot-fields" class="hidden">
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">API Key / Access Token</label>
                            <input type="password" id="hs-key" class="input-field w-full rounded-lg px-4 py-2">
                        </div>
                    </div>
                    <div>
                        <label class="text-sm text-gray-400 mb-1 block">Objects to Access</label>
                        <div class="flex flex-wrap gap-3 mt-2">
                            <label class="flex items-center gap-2"><input type="checkbox" id="crm-contacts" checked> Contacts</label>
                            <label class="flex items-center gap-2"><input type="checkbox" id="crm-companies" checked> Companies</label>
                            <label class="flex items-center gap-2"><input type="checkbox" id="crm-deals"> Deals</label>
                            <label class="flex items-center gap-2"><input type="checkbox" id="crm-leads"> Leads</label>
                        </div>
                    </div>
                </div>

                <!-- ERP Config -->
                <div id="cfg-erp" class="hidden space-y-4">
                    <div>
                        <label class="text-sm text-gray-400 mb-1 block">Platform</label>
                        <select id="erp-platform" class="input-field w-full rounded-lg px-4 py-2">
                            <option value="sap">SAP</option>
                            <option value="oracle">Oracle ERP</option>
                            <option value="netsuite">NetSuite</option>
                            <option value="dynamics">Microsoft Dynamics</option>
                        </select>
                            
                    </div>
                    <div>
                        <label class="text-sm text-gray-400 mb-1 block">Server URL</label>
                        <input type="url" id="erp-url" class="input-field w-full rounded-lg px-4 py-2" placeholder="https://erp.company.com">
                    </div>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Username / Client ID</label>
                            <input type="text" id="erp-user" class="input-field w-full rounded-lg px-4 py-2">
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Password / Secret</label>
                            <input type="password" id="erp-pass" class="input-field w-full rounded-lg px-4 py-2">
                        </div>
                    </div>
                    <div class="bg-yellow-900/30 border border-yellow-600 rounded-lg p-3 text-sm">
                        <p class="text-yellow-300">‚ö†Ô∏è ERP integration requires additional setup. Contact your ERP administrator.</p>
                    </div>
                </div>

                <!-- Messaging (Slack/Teams) Config -->
                <div id="cfg-slack" class="hidden space-y-4">
                    <div>
                        <label class="text-sm text-gray-400 mb-1 block">Platform</label>
                        <select id="msg-platform" class="input-field w-full rounded-lg px-4 py-2" onchange="onMsgPlatformChange()">
                            <optgroup label="Business Messaging">
                                <option value="slack">Slack</option>
                                <option value="teams">Microsoft Teams</option>
                                <option value="discord">Discord</option>
                                <option value="mattermost">Mattermost</option>
                                <option value="rocket">Rocket.Chat</option>
                                <option value="google_chat">Google Chat</option>
                                <option value="webex">Cisco Webex</option>
                                <option value="zoom">Zoom Chat</option>
                            </optgroup>
                            <optgroup label="Consumer Messaging">
                                <option value="whatsapp">WhatsApp Business API</option>
                                <option value="facebook">Facebook Messenger</option>
                                <option value="instagram">Instagram Direct</option>
                                <option value="telegram">Telegram Bot</option>
                                <option value="viber">Viber</option>
                                <option value="line">LINE</option>
                                <option value="wechat">WeChat</option>
                            </optgroup>
                            <optgroup label="SMS / Voice">
                                <option value="twilio">Twilio SMS</option>
                                <option value="vonage">Vonage (Nexmo)</option>
                                <option value="plivo">Plivo</option>
                                <option value="messagebird">MessageBird</option>
                                <option value="sinch">Sinch</option>
                            </optgroup>
                            <optgroup label="Push Notifications">
                                <option value="firebase_fcm">Firebase Cloud Messaging</option>
                                <option value="onesignal">OneSignal</option>
                                <option value="pusher">Pusher</option>
                                <option value="apns">Apple Push Notifications</option>
                            </optgroup>
                        </select>
                            
                    </div>
                    
                    <!-- Slack Fields -->
                    <div id="msg-slack-fields" class="space-y-4">
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Bot Token</label>
                            <input type="password" id="slack-token" class="input-field w-full rounded-lg px-4 py-2" placeholder="xoxb-...">
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Default Channel</label>
                            <input type="text" id="slack-channel" class="input-field w-full rounded-lg px-4 py-2" placeholder="#general">
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Signing Secret (for webhooks)</label>
                            <input type="password" id="slack-signing" class="input-field w-full rounded-lg px-4 py-2">
                        </div>
                    </div>
                    
                    <!-- MS Teams Fields -->
                    <div id="msg-teams-fields" class="hidden space-y-4">
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Integration Type</label>
                            <select id="teams-type" class="input-field w-full rounded-lg px-4 py-2" onchange="onTeamsTypeChange()">
                                <option value="webhook">Incoming Webhook</option>
                                <option value="bot">Bot Framework</option>
                                <option value="graph">Microsoft Graph API</option>
                            </select>
                            
                        </div>
                        <div id="teams-webhook-field">
                            <label class="text-sm text-gray-400 mb-1 block">Webhook URL</label>
                            <input type="url" id="teams-webhook" class="input-field w-full rounded-lg px-4 py-2">
                        </div>
                        <div id="teams-bot-fields" class="hidden space-y-4">
                            <div class="grid md:grid-cols-2 gap-4">
                                <div>
                                    <label class="text-sm text-gray-400 mb-1 block">App ID</label>
                                    <input type="text" id="teams-app-id" class="input-field w-full rounded-lg px-4 py-2">
                                </div>
                                <div>
                                    <label class="text-sm text-gray-400 mb-1 block">App Password</label>
                                    <input type="password" id="teams-app-pass" class="input-field w-full rounded-lg px-4 py-2">
                                </div>
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Tenant ID</label>
                                <input type="text" id="teams-tenant" class="input-field w-full rounded-lg px-4 py-2">
                            </div>
                        </div>
                    </div>
                    
                    <!-- WhatsApp Fields -->
                    <div id="msg-whatsapp-fields" class="hidden space-y-4">
                        <div class="bg-green-500/10 border border-green-500/30 rounded-lg p-3 text-sm text-green-300 mb-2">
                            ‚ÑπÔ∏è WhatsApp Business API requires approval. You can use Meta Business Suite or a BSP like Twilio/MessageBird.
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Provider</label>
                            <select id="whatsapp-provider" class="input-field w-full rounded-lg px-4 py-2" onchange="onWhatsAppProviderChange()">
                                <option value="meta">Meta Cloud API (Direct)</option>
                                <option value="twilio">Twilio for WhatsApp</option>
                                <option value="messagebird">MessageBird</option>
                                <option value="360dialog">360dialog</option>
                                <option value="gupshup">Gupshup</option>
                            </select>
                            
                        </div>
                        <div id="whatsapp-meta-fields" class="space-y-4">
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Access Token</label>
                                <input type="password" id="whatsapp-token" class="input-field w-full rounded-lg px-4 py-2">
                            </div>
                            <div class="grid md:grid-cols-2 gap-4">
                                <div>
                                    <label class="text-sm text-gray-400 mb-1 block">Phone Number ID</label>
                                    <input type="text" id="whatsapp-phone-id" class="input-field w-full rounded-lg px-4 py-2">
                                </div>
                                <div>
                                    <label class="text-sm text-gray-400 mb-1 block">Business Account ID</label>
                                    <input type="text" id="whatsapp-business-id" class="input-field w-full rounded-lg px-4 py-2">
                                </div>
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Webhook Verify Token</label>
                                <input type="text" id="whatsapp-verify" class="input-field w-full rounded-lg px-4 py-2">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Facebook Messenger Fields -->
                    <div id="msg-facebook-fields" class="hidden space-y-4">
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Page Access Token</label>
                            <input type="password" id="fb-page-token" class="input-field w-full rounded-lg px-4 py-2">
                        </div>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">App ID</label>
                                <input type="text" id="fb-app-id" class="input-field w-full rounded-lg px-4 py-2">
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">App Secret</label>
                                <input type="password" id="fb-app-secret" class="input-field w-full rounded-lg px-4 py-2">
                            </div>
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Webhook Verify Token</label>
                            <input type="text" id="fb-verify" class="input-field w-full rounded-lg px-4 py-2">
                        </div>
                    </div>
                    
                    <!-- Telegram Fields -->
                    <div id="msg-telegram-fields" class="hidden space-y-4">
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Bot Token (from @BotFather)</label>
                            <input type="password" id="telegram-token" class="input-field w-full rounded-lg px-4 py-2" placeholder="123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11">
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Default Chat ID (optional)</label>
                            <input type="text" id="telegram-chat-id" class="input-field w-full rounded-lg px-4 py-2" placeholder="-1001234567890">
                        </div>
                        <div class="flex items-center gap-4">
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="telegram-webhook" class="w-4 h-4">
                                <span class="text-sm">Use Webhook (instead of polling)</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Twilio SMS Fields -->
                    <div id="msg-twilio-fields" class="hidden space-y-4">
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Account SID</label>
                                <input type="text" id="twilio-sid" class="input-field w-full rounded-lg px-4 py-2" placeholder="ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx">
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Auth Token</label>
                                <input type="password" id="twilio-token" class="input-field w-full rounded-lg px-4 py-2">
                            </div>
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Phone Number (From)</label>
                            <input type="tel" id="twilio-phone" class="input-field w-full rounded-lg px-4 py-2" placeholder="+1234567890">
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Messaging Service SID (optional)</label>
                            <input type="text" id="twilio-msg-sid" class="input-field w-full rounded-lg px-4 py-2" placeholder="MGxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx">
                        </div>
                    </div>
                    
                    <!-- Discord Fields -->
                    <div id="msg-discord-fields" class="hidden space-y-4">
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Bot Token</label>
                            <input type="password" id="discord-token" class="input-field w-full rounded-lg px-4 py-2">
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Default Channel ID</label>
                            <input type="text" id="discord-channel" class="input-field w-full rounded-lg px-4 py-2">
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Webhook URL (optional)</label>
                            <input type="url" id="discord-webhook" class="input-field w-full rounded-lg px-4 py-2">
                        </div>
                    </div>
                    
                    <!-- Firebase FCM Fields -->
                    <div id="msg-firebase-fields" class="hidden space-y-4">
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Service Account JSON</label>
                            <textarea id="fcm-credentials" rows="4" class="input-field w-full rounded-lg px-4 py-2 font-mono text-xs" placeholder="Paste Firebase service account JSON"></textarea>
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Default Topic (optional)</label>
                            <input type="text" id="fcm-topic" class="input-field w-full rounded-lg px-4 py-2" placeholder="all-users">
                        </div>
                    </div>
                    
                    <!-- Generic Webhook Fields (for other platforms) -->
                    <div id="msg-generic-fields" class="hidden space-y-4">
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">API Key / Token</label>
                            <input type="password" id="msg-api-key" class="input-field w-full rounded-lg px-4 py-2">
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">API Endpoint (if custom)</label>
                            <input type="url" id="msg-endpoint" class="input-field w-full rounded-lg px-4 py-2">
                        </div>
                    </div>
                    
                    <!-- Common Options -->
                    <div class="border-t border-gray-700 pt-4 mt-4">
                        <p class="text-sm text-gray-400 mb-3">Options</p>
                        <div class="flex flex-wrap gap-4">
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="msg-receive" class="w-4 h-4" checked>
                                <span class="text-sm">Receive messages</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="msg-send" class="w-4 h-4" checked>
                                <span class="text-sm">Send messages</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="msg-attachments" class="w-4 h-4">
                                <span class="text-sm">Support attachments</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Image Gen Config -->
                <div id="cfg-imagegen" class="hidden space-y-4">
                    <div>
                        <label class="text-sm text-gray-400 mb-1 block">Provider</label>
                        <select id="img-provider" class="input-field w-full rounded-lg px-4 py-2">
                            <option value="dalle">OpenAI DALL-E</option>
                            <option value="stability">Stability AI</option>
                            <option value="replicate">Replicate</option>
                        </select>
                            
                    </div>
                    <div>
                        <label class="text-sm text-gray-400 mb-1 block">API Key</label>
                        <input type="password" id="img-key" class="input-field w-full rounded-lg px-4 py-2">
                    </div>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Default Size</label>
                            <select id="img-size" class="input-field w-full rounded-lg px-4 py-2">
                                <option value="1024x1024">1024x1024</option>
                                <option value="1792x1024">1792x1024 (Wide)</option>
                                <option value="1024x1792">1024x1792 (Tall)</option>
                            </select>
                            
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Quality</label>
                            <select id="img-quality" class="input-field w-full rounded-lg px-4 py-2">
                                <option value="standard">Standard</option>
                                <option value="hd">HD</option>
                            </select>
                            
                        </div>
                    </div>
                </div>

                <!-- Speech to Text Config -->
                <div id="cfg-stt" class="hidden space-y-4">
                    <div>
                        <label class="text-sm text-gray-400 mb-1 block">Provider</label>
                        <select id="stt-provider" class="input-field w-full rounded-lg px-4 py-2" onchange="onSTTProviderChange()">
                            <optgroup label="Cloud Providers">
                                <option value="whisper">OpenAI Whisper</option>
                                <option value="azure">Azure Speech Services</option>
                                <option value="google">Google Speech-to-Text</option>
                                <option value="aws_transcribe">Amazon Transcribe</option>
                                <option value="oci_speech">Oracle OCI Speech</option>
                                <option value="ibm_watson">IBM Watson Speech to Text</option>
                                <option value="deepgram">Deepgram</option>
                                <option value="assemblyai">AssemblyAI</option>
                                <option value="rev">Rev AI</option>
                                <option value="speechmatics">Speechmatics</option>
                            </optgroup>
                            <optgroup label="On-Premise / Self-Hosted">
                                <option value="whisper_local">Whisper (Local/Self-hosted)</option>
                                <option value="vosk">Vosk (Offline)</option>
                                <option value="deepspeech">Mozilla DeepSpeech</option>
                                <option value="kaldi">Kaldi</option>
                                <option value="coqui">Coqui STT</option>
                            </optgroup>
                        </select>
                            
                    </div>
                    
                    <!-- Cloud API Fields -->
                    <div id="stt-cloud-fields" class="space-y-4">
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">API Key</label>
                            <input type="password" id="stt-key" class="input-field w-full rounded-lg px-4 py-2">
                        </div>
                        <div id="stt-region-field">
                            <label class="text-sm text-gray-400 mb-1 block">Region / Endpoint</label>
                            <input type="text" id="stt-region" class="input-field w-full rounded-lg px-4 py-2" placeholder="us-east-1 or endpoint URL">
                        </div>
                    </div>
                    
                    <!-- OCI Speech Fields -->
                    <div id="stt-oci-fields" class="hidden space-y-4">
                        <div class="bg-orange-500/10 border border-orange-500/30 rounded-lg p-3 text-sm text-orange-300 mb-2">
                            ‚ÑπÔ∏è OCI Speech supports real-time and batch transcription with Arabic, English, and other languages.
                        </div>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Compartment OCID</label>
                                <input type="text" id="stt-oci-compartment" class="input-field w-full rounded-lg px-4 py-2">
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Region</label>
                                <select id="stt-oci-region" class="input-field w-full rounded-lg px-4 py-2">
                                    <option value="us-ashburn-1">US East (Ashburn)</option>
                                    <option value="us-phoenix-1">US West (Phoenix)</option>
                                    <option value="eu-frankfurt-1">Germany (Frankfurt)</option>
                                    <option value="uk-london-1">UK (London)</option>
                                </select>
                            
                            </div>
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">OCI Config File or API Key</label>
                            <textarea id="stt-oci-config" rows="3" class="input-field w-full rounded-lg px-4 py-2 font-mono text-xs" placeholder="Paste OCI config or API key details"></textarea>
                        </div>
                    </div>
                    
                    <!-- Azure Speech Fields -->
                    <div id="stt-azure-fields" class="hidden space-y-4">
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Speech Key</label>
                                <input type="password" id="stt-azure-key" class="input-field w-full rounded-lg px-4 py-2">
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Service Region</label>
                                <input type="text" id="stt-azure-region" class="input-field w-full rounded-lg px-4 py-2" placeholder="eastus">
                            </div>
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Custom Endpoint (optional)</label>
                            <input type="url" id="stt-azure-endpoint" class="input-field w-full rounded-lg px-4 py-2" placeholder="For custom speech models">
                        </div>
                    </div>
                    
                    <!-- Self-hosted Fields -->
                    <div id="stt-local-fields" class="hidden space-y-4">
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Server URL</label>
                                <input type="url" id="stt-local-url" class="input-field w-full rounded-lg px-4 py-2" placeholder="http://localhost:8080">
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Model</label>
                                <select id="stt-local-model" class="input-field w-full rounded-lg px-4 py-2">
                                    <option value="tiny">Tiny (Fast, Less Accurate)</option>
                                    <option value="base">Base</option>
                                    <option value="small">Small</option>
                                    <option value="medium" selected>Medium (Balanced)</option>
                                    <option value="large">Large (Most Accurate)</option>
                                    <option value="large-v3">Large V3</option>
                                </select>
                            
                            </div>
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Model Path (for local files)</label>
                            <input type="text" id="stt-model-path" class="input-field w-full rounded-lg px-4 py-2" placeholder="/models/whisper-medium">
                        </div>
                    </div>
                    
                    <!-- Common Options -->
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Default Language</label>
                            <select id="stt-lang" class="input-field w-full rounded-lg px-4 py-2">
                                <option value="auto">Auto-detect</option>
                                <option value="en">English</option>
                                <option value="ar">Arabic</option>
                                <option value="es">Spanish</option>
                                <option value="fr">French</option>
                                <option value="de">German</option>
                                <option value="zh">Chinese</option>
                                <option value="ja">Japanese</option>
                                <option value="ko">Korean</option>
                                <option value="pt">Portuguese</option>
                                <option value="ru">Russian</option>
                                <option value="hi">Hindi</option>
                            </select>
                            
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Audio Format</label>
                            <select id="stt-format" class="input-field w-full rounded-lg px-4 py-2">
                                <option value="auto">Auto-detect</option>
                                <option value="wav">WAV</option>
                                <option value="mp3">MP3</option>
                                <option value="ogg">OGG</option>
                                <option value="flac">FLAC</option>
                                <option value="webm">WebM</option>
                            </select>
                            
                        </div>
                    </div>
                    <div class="flex flex-wrap gap-4">
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" id="stt-realtime" class="w-4 h-4">
                            <span class="text-sm">Real-time streaming</span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" id="stt-punctuation" class="w-4 h-4" checked>
                            <span class="text-sm">Auto punctuation</span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" id="stt-timestamps" class="w-4 h-4">
                            <span class="text-sm">Word timestamps</span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" id="stt-diarization" class="w-4 h-4">
                            <span class="text-sm">Speaker diarization</span>
                        </label>
                    </div>
                </div>

                <!-- Text to Speech Config -->
                <div id="cfg-tts" class="hidden space-y-4">
                    <div>
                        <label class="text-sm text-gray-400 mb-1 block">Provider</label>
                        <select id="tts-provider" class="input-field w-full rounded-lg px-4 py-2" onchange="onTTSProviderChange()">
                            <optgroup label="Cloud Providers">
                                <option value="elevenlabs">ElevenLabs</option>
                                <option value="openai">OpenAI TTS</option>
                                <option value="azure">Azure Speech Services</option>
                                <option value="google">Google Cloud Text-to-Speech</option>
                                <option value="aws_polly">Amazon Polly</option>
                                <option value="oci_speech">Oracle OCI Speech</option>
                                <option value="ibm_watson">IBM Watson Text to Speech</option>
                                <option value="murf">Murf AI</option>
                                <option value="play_ht">Play.ht</option>
                                <option value="resemble">Resemble AI</option>
                                <option value="wellsaid">WellSaid Labs</option>
                            </optgroup>
                            <optgroup label="On-Premise / Self-Hosted">
                                <option value="coqui_tts">Coqui TTS</option>
                                <option value="piper">Piper TTS</option>
                                <option value="espeak">eSpeak NG</option>
                                <option value="festival">Festival</option>
                                <option value="mimic">Mycroft Mimic</option>
                            </optgroup>
                        </select>
                            
                    </div>
                    
                    <!-- Cloud API Fields -->
                    <div id="tts-cloud-fields" class="space-y-4">
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">API Key</label>
                            <input type="password" id="tts-key" class="input-field w-full rounded-lg px-4 py-2">
                        </div>
                    </div>
                    
                    <!-- OCI TTS Fields -->
                    <div id="tts-oci-fields" class="hidden space-y-4">
                        <div class="bg-orange-500/10 border border-orange-500/30 rounded-lg p-3 text-sm text-orange-300 mb-2">
                            ‚ÑπÔ∏è OCI Speech supports multiple voices including Arabic neural voices.
                        </div>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Compartment OCID</label>
                                <input type="text" id="tts-oci-compartment" class="input-field w-full rounded-lg px-4 py-2">
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Region</label>
                                <select id="tts-oci-region" class="input-field w-full rounded-lg px-4 py-2">
                                    <option value="us-ashburn-1">US East (Ashburn)</option>
                                    <option value="us-phoenix-1">US West (Phoenix)</option>
                                    <option value="eu-frankfurt-1">Germany (Frankfurt)</option>
                                </select>
                            
                            </div>
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">OCI Config</label>
                            <textarea id="tts-oci-config" rows="3" class="input-field w-full rounded-lg px-4 py-2 font-mono text-xs" placeholder="Paste OCI config"></textarea>
                        </div>
                    </div>
                    
                    <!-- Self-hosted Fields -->
                    <div id="tts-local-fields" class="hidden space-y-4">
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Server URL</label>
                            <input type="url" id="tts-local-url" class="input-field w-full rounded-lg px-4 py-2" placeholder="http://localhost:5002">
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Model Path</label>
                            <input type="text" id="tts-model-path" class="input-field w-full rounded-lg px-4 py-2" placeholder="/models/tts-model">
                        </div>
                    </div>
                    
                    <!-- Voice Selection -->
                    <div>
                        <label class="text-sm text-gray-400 mb-1 block">Voice</label>
                        <select id="tts-voice" class="input-field w-full rounded-lg px-4 py-2">
                            <optgroup label="OpenAI Voices">
                                <option value="alloy">Alloy (Neutral)</option>
                                <option value="echo">Echo (Male)</option>
                                <option value="fable">Fable (British)</option>
                                <option value="onyx">Onyx (Deep Male)</option>
                                <option value="nova">Nova (Female)</option>
                                <option value="shimmer">Shimmer (Female)</option>
                            </optgroup>
                            <optgroup label="Azure Neural Voices">
                                <option value="en-US-JennyNeural">Jenny (US Female)</option>
                                <option value="en-US-GuyNeural">Guy (US Male)</option>
                                <option value="en-GB-SoniaNeural">Sonia (UK Female)</option>
                                <option value="ar-SA-ZariyahNeural">Zariyah (Arabic Female)</option>
                                <option value="ar-SA-HamedNeural">Hamed (Arabic Male)</option>
                            </optgroup>
                            <optgroup label="ElevenLabs">
                                <option value="rachel">Rachel</option>
                                <option value="drew">Drew</option>
                                <option value="clyde">Clyde</option>
                                <option value="paul">Paul</option>
                                <option value="domi">Domi</option>
                                <option value="dave">Dave</option>
                                <option value="fin">Fin</option>
                                <option value="sarah">Sarah</option>
                            </optgroup>
                        </select>
                            
                    </div>
                    
                    <!-- TTS Options -->
                    <div class="grid md:grid-cols-3 gap-4">
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Speed</label>
                            <input type="range" id="tts-speed" min="0.5" max="2" step="0.1" value="1" class="w-full">
                            <span class="text-xs text-gray-500" id="tts-speed-val">1.0x</span>
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Pitch</label>
                            <input type="range" id="tts-pitch" min="-20" max="20" step="1" value="0" class="w-full">
                            <span class="text-xs text-gray-500" id="tts-pitch-val">0</span>
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Output Format</label>
                            <select id="tts-format" class="input-field w-full rounded-lg px-4 py-2">
                                <option value="mp3">MP3</option>
                                <option value="wav">WAV</option>
                                <option value="ogg">OGG</option>
                                <option value="opus">Opus</option>
                            </select>
                            
                        </div>
                    </div>
                </div>

                <!-- Translation Config -->
                <div id="cfg-translate" class="hidden space-y-4">
                    <div>
                        <label class="text-sm text-gray-400 mb-1 block">Provider</label>
                        <select id="trans-provider" class="input-field w-full rounded-lg px-4 py-2">
                            <optgroup label="Cloud Providers">
                                <option value="deepl">DeepL</option>
                                <option value="google">Google Translate</option>
                                <option value="azure">Azure Translator</option>
                                <option value="aws_translate">Amazon Translate</option>
                                <option value="oci_language">Oracle OCI Language</option>
                                <option value="ibm_watson">IBM Watson Language Translator</option>
                                <option value="yandex">Yandex Translate</option>
                                <option value="papago">Naver Papago</option>
                            </optgroup>
                            <optgroup label="Self-Hosted">
                                <option value="libretranslate">LibreTranslate</option>
                                <option value="argos">Argos Translate</option>
                                <option value="opus_mt">Opus-MT (Hugging Face)</option>
                            </optgroup>
                        </select>
                            
                    </div>
                    <div>
                        <label class="text-sm text-gray-400 mb-1 block">API Key</label>
                        <input type="password" id="trans-key" class="input-field w-full rounded-lg px-4 py-2">
                    </div>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Source Language</label>
                            <select id="trans-source" class="input-field w-full rounded-lg px-4 py-2">
                                <option value="auto">Auto-detect</option>
                                <option value="en">English</option>
                                <option value="ar">Arabic</option>
                                <option value="es">Spanish</option>
                                <option value="fr">French</option>
                                <option value="de">German</option>
                                <option value="zh">Chinese</option>
                                <option value="ja">Japanese</option>
                                <option value="ko">Korean</option>
                                <option value="pt">Portuguese</option>
                                <option value="ru">Russian</option>
                            </select>
                            
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Target Language</label>
                            <select id="trans-target" class="input-field w-full rounded-lg px-4 py-2">
                                <option value="en">English</option>
                                <option value="ar">Arabic</option>
                                <option value="es">Spanish</option>
                                <option value="fr">French</option>
                                <option value="de">German</option>
                                <option value="zh">Chinese</option>
                                <option value="ja">Japanese</option>
                                <option value="ko">Korean</option>
                                <option value="pt">Portuguese</option>
                                <option value="ru">Russian</option>
                            </select>
                            
                        </div>
                    </div>
                </div>

                <!-- OCR / Vision Config -->
                <div id="cfg-ocr" class="hidden space-y-4">
                    <div>
                        <label class="text-sm text-gray-400 mb-1 block">Provider</label>
                        <select id="ocr-provider" class="input-field w-full rounded-lg px-4 py-2" onchange="onOCRProviderChange()">
                            <optgroup label="AI Vision (Multi-modal)">
                                <option value="gpt4v">OpenAI GPT-4 Vision</option>
                                <option value="claude_vision">Anthropic Claude Vision</option>
                                <option value="gemini_vision">Google Gemini Vision</option>
                            </optgroup>
                            <optgroup label="Cloud OCR Services">
                                <option value="azure_vision">Azure Computer Vision</option>
                                <option value="azure_doc">Azure Document Intelligence</option>
                                <option value="google_vision">Google Cloud Vision</option>
                                <option value="google_doc_ai">Google Document AI</option>
                                <option value="aws_textract">Amazon Textract</option>
                                <option value="aws_rekognition">Amazon Rekognition</option>
                                <option value="oci_vision">Oracle OCI Vision</option>
                                <option value="oci_doc">Oracle OCI Document Understanding</option>
                                <option value="ibm_watson">IBM Watson Visual Recognition</option>
                            </optgroup>
                            <optgroup label="Specialized OCR">
                                <option value="abbyy">ABBYY Cloud OCR</option>
                                <option value="nanonets">Nanonets</option>
                                <option value="docparser">Docparser</option>
                                <option value="rossum">Rossum</option>
                                <option value="veryfi">Veryfi (Receipts/Invoices)</option>
                                <option value="mindee">Mindee</option>
                            </optgroup>
                            <optgroup label="On-Premise / Self-Hosted">
                                <option value="tesseract">Tesseract OCR</option>
                                <option value="paddleocr">PaddleOCR</option>
                                <option value="easyocr">EasyOCR</option>
                                <option value="doctr">docTR</option>
                                <option value="surya">Surya OCR</option>
                            </optgroup>
                        </select>
                            
                    </div>
                    
                    <!-- Cloud API Fields -->
                    <div id="ocr-cloud-fields" class="space-y-4">
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">API Key</label>
                            <input type="password" id="ocr-key" class="input-field w-full rounded-lg px-4 py-2">
                        </div>
                        <div id="ocr-endpoint-field">
                            <label class="text-sm text-gray-400 mb-1 block">Endpoint / Region</label>
                            <input type="text" id="ocr-endpoint" class="input-field w-full rounded-lg px-4 py-2" placeholder="https://... or region name">
                        </div>
                    </div>
                    
                    <!-- OCI Vision Fields -->
                    <div id="ocr-oci-fields" class="hidden space-y-4">
                        <div class="bg-orange-500/10 border border-orange-500/30 rounded-lg p-3 text-sm text-orange-300 mb-2">
                            ‚ÑπÔ∏è OCI Vision supports document analysis, text detection, image classification, and object detection.
                        </div>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Compartment OCID</label>
                                <input type="text" id="ocr-oci-compartment" class="input-field w-full rounded-lg px-4 py-2">
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Region</label>
                                <select id="ocr-oci-region" class="input-field w-full rounded-lg px-4 py-2">
                                    <option value="us-ashburn-1">US East (Ashburn)</option>
                                    <option value="us-phoenix-1">US West (Phoenix)</option>
                                    <option value="eu-frankfurt-1">Germany (Frankfurt)</option>
                                    <option value="uk-london-1">UK (London)</option>
                                    <option value="ap-tokyo-1">Japan (Tokyo)</option>
                                </select>
                            
                            </div>
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">OCI Config</label>
                            <textarea id="ocr-oci-config" rows="3" class="input-field w-full rounded-lg px-4 py-2 font-mono text-xs" placeholder="Paste OCI config"></textarea>
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Model (optional)</label>
                            <input type="text" id="ocr-oci-model" class="input-field w-full rounded-lg px-4 py-2" placeholder="Custom model OCID">
                        </div>
                    </div>
                    
                    <!-- Self-hosted Fields -->
                    <div id="ocr-local-fields" class="hidden space-y-4">
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Server URL (if remote)</label>
                            <input type="url" id="ocr-local-url" class="input-field w-full rounded-lg px-4 py-2" placeholder="http://localhost:8000 (leave empty for local)">
                        </div>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Language(s)</label>
                                <input type="text" id="ocr-langs" class="input-field w-full rounded-lg px-4 py-2" placeholder="eng+ara (Tesseract format)">
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Tessdata Path</label>
                                <input type="text" id="ocr-tessdata" class="input-field w-full rounded-lg px-4 py-2" placeholder="/usr/share/tesseract-ocr/tessdata">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Capabilities -->
                    <div>
                        <label class="text-sm text-gray-400 mb-3 block">Capabilities</label>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="ocr-text" class="w-4 h-4" checked>
                                <span class="text-sm">Text extraction</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="ocr-tables" class="w-4 h-4">
                                <span class="text-sm">Table extraction</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="ocr-forms" class="w-4 h-4">
                                <span class="text-sm">Form fields</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="ocr-handwriting" class="w-4 h-4">
                                <span class="text-sm">Handwriting</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="ocr-labels" class="w-4 h-4">
                                <span class="text-sm">Label detection</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="ocr-faces" class="w-4 h-4">
                                <span class="text-sm">Face detection</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="ocr-objects" class="w-4 h-4">
                                <span class="text-sm">Object detection</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="ocr-barcode" class="w-4 h-4">
                                <span class="text-sm">Barcode/QR</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="ocr-pdf" class="w-4 h-4">
                                <span class="text-sm">PDF processing</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Document Types -->
                    <div>
                        <label class="text-sm text-gray-400 mb-1 block">Specialized Document Type (optional)</label>
                        <select id="ocr-doc-type" class="input-field w-full rounded-lg px-4 py-2">
                            <option value="general">General / Any</option>
                            <option value="invoice">Invoice</option>
                            <option value="receipt">Receipt</option>
                            <option value="id_card">ID Card / Passport</option>
                            <option value="business_card">Business Card</option>
                            <option value="bank_statement">Bank Statement</option>
                            <option value="medical">Medical Document</option>
                            <option value="contract">Contract / Legal</option>
                        </select>
                            
                    </div>
                </div>

                <!-- Simple tools (no config) -->
                <div id="cfg-simple" class="hidden">
                    <div class="text-center p-8 text-gray-400">
                        <span class="text-4xl block mb-3">‚úì</span>
                        <p>This tool requires no additional configuration.</p>
                        <p class="text-sm mt-2">Click Next to continue.</p>
                    </div>
                </div>
                
                <!-- Tool Access Control Section -->
                <div id="tool-access-control" class="mt-6 rounded-xl overflow-hidden" style="background: linear-gradient(145deg, rgba(139, 92, 246, 0.08) 0%, rgba(59, 130, 246, 0.05) 100%); border: 1px solid rgba(139, 92, 246, 0.2);">
                    <div class="p-4 border-b border-purple-500/20" style="background: linear-gradient(90deg, rgba(139, 92, 246, 0.15) 0%, transparent 100%);">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-lg flex items-center justify-center" style="background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);">
                                <span class="text-white">üîê</span>
                            </div>
                            <div>
                                <h5 class="font-semibold text-white">Access Control</h5>
                                <p class="text-xs text-gray-400">Who can view and use this tool</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="p-4 space-y-4">
                        <!-- Access Type Selection -->
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                            <!-- Owner Only -->
                            <div class="tool-access-card cursor-pointer rounded-lg p-3 border-2 border-purple-500 bg-purple-500/10" 
                                 data-access="owner_only" onclick="selectToolAccessType('owner_only')">
                                <div class="flex items-center gap-2 mb-1">
                                    <span>üë§</span>
                                    <span class="font-medium text-sm">Owner Only</span>
                                </div>
                                <p class="text-xs text-gray-400">Only you can access</p>
                                <div class="tool-access-check mt-2 text-purple-400 text-xs">‚úì Selected</div>
                            </div>
                            
                            <!-- Authenticated -->
                            <div class="tool-access-card cursor-pointer rounded-lg p-3 border-2 border-gray-600 hover:border-blue-500 transition" 
                                 data-access="authenticated" onclick="selectToolAccessType('authenticated')">
                                <div class="flex items-center gap-2 mb-1">
                                    <span>üîë</span>
                                    <span class="font-medium text-sm">Logged In</span>
                                </div>
                                <p class="text-xs text-gray-400">Any logged-in user</p>
                                <div class="tool-access-check hidden mt-2 text-blue-400 text-xs">‚úì Selected</div>
                            </div>
                            
                            <!-- Specific Users -->
                            <div class="tool-access-card cursor-pointer rounded-lg p-3 border-2 border-gray-600 hover:border-yellow-500 transition" 
                                 data-access="specific_users" onclick="selectToolAccessType('specific_users')">
                                <div class="flex items-center gap-2 mb-1">
                                    <span>üë•</span>
                                    <span class="font-medium text-sm">Specific Users</span>
                                </div>
                                <p class="text-xs text-gray-400">Choose who can access</p>
                                <div class="tool-access-check hidden mt-2 text-yellow-400 text-xs">‚úì Selected</div>
                            </div>
                            
                            <!-- Public -->
                            <div class="tool-access-card cursor-pointer rounded-lg p-3 border-2 border-gray-600 hover:border-green-500 transition" 
                                 data-access="public" onclick="selectToolAccessType('public')">
                                <div class="flex items-center gap-2 mb-1">
                                    <span>üåê</span>
                                    <span class="font-medium text-sm">Public</span>
                                </div>
                                <p class="text-xs text-gray-400">Everyone can access</p>
                                <div class="tool-access-check hidden mt-2 text-green-400 text-xs">‚úì Selected</div>
                            </div>
                        </div>
                        
                        <!-- Specific Users/Groups Selection (shown when specific_users selected) -->
                        <div id="tool-specific-access-config" class="hidden space-y-4 pt-4 border-t border-gray-700">
                            <!-- Smart Search -->
                            <div>
                                <label class="text-sm mb-2 block" style="color: #374151; font-weight: 500;">üîç Search Users & Groups</label>
                                <input type="text" id="tool-access-search" 
                                       class="w-full rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-500" 
                                       style="background: #f9fafb; color: #1f2937; border: 1px solid #d1d5db;"
                                       placeholder="Type to search users or groups..."
                                       oninput="filterToolAccessSearch(this.value)"
                                       onfocus="showToolAccessResults()"
                                       autocomplete="off">
                            </div>
                            
                            <!-- Search Results Dropdown -->
                            <div id="tool-access-search-results" class="hidden rounded-xl overflow-hidden max-h-48 overflow-y-auto shadow-lg" style="background: #ffffff; border: 1px solid #d1d5db;">
                                <!-- Results will be populated dynamically -->
                            </div>
                            
                            <!-- Selected Users/Groups Chips -->
                            <div>
                                <label class="text-sm mb-2 block flex items-center gap-2" style="color: #374151; font-weight: 500;">
                                    <span>üë•</span> Selected Users & Groups
                                    <span id="tool-access-count" class="text-xs px-2 py-0.5 rounded-full" style="background: #7c3aed; color: white;">0</span>
                                </label>
                                <div id="tool-access-selected-chips" class="flex flex-wrap gap-2 min-h-[50px] p-3 rounded-xl" style="background: #f3f4f6; border: 1px dashed #d1d5db;">
                                    <div id="tool-no-selection-msg" class="text-sm italic" style="color: #6b7280;">Click on users or groups from search to add them</div>
                                </div>
                            </div>
                            
                            <!-- Hidden selects for form data compatibility -->
                            <select id="tool-allowed-users" class="hidden" multiple></select>
                            <select id="tool-allowed-groups" class="hidden" multiple></select>
                            
                            <!-- Granular Permissions -->
                            <div class="rounded-xl p-4" style="background: #f3f4f6; border: 1px solid #e5e7eb;">
                                <h6 class="text-sm font-medium mb-3 flex items-center gap-2" style="color: #1f2937;">
                                    <span>üîê</span> Granular Permissions 
                                    <span class="text-xs font-normal" style="color: #6b7280;">(Optional)</span>
                                </h6>
                                <p class="text-xs mb-3 p-2 rounded" style="background: #e5e7eb; color: #374151;">
                                    üí° <strong>Tip:</strong> By default, selected users/groups can <strong>view + execute</strong>. 
                                    Use the options below to grant <strong>edit or delete</strong> permissions to specific users or entire groups.
                                </p>
                                <div id="granular-permissions-empty" class="hidden text-center py-4 text-sm" style="color: #6b7280;">
                                    No users or groups selected above. Add them first to set granular permissions.
                                </div>
                                <div id="granular-permissions-grid" class="grid md:grid-cols-3 gap-4">
                                    <!-- Can Edit -->
                                    <div>
                                        <label class="text-xs block mb-2 flex items-center gap-1" style="color: #374151; font-weight: 600;">
                                            <span>‚úèÔ∏è</span> Can Edit
                                        </label>
                                        <div id="tool-can-edit-chips" class="flex flex-wrap gap-1 min-h-[36px] p-2 rounded-lg mb-2" style="background: #e5e7eb; border: 1px solid #d1d5db;">
                                        </div>
                                        <select id="tool-can-edit-users" class="w-full rounded px-2 py-1.5 text-sm" 
                                            style="background: #f3f4f6; border: 1px solid #d1d5db; color: #1f2937;"
                                            onchange="addToolPermissionChip('edit', this)">
                                            <option value="">+ Add user/group</option>
                                        </select>
                                    </div>
                                    <!-- Can Delete -->
                                    <div>
                                        <label class="text-xs block mb-2 flex items-center gap-1" style="color: #374151; font-weight: 600;">
                                            <span>üóëÔ∏è</span> Can Delete
                                        </label>
                                        <div id="tool-can-delete-chips" class="flex flex-wrap gap-1 min-h-[36px] p-2 rounded-lg mb-2" style="background: #e5e7eb; border: 1px solid #d1d5db;">
                                        </div>
                                        <select id="tool-can-delete-users" class="w-full rounded px-2 py-1.5 text-sm"
                                            style="background: #f3f4f6; border: 1px solid #d1d5db; color: #1f2937;"
                                            onchange="addToolPermissionChip('delete', this)">
                                            <option value="">+ Add user/group</option>
                                        </select>
                                    </div>
                                    <!-- Can Execute -->
                                    <div>
                                        <label class="text-xs block mb-2 flex items-center gap-1" style="color: #374151; font-weight: 600;">
                                            <span>üöÄ</span> Can Use in Agents
                                        </label>
                                        <div id="tool-can-execute-chips" class="flex flex-wrap gap-1 min-h-[36px] p-2 rounded-lg mb-2" style="background: #e5e7eb; border: 1px solid #d1d5db;">
                                        </div>
                                        <select id="tool-can-execute-users" class="w-full rounded px-2 py-1.5 text-sm"
                                            style="background: #f3f4f6; border: 1px solid #d1d5db; color: #1f2937;"
                                            onchange="addToolPermissionChip('execute', this)">
                                            <option value="">+ Add user/group</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 3: Add Sources (for data tools) -->
            <div id="wiz-step-3" class="hidden space-y-4">
                <div class="flex items-center gap-3 p-3 rounded-lg step-header-box">
                    <span class="text-2xl">üìÅ</span>
                    <div>
                        <h4 class="font-semibold">Add Sources</h4>
                        <p class="text-xs text-gray-400">Step 3 of 4: Add content to your knowledge base</p>
                    </div>
                </div>

                <!-- Source Tabs -->
                <div id="source-tabs" class="flex flex-wrap gap-2 border-b border-gray-700">
                    <button onclick="setSourceTab('docs')" id="tab-docs" class="px-4 py-2 text-sm border-b-2 border-purple-500 text-white">üìÑ Files</button>
                    <button onclick="setSourceTab('urls')" id="tab-urls" class="px-4 py-2 text-sm border-b-2 border-transparent text-gray-400 hover:text-white">üåê URLs</button>
                    <button onclick="setSourceTab('text')" id="tab-text" class="px-4 py-2 text-sm border-b-2 border-transparent text-gray-400 hover:text-white">‚úçÔ∏è Text</button>
                    <button onclick="setSourceTab('table')" id="tab-table" class="px-4 py-2 text-sm border-b-2 border-transparent text-gray-400 hover:text-white">üìä Table</button>
                </div>

                <!-- Documents Upload -->
                <div id="sources-docs" class="space-y-4">
                    <div class="drop-zone rounded-lg p-8 text-center cursor-pointer border-2 border-dashed border-gray-600 hover:border-purple-500 transition" onclick="document.getElementById('wiz-files').click()">
                        <input type="file" id="wiz-files" class="hidden" multiple onchange="handleWizFiles(event)">
                        <span class="text-4xl block mb-2">üì§</span>
                        <p class="text-gray-400">Drop files or click to browse</p>
                        <p class="text-xs text-gray-500 mt-1">PDF, Word, Excel, PowerPoint, Text, CSV</p>
                    </div>
                    <div id="wiz-files-list" class="space-y-2 max-h-48 overflow-y-auto"></div>
                </div>

                <!-- URL Input -->
                <div id="sources-urls" class="hidden space-y-4">
                    <div class="flex gap-2">
                        <input type="url" id="wiz-url-input" class="input-field flex-1 rounded-lg px-4 py-2" placeholder="https://example.com/page">
                        <button onclick="addWizUrl()" class="btn-primary px-4 py-2 rounded-lg">Add</button>
                    </div>
                    <div id="wiz-urls-list" class="space-y-2 max-h-48 overflow-y-auto"></div>
                </div>

                <!-- Text Entry -->
                <div id="sources-text" class="hidden space-y-4">
                    <div class="space-y-3">
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Entry Title</label>
                            <input type="text" id="wiz-text-title" class="input-field w-full rounded-lg px-4 py-2" placeholder="e.g., Company Policy, FAQ">
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Content</label>
                            <textarea id="wiz-text-content" class="input-field w-full rounded-lg px-4 py-3 font-mono text-sm" rows="6" placeholder="Enter text content that the agent can search..."></textarea>
                        </div>
                        <button onclick="addWizTextEntry()" class="btn-secondary w-full py-2 rounded-lg">‚ûï Add Text Entry</button>
                    </div>
                    <div id="wiz-text-list" class="space-y-2 max-h-48 overflow-y-auto"></div>
                </div>

                <!-- Table Entry -->
                <div id="sources-table" class="hidden space-y-4">
                    <div class="space-y-3">
                        <div class="flex gap-3">
                            <div class="flex-1">
                                <label class="text-sm text-gray-400 mb-1 block">Table Name</label>
                                <input type="text" id="wiz-table-name" class="input-field w-full rounded-lg px-4 py-2" placeholder="e.g., Employee Directory">
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Import</label>
                                <input type="file" id="wiz-table-file" class="hidden" accept=".csv,.xlsx,.xls" onchange="importWizTableFile(event)">
                                <button onclick="document.getElementById('wiz-table-file').click()" class="btn-secondary px-4 py-2 rounded-lg h-[42px]">üìÅ CSV/Excel</button>
                            </div>
                        </div>
                        <div class="flex gap-4 items-center">
                            <div class="flex items-center gap-2">
                                <label class="text-sm text-gray-400">Columns:</label>
                                <button onclick="changeWizTableCols(-1)" class="btn-secondary w-8 h-8 rounded">-</button>
                                <span id="wiz-col-count" class="w-8 text-center">3</span>
                                <button onclick="changeWizTableCols(1)" class="btn-secondary w-8 h-8 rounded">+</button>
                            </div>
                            <div class="flex items-center gap-2">
                                <label class="text-sm text-gray-400">Rows:</label>
                                <button onclick="changeWizTableRows(-1)" class="btn-secondary w-8 h-8 rounded">-</button>
                                <span id="wiz-row-count" class="w-8 text-center">2</span>
                                <button onclick="changeWizTableRows(1)" class="btn-secondary w-8 h-8 rounded">+</button>
                            </div>
                        </div>
                        <div class="overflow-x-auto max-h-48">
                            <div id="wiz-table-editor"></div>
                        </div>
                        <button onclick="addWizTableEntry()" class="btn-secondary w-full py-2 rounded-lg">‚ûï Add Table</button>
                    </div>
                    <div id="wiz-table-list" class="space-y-2 max-h-32 overflow-y-auto"></div>
                </div>

                <div class="bg-blue-900/30 border border-blue-600/50 rounded-lg p-3 text-sm">
                    <p class="text-blue-300">üí° You can skip this step and add sources later from the tool detail page.</p>
                </div>
            </div>

            <!-- Step 4: Test & Create/Update -->
            <div id="wiz-step-4" class="hidden space-y-4">
                <div class="flex items-center gap-3 p-3 rounded-lg border border-green-700 bg-green-900/20">
                    <span class="text-2xl">üß™</span>
                    <div>
                        <h4 class="font-semibold" id="step4-title">Test & Create</h4>
                        <p class="text-xs text-gray-400" id="step4-subtitle">Verify and finish</p>
                    </div>
                </div>

                <!-- Summary -->
                <div class="card rounded-lg p-4">
                    <h5 class="font-medium mb-3">üìã Summary</h5>
                    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-3 text-sm">
                        <div><span class="text-gray-400">Type:</span> <span id="sum-type" class="ml-2">-</span></div>
                        <div><span class="text-gray-400">Name:</span> <span id="sum-name" class="ml-2 font-medium">-</span></div>
                        <div><span class="text-gray-400">üìÑ Files:</span> <span id="sum-docs" class="ml-2">0</span></div>
                        <div><span class="text-gray-400">üåê URLs:</span> <span id="sum-urls" class="ml-2">0</span></div>
                        <div><span class="text-gray-400">‚úçÔ∏è Text:</span> <span id="sum-text" class="ml-2">0</span></div>
                        <div><span class="text-gray-400">üìä Tables:</span> <span id="sum-tables" class="ml-2">0</span></div>
                    </div>
                </div>

                <!-- Test Section -->
                <div class="card rounded-lg p-4">
                    <h5 class="font-medium mb-3">üß™ Test Tool (Optional)</h5>
                    <p class="text-xs text-gray-400 mb-3">Verify that your configuration works correctly before saving.</p>
                    <button onclick="testWizTool()" class="btn-secondary w-full py-2 rounded-lg mb-3">‚ñ∂ Run Test</button>
                    <div id="wiz-test-result" class="hidden p-3 rounded-lg text-sm max-h-48 overflow-y-auto"></div>
                </div>

                <div class="bg-green-900/30 border border-green-600/50 rounded-lg p-3 text-sm" id="step4-ready-msg">
                    <p class="text-green-300">‚úÖ Ready! Click the button below to finish.</p>
                </div>
            </div>

            <!-- Step 5: Access Control (Standalone Step) -->
            <div id="wiz-step-5" class="hidden space-y-4">
                <div class="flex items-center gap-3 p-3 rounded-lg step-header-box">
                    <span class="text-2xl">üîê</span>
                    <div>
                        <h4 class="font-semibold">Access Control</h4>
                        <p class="text-xs text-gray-400">Who can view and use this tool</p>
                    </div>
                </div>
                
                <!-- Access Type Selection -->
                <div class="card rounded-lg p-4">
                    <h5 class="font-medium mb-3">üîì Access Level</h5>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                        <!-- Owner Only -->
                        <div class="access-step-card cursor-pointer rounded-lg p-3 border-2 border-purple-500 bg-purple-500/10" 
                             data-access="owner_only" onclick="selectToolAccessType('owner_only')">
                            <div class="flex items-center gap-2 mb-1">
                                <span>üë§</span>
                                <span class="font-medium text-sm">Owner Only</span>
                            </div>
                            <p class="text-xs text-gray-400">Only you can access</p>
                            <div class="access-step-check mt-2 text-purple-400 text-xs">‚úì Selected</div>
                        </div>
                        
                        <!-- Authenticated -->
                        <div class="access-step-card cursor-pointer rounded-lg p-3 border-2 border-gray-600 hover:border-blue-500 transition" 
                             data-access="authenticated" onclick="selectToolAccessType('authenticated')">
                            <div class="flex items-center gap-2 mb-1">
                                <span>üîë</span>
                                <span class="font-medium text-sm">Logged In</span>
                            </div>
                            <p class="text-xs text-gray-400">Any logged-in user</p>
                            <div class="access-step-check hidden mt-2 text-blue-400 text-xs">‚úì Selected</div>
                        </div>
                        
                        <!-- Specific Users -->
                        <div class="access-step-card cursor-pointer rounded-lg p-3 border-2 border-gray-600 hover:border-yellow-500 transition" 
                             data-access="specific_users" onclick="selectToolAccessType('specific_users')">
                            <div class="flex items-center gap-2 mb-1">
                                <span>üë•</span>
                                <span class="font-medium text-sm">Specific Users</span>
                            </div>
                            <p class="text-xs text-gray-400">Choose who can access</p>
                            <div class="access-step-check hidden mt-2 text-yellow-400 text-xs">‚úì Selected</div>
                        </div>
                        
                        <!-- Public -->
                        <div class="access-step-card cursor-pointer rounded-lg p-3 border-2 border-gray-600 hover:border-green-500 transition" 
                             data-access="public" onclick="selectToolAccessType('public')">
                            <div class="flex items-center gap-2 mb-1">
                                <span>üåê</span>
                                <span class="font-medium text-sm">Public</span>
                            </div>
                            <p class="text-xs text-gray-400">Everyone can access</p>
                            <div class="access-step-check hidden mt-2 text-green-400 text-xs">‚úì Selected</div>
                        </div>
                    </div>
                </div>
                
                <!-- Specific Users/Groups Selection (shown when specific_users selected) -->
                <div id="access-step-specific-config" class="hidden card rounded-lg p-4 space-y-4">
                    <h5 class="font-medium mb-3">üë• Select Users & Groups</h5>
                    <!-- Smart Search -->
                    <div>
                        <label class="text-sm mb-2 block text-gray-400">üîç Search Users & Groups</label>
                        <input type="text" id="access-step-search" 
                               class="input-field w-full rounded-lg px-4 py-3" 
                               placeholder="Type to search users or groups..."
                               oninput="filterAccessStepSearch(this.value)"
                               onfocus="showAccessStepResults()"
                               autocomplete="off">
                    </div>
                    
                    <!-- Search Results Dropdown -->
                    <div id="access-step-search-results" class="hidden rounded-lg overflow-hidden max-h-48 overflow-y-auto border border-gray-600">
                        <!-- Results will be populated dynamically -->
                    </div>
                    
                    <!-- Selected Users/Groups Chips -->
                    <div>
                        <label class="text-sm mb-2 block flex items-center gap-2 text-gray-400">
                            <span>üë•</span> Selected Users & Groups
                            <span id="access-step-count" class="text-xs px-2 py-0.5 rounded-full bg-purple-600 text-white">0</span>
                        </label>
                        <div id="access-step-selected-chips" class="flex flex-wrap gap-2 min-h-[50px] p-3 rounded-lg border border-dashed border-gray-600 bg-gray-800/50">
                            <div id="access-step-no-selection" class="text-sm italic text-gray-500">Click on users or groups from search to add them</div>
                        </div>
                    </div>
                    
                    <!-- Granular Permissions -->
                    <div class="rounded-lg p-4 bg-gray-800/50 border border-gray-700">
                        <h6 class="text-sm font-medium mb-3 flex items-center gap-2 text-white">
                            <span>üîê</span> Granular Permissions 
                            <span class="text-xs font-normal text-gray-400">(Optional)</span>
                        </h6>
                        <p class="text-xs mb-3 p-2 rounded bg-blue-900/30 text-blue-300 border border-blue-700/50">
                            üí° By default, selected users/groups can <strong>view + execute</strong>. 
                            Use the options below to grant <strong>edit or delete</strong> permissions.
                        </p>
                        <div class="grid md:grid-cols-3 gap-4">
                            <!-- Can Edit -->
                            <div>
                                <label class="text-xs block mb-2 flex items-center gap-1 text-gray-300 font-medium">
                                    <span>‚úèÔ∏è</span> Can Edit
                                </label>
                                <div id="access-step-edit-chips" class="flex flex-wrap gap-1 min-h-[36px] p-2 rounded-lg mb-2 bg-gray-700 border border-gray-600">
                                </div>
                                <select id="access-step-edit-select" class="input-field w-full rounded px-2 py-1.5 text-sm"
                                    onchange="addAccessStepPermChip('edit', this)">
                                    <option value="">+ Add user/group</option>
                                </select>
                            </div>
                            <!-- Can Delete -->
                            <div>
                                <label class="text-xs block mb-2 flex items-center gap-1 text-gray-300 font-medium">
                                    <span>üóëÔ∏è</span> Can Delete
                                </label>
                                <div id="access-step-delete-chips" class="flex flex-wrap gap-1 min-h-[36px] p-2 rounded-lg mb-2 bg-gray-700 border border-gray-600">
                                </div>
                                <select id="access-step-delete-select" class="input-field w-full rounded px-2 py-1.5 text-sm"
                                    onchange="addAccessStepPermChip('delete', this)">
                                    <option value="">+ Add user/group</option>
                                </select>
                            </div>
                            <!-- Can Execute -->
                            <div>
                                <label class="text-xs block mb-2 flex items-center gap-1 text-gray-300 font-medium">
                                    <span>üöÄ</span> Can Use in Agents
                                </label>
                                <div id="access-step-execute-chips" class="flex flex-wrap gap-1 min-h-[36px] p-2 rounded-lg mb-2 bg-gray-700 border border-gray-600">
                                </div>
                                <select id="access-step-execute-select" class="input-field w-full rounded px-2 py-1.5 text-sm"
                                    onchange="addAccessStepPermChip('execute', this)">
                                    <option value="">+ Add user/group</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-blue-900/30 border border-blue-600/50 rounded-lg p-3 text-sm">
                    <p class="text-blue-300">üí° You can change access control settings anytime from the tool settings.</p>
                </div>
            </div>

            <!-- Step 6: Review & Create -->
            <div id="wiz-step-6" class="hidden space-y-4">
                <div class="flex items-center gap-3 p-3 rounded-lg border border-green-700 bg-green-900/20">
                    <span class="text-2xl">üìã</span>
                    <div>
                        <h4 class="font-semibold" id="step6-title">Review & Create</h4>
                        <p class="text-xs text-gray-400" id="step6-subtitle">Review your configuration before creating</p>
                    </div>
                </div>

                <!-- Configuration Summary -->
                <div class="card rounded-lg p-4">
                    <h5 class="font-medium mb-4">‚öôÔ∏è Configuration Summary</h5>
                    <div class="space-y-3 text-sm">
                        <div class="grid grid-cols-3 gap-2 items-center">
                            <span class="text-gray-400">Type:</span>
                            <span id="review-type" class="col-span-2 font-medium">-</span>
                        </div>
                        <div class="grid grid-cols-3 gap-2 items-center">
                            <span class="text-gray-400">Name:</span>
                            <span id="review-name" class="col-span-2 font-medium">-</span>
                        </div>
                        <div class="grid grid-cols-3 gap-2 items-start">
                            <span class="text-gray-400">Description:</span>
                            <span id="review-desc" class="col-span-2 text-gray-300">-</span>
                        </div>
                        <div id="review-config-details" class="pt-2 border-t border-gray-700 space-y-2">
                            <!-- Dynamic config details based on tool type -->
                        </div>
                    </div>
                </div>

                <!-- Access Control Summary -->
                <div class="card rounded-lg p-4">
                    <h5 class="font-medium mb-4">üîê Access Control Summary</h5>
                    <div class="space-y-3 text-sm">
                        <div class="grid grid-cols-3 gap-2 items-center">
                            <span class="text-gray-400">Access Level:</span>
                            <span id="review-access-type" class="col-span-2 px-2 py-1 rounded bg-purple-500/20 text-purple-300 inline-block w-fit">Owner Only</span>
                        </div>
                        <div id="review-access-users" class="hidden grid grid-cols-3 gap-2 items-start">
                            <span class="text-gray-400">Allowed Users:</span>
                            <div id="review-users-list" class="col-span-2 flex flex-wrap gap-1"></div>
                        </div>
                        <div id="review-access-groups" class="hidden grid grid-cols-3 gap-2 items-start">
                            <span class="text-gray-400">Allowed Groups:</span>
                            <div id="review-groups-list" class="col-span-2 flex flex-wrap gap-1"></div>
                        </div>
                        <!-- Granular Permissions -->
                        <div id="review-permissions-section" class="hidden pt-3 border-t border-gray-700">
                            <div class="text-gray-400 mb-2 text-xs uppercase tracking-wide">Granular Permissions</div>
                            <div class="grid md:grid-cols-3 gap-3">
                                <div id="review-perm-edit" class="hidden">
                                    <div class="text-xs text-gray-500 mb-1">‚úèÔ∏è Can Edit</div>
                                    <div id="review-edit-list" class="flex flex-wrap gap-1"></div>
                                </div>
                                <div id="review-perm-delete" class="hidden">
                                    <div class="text-xs text-gray-500 mb-1">üóëÔ∏è Can Delete</div>
                                    <div id="review-delete-list" class="flex flex-wrap gap-1"></div>
                                </div>
                                <div id="review-perm-execute" class="hidden">
                                    <div class="text-xs text-gray-500 mb-1">üöÄ Can Use in Agents</div>
                                    <div id="review-execute-list" class="flex flex-wrap gap-1"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sources Summary (for data tools) -->
                <div id="review-sources-section" class="hidden card rounded-lg p-4">
                    <h5 class="font-medium mb-4">üìÅ Sources Summary</h5>
                    <div class="grid grid-cols-4 gap-3 text-sm">
                        <div class="p-3 rounded bg-gray-800 text-center">
                            <div class="text-xl font-bold" id="review-files">0</div>
                            <div class="text-xs text-gray-400">üìÑ Files</div>
                        </div>
                        <div class="p-3 rounded bg-gray-800 text-center">
                            <div class="text-xl font-bold" id="review-urls">0</div>
                            <div class="text-xs text-gray-400">üåê URLs</div>
                        </div>
                        <div class="p-3 rounded bg-gray-800 text-center">
                            <div class="text-xl font-bold" id="review-text">0</div>
                            <div class="text-xs text-gray-400">‚úçÔ∏è Text</div>
                        </div>
                        <div class="p-3 rounded bg-gray-800 text-center">
                            <div class="text-xl font-bold" id="review-tables">0</div>
                            <div class="text-xs text-gray-400">üìä Tables</div>
                        </div>
                    </div>
                </div>

                <div class="bg-green-900/30 border border-green-600/50 rounded-lg p-3 text-sm">
                    <p class="text-green-300">‚úÖ Review complete! Click the button below to finish.</p>
                    <p class="text-xs text-gray-400 mt-2">To test an API, go back to Configuration and click "Try this API".</p>
                </div>
            </div>

        </div>

        <!-- Footer with Navigation -->
        <div id="wizard-footer" class="hidden p-4 md:p-6 border-t border-gray-800 flex justify-between shrink-0 bg-[#1e1e2e]">
            <div class="flex gap-2">
                <button onclick="cancelToolWizard()" class="px-4 py-2 rounded-lg text-red-400 hover:bg-red-500/20 transition-colors">‚úï Cancel</button>
                <button onclick="wizBack()" id="btn-back" class="btn-secondary px-6 py-2 rounded-lg">‚Üê Back</button>
            </div>
            <div class="flex gap-2">
                <button onclick="wizSkip()" id="btn-skip" class="hidden text-gray-400 hover:text-white px-4 py-2">Skip</button>
                <button onclick="wizNext()" id="btn-next" class="btn-primary px-6 py-2 rounded-lg">Next ‚Üí</button>
                <button onclick="wizCreate()" id="btn-create" class="hidden btn-primary px-6 py-2 rounded-lg bg-green-600 hover:bg-green-700">‚úì Create Tool</button>
            </div>
        </div>
    </div>
</div>

    <!-- Progress Modal -->
    <div id="progress-modal" class="hidden fixed inset-0 modal-backdrop flex items-center justify-center z-[60]">
        <div class="card rounded-xl w-full max-w-md mx-4 p-6">
            <h3 id="progress-title" class="text-lg font-bold mb-4">Processing...</h3>
            
            <!-- Progress Bar -->
            <div class="bg-gray-700 rounded-full h-3 mb-3 overflow-hidden">
                <div id="progress-bar" class="bg-gradient-to-r from-purple-500 to-pink-500 h-full rounded-full transition-all duration-500" style="width: 0%"></div>
            </div>
            
            <!-- Status Text -->
            <p id="progress-status" class="text-sm text-gray-300 mb-4">Starting...</p>
            
            <!-- Log Area -->
            <div id="progress-log" class="bg-gray-900 rounded-lg p-3 h-32 overflow-y-auto font-mono text-xs space-y-1"></div>
            
            <!-- Spinner -->
            <div class="flex items-center justify-center mt-4">
                <div class="animate-spin rounded-full h-6 w-6 border-2 border-purple-500 border-t-transparent"></div>
                <span class="ml-2 text-sm text-gray-400">Please wait...</span>
            </div>
        </div>
    </div>

    <!-- Data Viewer Modal -->
    <div id="data-viewer-modal" class="hidden fixed inset-0 modal-backdrop flex items-center justify-center z-[70]" onclick="if(event.target===this)closeDataViewer()">
        <div class="card rounded-xl w-full max-w-5xl mx-4 max-h-[90vh] flex flex-col" onclick="event.stopPropagation()">
            <!-- Header -->
            <div class="p-4 border-b border-gray-700 flex items-center justify-between flex-shrink-0">
                <div>
                    <h3 id="data-viewer-title" class="text-lg font-bold">üìä Extracted Data</h3>
                    <p id="data-viewer-subtitle" class="text-sm text-gray-400"></p>
                </div>
                <div class="flex gap-2">
                    <button onclick="copyDataContent()" class="btn-secondary px-3 py-1.5 rounded-lg text-sm">üìã Copy</button>
                    <button onclick="downloadDataContent()" class="btn-secondary px-3 py-1.5 rounded-lg text-sm">üíæ Download</button>
                    <button onclick="closeDataViewer()" class="text-gray-400 hover:text-white text-xl px-2">‚úï</button>
                </div>
            </div>
            
            <!-- Tabs -->
            <div class="flex gap-4 px-4 pt-3 border-b border-gray-700 flex-shrink-0">
                <button onclick="setDataTab('tables')" id="data-tab-tables" class="pb-2 px-1 border-b-2 border-purple-500 text-white text-sm">üìä Tables</button>
                <button onclick="setDataTab('text')" id="data-tab-text" class="pb-2 px-1 border-b-2 border-transparent text-gray-400 text-sm">üìù Full Text</button>
                <button onclick="setDataTab('chunks')" id="data-tab-chunks" class="pb-2 px-1 border-b-2 border-transparent text-gray-400 text-sm">üß© Chunks</button>
            </div>
            
            <!-- Search Box -->
            <div id="data-search-box" class="hidden px-4 py-3 border-b border-gray-700 flex-shrink-0">
                <div class="flex gap-2">
                    <input type="text" id="data-search-input" class="input-field flex-1 rounded-lg px-4 py-2 text-sm" placeholder="üîç Search in data... (e.g. 'file storage', 'compute', 'price')" onkeyup="if(event.key==='Enter')searchToolData()">
                    <button onclick="searchToolData()" class="btn-primary px-4 py-2 rounded-lg text-sm">Search</button>
                    <button onclick="document.getElementById('data-search-input').value='';searchToolData()" class="btn-secondary px-3 py-2 rounded-lg text-sm">Clear</button>
                </div>
            </div>
            
            <!-- Content -->
            <div id="data-viewer-content" class="flex-1 overflow-auto p-4">
                <div class="text-center text-gray-500 py-10">Loading...</div>
            </div>
            
            <!-- Footer Stats -->
            <div id="data-viewer-stats" class="p-3 border-t border-gray-700 text-xs text-gray-500 flex gap-4 flex-shrink-0">
            </div>
        </div>
    </div>

    <!-- Process Execution Modal -->
    <div id="process-execution-modal" class="hidden fixed inset-0 modal-backdrop flex items-center justify-center z-[60]" onclick="if(event.target===this)closeProcessModal()">
        <div class="card rounded-xl w-full max-w-4xl mx-4 max-h-[90vh] flex flex-col overflow-hidden" onclick="event.stopPropagation()">
            <!-- Header -->
            <div class="p-4 border-b border-gray-700 flex items-center justify-between flex-shrink-0" style="background: linear-gradient(135deg, rgba(34,197,94,0.1), rgba(20,184,166,0.1));">
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-green-500 to-teal-500 flex items-center justify-center text-2xl">üîÑ</div>
                    <div>
                        <h3 id="process-modal-title" class="text-lg font-bold">Workflow Execution</h3>
                        <p id="process-modal-subtitle" class="text-sm" style="color: var(--text-secondary);">Submit data to run this workflow</p>
                    </div>
                </div>
                <button onclick="closeProcessModal()" class="text-gray-400 hover:text-white text-2xl px-2">‚úï</button>
            </div>
            
            <!-- How it works (short) -->
            <div class="px-6 pt-2 pb-0">
                <p class="text-xs" style="color: var(--text-muted);">
                    <strong>How it works:</strong> Fill the form ‚Üí Run ‚Üí You'll see each step by name (Processing / Waiting for Approval if needed) ‚Üí When <strong>Completed</strong>, the <strong>Result</strong> and summary appear below. Notifications use the same email service as password reset &amp; MFA.
                </p>
            </div>
            
            <!-- Content Area -->
            <div class="flex-1 overflow-y-auto p-6">
                <!-- Trigger Form Section -->
                <div id="process-trigger-form">
                    <h4 class="font-semibold mb-4 flex items-center gap-2">üìù Input Data</h4>
                    <p class="text-sm mb-4" style="color: var(--text-secondary);">Enter the data to trigger this workflow:</p>
                    
                    <!-- Dynamic Form Fields (populated by JS) -->
                    <div id="process-form-fields" class="space-y-4">
                        <!-- Example field - will be replaced dynamically -->
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Amount ($)</label>
                            <input type="number" id="pf-amount" class="input-field w-full rounded-lg px-4 py-3" placeholder="Enter amount...">
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Description</label>
                            <input type="text" id="pf-description" class="input-field w-full rounded-lg px-4 py-3" placeholder="Enter description...">
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Additional Notes (Optional)</label>
                            <textarea id="pf-notes" class="input-field w-full rounded-lg px-4 py-3" rows="3" placeholder="Any additional information..."></textarea>
                        </div>
                    </div>
                    
                    <!-- Submit Button -->
                    <div class="mt-6">
                        <button onclick="executeProcess()" class="w-full py-3 rounded-lg flex items-center justify-center gap-2 text-lg text-white font-medium" style="background: linear-gradient(135deg, #22c55e 0%, #14b8a6 100%);">
                            <span>‚ñ∂Ô∏è</span> Run Workflow
                        </button>
                    </div>
                </div>
                
                <!-- Execution Status Section (hidden initially) -->
                <div id="process-execution-status" class="hidden">
                    <h4 class="font-semibold mb-4 flex items-center gap-2">üìä Execution Status</h4>
                    
                    <!-- Status Badge -->
                    <div id="process-status-badge" class="mb-4 p-4 rounded-lg bg-yellow-500/10 border border-yellow-500/30">
                        <div class="flex items-center gap-3">
                            <div class="animate-spin w-6 h-6 border-2 border-yellow-500 border-t-transparent rounded-full"></div>
                            <div>
                                <p class="font-medium text-yellow-400">Processing...</p>
                                <p class="text-sm text-gray-400">Your workflow is running</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Steps Progress -->
                    <div id="process-steps-list" class="space-y-3">
                        <!-- Steps will be populated here -->
                    </div>
                    
                    <!-- Result (when complete) ‚Äì business-friendly summary + optional submitted data -->
                    <div id="process-output" class="hidden mt-4 space-y-4">
                        <div class="p-4 rounded-lg bg-green-500/10 border border-green-500/30">
                            <p id="process-result-summary" class="font-medium text-green-400">Your request was processed successfully.</p>
                        </div>
                        <div id="process-result-body" class="hidden">
                            <h5 class="font-medium mb-2">üìã Result</h5>
                            <pre id="process-output-content" class="text-sm text-gray-300 whitespace-pre-wrap rounded bg-gray-800 p-3"></pre>
                        </div>
                        <div id="process-submitted-data-wrap" class="hidden">
                            <button type="button" id="process-submitted-data-toggle" class="flex items-center gap-2 text-sm text-gray-400 hover:text-white mb-2">
                                <span>‚ñº</span> Submitted data
                            </button>
                            <pre id="process-submitted-data-content" class="text-sm text-gray-500 whitespace-pre-wrap rounded bg-gray-800/80 p-3 hidden"></pre>
                        </div>
                    </div>
                </div>
                
                <!-- Pending Approval Section (hidden initially) -->
                <div id="process-pending-approval" class="hidden">
                    <div class="p-4 rounded-xl border border-yellow-500/30 bg-yellow-500/5">
                        <div class="flex items-start justify-between gap-3">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 rounded-xl bg-yellow-500/20 flex items-center justify-center">
                                    <span class="text-2xl">‚è≥</span>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-lg">Waiting for Approval</h4>
                                    <p class="text-sm text-gray-400">Approve to continue and reach the end of the workflow.</p>
                                </div>
                            </div>
                            <button type="button" onclick="openApprovalDashboard()" class="btn-secondary px-3 py-2 rounded-lg text-sm">Open approvals</button>
                        </div>

                        <div id="process-inline-approval-details" class="mt-4 text-sm text-gray-300">
                            <div class="text-gray-500">Loading approval details‚Ä¶</div>
                        </div>

                        <div class="mt-4">
                            <label class="text-xs text-gray-500 uppercase tracking-wide mb-2 block">Comments (optional)</label>
                            <textarea id="process-inline-approval-comments" class="input-field w-full rounded-lg px-4 py-3" rows="2" placeholder="Add a note for the requester‚Ä¶"></textarea>
                        </div>

                        <div class="mt-4 flex gap-3">
                            <button type="button" onclick="approveInlineApproval()" class="flex-1 py-2.5 rounded-lg bg-green-500 hover:bg-green-600 text-white font-medium transition">
                                ‚úÖ Approve & Continue
                            </button>
                            <button type="button" onclick="rejectInlineApproval()" class="flex-1 py-2.5 rounded-lg bg-red-500 hover:bg-red-600 text-white font-medium transition">
                                ‚ùå Reject
                            </button>
                        </div>

                        <p id="process-inline-approval-hint" class="text-xs text-gray-500 mt-3">Tip: After approving, the workflow will automatically continue and the report will appear when it completes.</p>
                    </div>
                </div>
            </div>
            
            <!-- Footer -->
            <div class="p-4 border-t border-gray-700 flex justify-between items-center flex-shrink-0">
                <button onclick="viewExecutionHistory()" class="text-sm text-gray-400 hover:text-white">üìú View History</button>
                <button onclick="closeProcessModal()" class="btn-secondary px-4 py-2 rounded-lg">Close</button>
            </div>
        </div>
    </div>
    
    <!-- Approval Dashboard Modal -->
    <div id="approval-dashboard-modal" class="hidden fixed inset-0 modal-backdrop flex items-center justify-center z-[60]" onclick="if(event.target===this)closeApprovalDashboard()">
        <div class="card rounded-xl w-full max-w-5xl mx-4 max-h-[90vh] flex flex-col overflow-hidden" onclick="event.stopPropagation()">
            <!-- Header -->
            <div class="p-4 border-b border-gray-700 flex items-center justify-between flex-shrink-0" style="background: linear-gradient(135deg, rgba(234,179,8,0.1), rgba(249,115,22,0.1));">
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-yellow-500 to-orange-500 flex items-center justify-center text-2xl">üìã</div>
                    <div>
                        <h3 class="text-lg font-bold">Pending Approvals</h3>
                        <p id="approval-count-subtitle" class="text-sm text-gray-400">0 items waiting for your decision</p>
                    </div>
                </div>
                <button onclick="closeApprovalDashboard()" class="text-gray-400 hover:text-white text-2xl px-2">‚úï</button>
            </div>
            
            <!-- Approval List -->
            <div class="flex-1 overflow-y-auto p-4">
                <div id="approval-list" class="space-y-4">
                    <!-- Approval items will be populated here -->
                    <div class="text-center py-10 text-gray-500">
                        <span class="text-4xl mb-4 block">‚úÖ</span>
                        <p>No pending approvals</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Process Playback Modal (Business-friendly animation on process flow) -->
    <div id="process-playback-modal" class="hidden fixed inset-0 modal-backdrop flex items-center justify-center z-[80]" onclick="if(event.target===this)closeProcessPlaybackModal()">
        <div class="card rounded-xl w-full max-w-6xl mx-4 max-h-[92vh] flex flex-col overflow-hidden" onclick="event.stopPropagation()">
            <div class="p-4 border-b border-gray-700 flex items-center justify-between flex-shrink-0" style="background: linear-gradient(135deg, rgba(99,102,241,0.10), rgba(139,92,246,0.10));">
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center text-2xl">üß≠</div>
                    <div>
                        <h3 class="text-lg font-bold">Process playback</h3>
                        <p id="process-playback-subtitle" class="text-sm text-gray-400">Showing the actual path the workflow took</p>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <button onclick="replayProcessPlayback()" class="btn-secondary px-3 py-1.5 rounded-lg text-sm">Replay</button>
                    <button onclick="closeProcessPlaybackModal()" class="text-gray-400 hover:text-white text-2xl px-2">‚úï</button>
                </div>
            </div>
            <div class="flex-1 bg-black/30">
                <iframe id="process-playback-frame" title="Process Playback" class="w-full h-[74vh] border-0" src="about:blank"></iframe>
            </div>
        </div>
    </div>

    <!-- Process Test Report Modal (Business-friendly result summary; no raw JSON by default) -->
    <div id="process-test-report-modal" class="hidden fixed inset-0 modal-backdrop flex items-center justify-center z-[85]" onclick="if(event.target===this)closeProcessTestReport()">
        <div class="card rounded-xl w-full max-w-5xl mx-4 max-h-[92vh] flex flex-col overflow-hidden" onclick="event.stopPropagation()">
            <div class="p-4 border-b border-gray-700 flex items-center justify-between flex-shrink-0" style="background: linear-gradient(135deg, rgba(34,197,94,0.08), rgba(20,184,166,0.08));">
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-green-500 to-teal-500 flex items-center justify-center text-2xl">üìã</div>
                    <div>
                        <h3 id="process-test-report-title" class="text-lg font-bold">Test report</h3>
                        <p id="process-test-report-subtitle" class="text-sm text-gray-400">Summary of what happened in this run</p>
                    </div>
                </div>
                <button onclick="closeProcessTestReport()" class="text-gray-400 hover:text-white text-2xl px-2">‚úï</button>
            </div>
            <div id="process-test-report-body" class="flex-1 overflow-y-auto p-5">
                <div class="text-center text-gray-500 py-10">Loading‚Ä¶</div>
            </div>
        </div>
    </div>

    <script src="/ui/dialogs.js?v=20260223c" defer></script>
    <script src="/ui/index_parts/app-core.js?v=20260223j" defer></script>
    <script src="/ui/index_parts/process-playback.js?v=20260223n" defer></script>
    <script src="/ui/index_parts/approvals.js?v=20260223i" defer></script>
    <script src="/ui/index_parts/agent-wizard.js?v=20260223h" defer></script>
    <script src="/ui/index_parts/features-demo-tools.js?v=20260223h" defer></script>
    <script src="/ui/index_parts/features-tools-wizard.js?v=20260223h" defer></script>
    <script src="/ui/index_parts/features-chat.js?v=20260223h" defer></script>
    <script src="/ui/index_parts/features-auth-permissions.js?v=20260223h" defer></script>
    <script src="/ui/index_parts/features-security-identity.js?v=20260223h" defer></script>
    <script src="/ui/index_parts/features-approvals-page.js?v=20260223h" defer></script>
<!-- Tool Edit Slide-over Panel -->
<div id="tool-edit-panel" class="fixed inset-0 z-[9999] hidden">
    <div class="absolute inset-0 bg-black/60" onclick="closeToolEditPanel()"></div>
    <div class="absolute right-0 top-0 h-full w-full max-w-2xl bg-gray-900 shadow-2xl transform transition-transform duration-300 translate-x-full" id="tool-edit-slider">
        <div class="flex flex-col h-full">
            <!-- Header -->
            <div class="flex items-center justify-between p-4 border-b border-gray-700">
                <div class="flex items-center gap-3">
                    <span id="edit-panel-icon" class="text-2xl">üîß</span>
                    <div>
                        <h2 class="font-bold text-lg">Edit Tool</h2>
                        <p id="edit-panel-type" class="text-xs text-gray-400">KNOWLEDGE BASE</p>
                    </div>
                </div>
                <button onclick="closeToolEditPanel()" class="p-2 hover:bg-gray-700 rounded-lg text-gray-400 hover:text-white">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                </button>
            </div>
            
            <!-- Tabs -->
            <div class="flex border-b border-gray-700">
                <button onclick="switchEditTab('basic')" class="edit-tab active flex-1 px-4 py-3 text-sm font-medium border-b-2 border-purple-500 text-purple-400" data-tab="basic">Basic Info</button>
                <button onclick="switchEditTab('config')" class="edit-tab flex-1 px-4 py-3 text-sm font-medium border-b-2 border-transparent text-gray-400 hover:text-white" data-tab="config">Configuration</button>
                <button onclick="switchEditTab('sources')" class="edit-tab flex-1 px-4 py-3 text-sm font-medium border-b-2 border-transparent text-gray-400 hover:text-white" data-tab="sources">Sources</button>
                <button onclick="switchEditTab('access')" class="edit-tab flex-1 px-4 py-3 text-sm font-medium border-b-2 border-transparent text-gray-400 hover:text-white" data-tab="access">üîê Access</button>
            </div>
            
            <!-- Content -->
            <div class="flex-1 overflow-y-auto p-4">
                <input type="hidden" id="edit-tool-id">
                <input type="hidden" id="edit-tool-type">
                
                <!-- Basic Info Tab -->
                <div id="edit-tab-basic" class="edit-tab-content space-y-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Name *</label>
                        <input type="text" id="edit-tool-name" class="input-field w-full px-4 py-2 rounded-lg" required>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Description</label>
                        <textarea id="edit-tool-desc" rows="3" class="input-field w-full px-4 py-2 rounded-lg"></textarea>
                    </div>
                    <div class="flex items-center gap-3">
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="edit-tool-active" class="sr-only peer" checked>
                            <div class="w-11 h-6 bg-gray-700 peer-focus:ring-2 peer-focus:ring-purple-500 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                        </label>
                        <span class="text-sm">Active</span>
                    </div>
                </div>
                
                <!-- Configuration Tab -->
                <div id="edit-tab-config" class="edit-tab-content hidden space-y-4">
                    <div id="edit-config-content">
                        <!-- Dynamic config fields will be inserted here -->
                    </div>
                </div>
                
                <!-- Sources Tab -->
                <div id="edit-tab-sources" class="edit-tab-content hidden space-y-4">
                    <div id="edit-sources-content">
                        <!-- Dynamic sources will be shown here -->
                    </div>
                </div>
                
                <!-- Access Control Tab -->
                <div id="edit-tab-access" class="edit-tab-content hidden space-y-4">
                    <!-- Current Permissions Summary -->
                    <div id="edit-access-summary" class="rounded-xl p-4" style="background: #f3f4f6; border: 1px solid #e5e7eb;">
                        <h5 class="font-semibold mb-3" style="color: #1f2937;">üîê Current Access Control</h5>
                        <div id="edit-access-type-display" class="p-3 rounded-lg mb-3" style="background: #ffffff; border: 1px solid #d1d5db;">
                            <!-- Will be populated by JS -->
                        </div>
                        
                        <!-- Selected Users/Groups -->
                        <div id="edit-access-entities" class="hidden">
                            <h6 class="text-sm font-medium mb-2" style="color: #374151;">üë• Allowed Users & Groups:</h6>
                            <div id="edit-access-chips-display" class="flex flex-wrap gap-2 p-3 rounded-lg mb-3" style="background: #ffffff; border: 1px solid #d1d5db; min-height: 50px;">
                                <!-- Chips will be populated by JS -->
                            </div>
                            
                            <!-- Granular Permissions Display -->
                            <div id="edit-granular-perms" class="space-y-2 mt-3">
                                <div id="edit-perm-edit" class="hidden">
                                    <span class="text-xs font-medium" style="color: #374151;">‚úèÔ∏è Can Edit:</span>
                                    <span id="edit-perm-edit-list" class="text-xs" style="color: #5b21b6;"></span>
                                </div>
                                <div id="edit-perm-delete" class="hidden">
                                    <span class="text-xs font-medium" style="color: #374151;">üóëÔ∏è Can Delete:</span>
                                    <span id="edit-perm-delete-list" class="text-xs" style="color: #dc2626;"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Owner-only: Full Edit UI -->
                    <div id="edit-access-owner-controls" class="hidden space-y-4">
                        <div class="rounded-xl p-4" style="background: #f3f4f6; border: 1px solid #e5e7eb;">
                            <h5 class="font-semibold mb-4" style="color: #1f2937;">‚öôÔ∏è Modify Access Control</h5>
                            
                            <!-- Access Type Selection -->
                            <div class="grid grid-cols-2 gap-3 mb-4">
                                <div class="edit-access-card tool-access-card cursor-pointer p-3 rounded-lg border-2 transition-all" 
                                     data-access="owner_only" style="background: #ffffff; border-color: #d1d5db;"
                                     onclick="selectEditAccessType('owner_only')">
                                    <div class="flex items-center gap-2">
                                        <span>üë§</span>
                                        <span class="font-medium" style="color: #1f2937;">Only Me</span>
                                    </div>
                                    <div class="tool-access-check hidden mt-1 text-purple-500 text-xs">‚úì</div>
                                </div>
                                <div class="edit-access-card tool-access-card cursor-pointer p-3 rounded-lg border-2 transition-all"
                                     data-access="authenticated" style="background: #ffffff; border-color: #d1d5db;"
                                     onclick="selectEditAccessType('authenticated')">
                                    <div class="flex items-center gap-2">
                                        <span>üè¢</span>
                                        <span class="font-medium" style="color: #1f2937;">All Logged In</span>
                                    </div>
                                    <div class="tool-access-check hidden mt-1 text-blue-500 text-xs">‚úì</div>
                                </div>
                                <div class="edit-access-card tool-access-card cursor-pointer p-3 rounded-lg border-2 transition-all"
                                     data-access="specific_users" style="background: #ffffff; border-color: #d1d5db;"
                                     onclick="selectEditAccessType('specific_users')">
                                    <div class="flex items-center gap-2">
                                        <span>üë•</span>
                                        <span class="font-medium" style="color: #1f2937;">Specific Users</span>
                                    </div>
                                    <div class="tool-access-check hidden mt-1 text-yellow-500 text-xs">‚úì</div>
                                </div>
                                <div class="edit-access-card tool-access-card cursor-pointer p-3 rounded-lg border-2 transition-all"
                                     data-access="public" style="background: #ffffff; border-color: #d1d5db;"
                                     onclick="selectEditAccessType('public')">
                                    <div class="flex items-center gap-2">
                                        <span>üåç</span>
                                        <span class="font-medium" style="color: #1f2937;">Public</span>
                                    </div>
                                    <div class="tool-access-check hidden mt-1 text-green-500 text-xs">‚úì</div>
                                </div>
                            </div>
                            
                            <!-- Specific Users Config -->
                            <div id="edit-specific-config" class="hidden space-y-3 pt-3 border-t" style="border-color: #e5e7eb;">
                                <!-- Search -->
                                <div>
                                    <label class="text-sm mb-2 block" style="color: #374151; font-weight: 500;">üîç Search Users & Groups</label>
                                    <input type="text" id="edit-access-search" 
                                           class="w-full rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-500" 
                                           style="background: #ffffff; color: #1f2937; border: 1px solid #d1d5db;"
                                           placeholder="Type to search..."
                                           oninput="filterEditAccessSearch(this.value)"
                                           onfocus="showEditAccessResults()"
                                           autocomplete="off">
                                </div>
                                
                                <!-- Search Results -->
                                <div id="edit-access-results" class="hidden rounded-xl overflow-hidden max-h-40 overflow-y-auto shadow-lg" style="background: #ffffff; border: 1px solid #d1d5db;"></div>
                                
                                <!-- Selected Chips -->
                                <div>
                                    <label class="text-sm mb-2 block" style="color: #374151; font-weight: 500;">
                                        üë• Selected <span id="edit-selected-count" class="text-xs px-2 py-0.5 rounded-full" style="background: #7c3aed; color: white;">0</span>
                                    </label>
                                    <div id="edit-selected-chips" class="flex flex-wrap gap-2 min-h-[50px] p-3 rounded-xl" style="background: #ffffff; border: 1px dashed #d1d5db;">
                                        <span class="text-sm italic" style="color: #9ca3af;">No users or groups selected</span>
                                    </div>
                                </div>
                                
                                <!-- Granular Permissions -->
                                <div class="rounded-lg p-3" style="background: #e5e7eb;">
                                    <h6 class="text-sm font-medium mb-2" style="color: #1f2937;">üîê Granular Permissions</h6>
                                    <div class="grid grid-cols-2 gap-3">
                                        <div>
                                            <label class="text-xs mb-1 block" style="color: #374151;">‚úèÔ∏è Can Edit</label>
                                            <div id="edit-can-edit-chips" class="flex flex-wrap gap-1 min-h-[30px] p-2 rounded" style="background: #ffffff; border: 1px solid #d1d5db;"></div>
                                            <select id="edit-can-edit-select" class="w-full rounded px-2 py-1 text-sm mt-1" style="background: #ffffff; border: 1px solid #d1d5db; color: #1f2937;" onchange="addEditPermChip('edit', this)">
                                                <option value="">+ Add</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="text-xs mb-1 block" style="color: #374151;">üóëÔ∏è Can Delete</label>
                                            <div id="edit-can-delete-chips" class="flex flex-wrap gap-1 min-h-[30px] p-2 rounded" style="background: #ffffff; border: 1px solid #d1d5db;"></div>
                                            <select id="edit-can-delete-select" class="w-full rounded px-2 py-1 text-sm mt-1" style="background: #ffffff; border: 1px solid #d1d5db; color: #1f2937;" onchange="addEditPermChip('delete', this)">
                                                <option value="">+ Add</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Non-owner message -->
                    <div id="edit-access-readonly-msg" class="hidden text-center p-4 rounded-xl" style="background: #fef3c7; border: 1px solid #f59e0b;">
                        <p class="text-sm" style="color: #92400e;">üîí Only the tool owner can modify access control settings.</p>
                    </div>
                </div>
            </div>
            
            <!-- Footer -->
            <div class="flex items-center justify-end gap-3 p-4 border-t border-gray-700">
                <button onclick="closeToolEditPanel()" class="btn-secondary px-6 py-2 rounded-lg">Cancel</button>
                <button onclick="saveToolChanges()" class="btn-primary px-6 py-2 rounded-lg">Save Changes</button>
            </div>
        </div>
    </div>
</div>
</body>
</html>
